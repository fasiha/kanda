var E=7,F=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23],O=607/128,A=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function S(a){if(a<0)return Number("0/0");for(var e=A[0],t=A.length-1;t>0;--t)e+=A[t]/(a+t);var r=a+O+.5;return .5*Math.log(2*Math.PI)+(a+.5)*Math.log(r)-r+Math.log(e)-Math.log(a)}var P=function a(e){if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*a(1-e));if(e>100)return Math.exp(S(e));e-=1;for(var t=F[0],r=1;r<E+2;r++)t+=F[r]/(e+r);var i=e+E+.5;return Math.sqrt(2*Math.PI)*Math.pow(i,e+.5)*Math.exp(-i)*t},$=S;P.log=$;var z=Math.exp,J=Math.log,V=Math.sign,W=Math.max;function K(a,e){var t=W(...a),r=0;for(let h=a.length-1;h>=0;h--)r+=e[h]*z(a[h]-t);var i=V(r);r*=i;var n=J(r)+t;return[n,i]}var Q=K,N=2/(1+Math.sqrt(5)),X=Y;function Y(a,e,t,r,i,n){for(var h,s,l=0,o=t-N*(t-e),f=e+N*(t-e),u=a(o),c=a(f),m=a(e),p=a(t),b=e,d=t;++l<i&&Math.abs(t-e)>r;)c>u?(t=f,f=o,c=u,o=t-N*(t-e),u=a(o)):(e=o,o=f,u=c,f=e+N*(t-e),c=a(f));return h=.5*(t+e),s=.5*(u+c),n&&(n.iterations=l,n.argmin=h,n.minimum=s,n.converged=!0),isNaN(c)||isNaN(u)||l===i?(n&&(n.converged=!1),NaN):m<s?b:p<s?d:h}var Z=L;function L(a,e,t,r,i,n,h){var s,l,o,f,u,c,m;for(f=1,u=t,c=t,o=l=s=e(t);!m&&isFinite(r)&&!isNaN(r);)if(++f,m=!0,l<=o&&(o=l,u=Math.max(i,u-r),l=e(u),m=!1),s<=o&&(o=s,c=Math.min(n,c+r),s=e(c),m=!1),o=Math.min(o,l,s),(l===o&&u===i||s===o&&c===n)&&(m=!0),r*=f<4?2:Math.exp(f*.5),!isFinite(r))return a[0]=-Infinity,a[1]=Infinity,a;return a[0]=u,a[1]=c,a}var g=[0,0],U=function(e,t,r){t=t||{};var i,n=t.tolerance===void 0?1e-8:t.tolerance,h=t.initialIncrement===void 0?1:t.initialIncrement,s=t.lowerBound===void 0?-Infinity:t.lowerBound,l=t.upperBound===void 0?Infinity:t.upperBound,o=t.maxIterations===void 0?100:t.maxIterations;if(r&&(r.iterations=0,r.argmin=NaN,r.minimum=Infinity,r.converged=!1),isFinite(l)&&isFinite(s))g[0]=s,g[1]=l;else if(t.guess===void 0?s>-Infinity?i=l<Infinity?.5*(s+l):s:i=l<Infinity?l:0:i=t.guess,Z(g,e,i,h,s,l),isNaN(g[0])||isNaN(g[1]))return NaN;return X(e,g[0],g[1],n,o,r)},T=P.log;const y=Math.exp,ee=Math.log,q=new Map();function M(a){let e=q.get(a);return e||(e=T(a),q.set(a,e),e)}function te(a,e,t){return T(a)-T(a+t)+M(e+t)-M(e)}function k(a,e){return M(a)+M(e)-M(a+e)}function ae(a,e,t=!1){const[r,i,n]=a,h=e/n,s=te(r+h,r,i);return t?y(s):s}function re(a,e){return-k(1+a-e,1+e)-Math.log(a+1)}function C(a,e,t,r,i=!0,n=void 0){const[h,s,l]=a;n=n||l;const o=r/l,f=n/r,u=Array.from(Array(t-e+1),(w,B)=>re(t-e,B)),[c,m,p]=[0,1,2].map(w=>{const B=Array.from(Array(t-e+1),(H,I)=>u[I]+k(s,h+o*(e+I)+w*o*f)),G=Array.from(Array(t-e+1),(H,I)=>Math.pow(-1,I));return Q(B,G)[0]}),b=Math.exp(m-c),d=Math.exp(p-c),x=Math.exp(2*(m-c)),v=d-x;if(![b,d,v].every(w=>isFinite(w)&&w>=0))throw new Error(JSON.stringify({prior:a,successes:e,total:t,tnow:r,rebalance:i,tback:n,mean:b,m2:d,sig2:v}));const[_,D]=ne(b,v),R=[_,D,n];return i?ie(a,e,t,r,R):R}function ie(a,e,t,r,i){const[n,h,s]=i;if(n>2*h||h>2*n){const l=j(i,.5,!0);return C(a,e,t,r,!1,l)}return i}function ne(a,e){var t=a*(1-a)/e-1,r=a*t,i=(1-a)*t;return[r,i]}function oe(a,e=4,t=e){return[e,t,a]}function j(a,e=.5,t=!1,r=1e-4){if(e<0||e>1)throw new Error("percentiles must be between (0, 1) exclusive");const[i,n,h]=a,s=k(i,n),l=ee(e);function o(v){const _=k(i+y(v),n)-s;return _-l}const f=t?1:6;let u=-f/2,c=f/2,m=o(u),p=o(c);for(;m>0&&p>0;)u=c,m=p,c+=f,p=o(c);for(;m<0&&p<0;)c=u,p=m,u-=f,m=o(u);if(!(m>0&&p<0))throw new Error("failed to bracket");if(t)return(y(u)+y(c))/2*h;const b=U;let d={};const x=b(v=>Math.abs(o(v)),{lowerBound:u,upperBound:c,tolerance:r},d);if(!d.converged)throw new Error("failed to converge");return y(x)*h}var se={updateRecall:C,predictRecall:ae,defaultModel:oe,modelToPercentileDecay:j};export default se;
