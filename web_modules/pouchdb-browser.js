import{a as ma,g as Qd,c as pc}from"./common/_commonjsHelpers-738d5c9d.js";var Rd={},Sd=Object.freeze({__proto__:null,default:Rd}),Td=function(){return typeof ma.queueMicrotask==="function"},Ud=function(a){return function(){ma.queueMicrotask(a)}},Vd={test:Td,install:Ud},qc=ma.MutationObserver||ma.WebKitMutationObserver,Wd=function(){return qc},Xd=function(a){var b=0,c=new qc(a),d=ma.document.createTextNode("");return c.observe(d,{characterData:!0}),function(){d.data=b=++b%2}},Yd={test:Wd,install:Xd},Zd=function(){return ma.setImmediate?!1:typeof ma.MessageChannel!=="undefined"},_d=function(a){var b=new ma.MessageChannel();return b.port1.onmessage=a,function(){b.port2.postMessage(0)}},$d={test:Zd,install:_d},ae=function(){return"document"in ma&&"onreadystatechange"in ma.document.createElement("script")},be=function(a){return function(){var b=ma.document.createElement("script");return b.onreadystatechange=function(){a(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},ma.document.documentElement.appendChild(b),a}},ce={test:ae,install:be},de=function(){return!0},ee=function(a){return function(){setTimeout(a,0)}},fe={test:de,install:ee},ge=Qd(Sd),Ya=[ge,Vd,Yd,$d,ce,fe],Na,Da,Za=-1,Aa=[],Ab=!1;function he(){if(!Na||!Da)return;Na=!1,Da.length?Aa=Da.concat(Aa):Za=-1,Aa.length&&rc()}function rc(){if(Na)return;Ab=!1,Na=!0;for(var a=Aa.length,b=setTimeout(he);a;){for(Da=Aa,Aa=[];Da&&++Za<a;)Da[Za].run();Za=-1,a=Aa.length}Da=null,Za=-1,Na=!1,clearTimeout(b)}for(var sc,_a=-1,ie=Ya.length;++_a<ie;)if(Ya[_a]&&Ya[_a].test&&Ya[_a].test()){sc=Ya[_a].install(rc);break}function tc(a,b){this.fun=a,this.array=b}tc.prototype.run=function(){var a=this.fun,b=this.array;switch(b.length){case 0:return a();case 1:return a(b[0]);case 2:return a(b[0],b[1]);case 3:return a(b[0],b[1],b[2]);default:return a.apply(null,b)}};var ua=je;function je(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];Aa.push(new tc(a,b)),!Ab&&!Na&&(Ab=!0,sc())}var uc=typeof crypto!=="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!=="undefined"&&typeof msCrypto.getRandomValues==="function"&&msCrypto.getRandomValues.bind(msCrypto),ke=new Uint8Array(16);function le(){if(!uc)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return uc(ke)}for(var vc=[],Bb=0;Bb<256;++Bb)vc.push((Bb+256).toString(16).substr(1));function me(a,b){var c=b||0,d=vc;return(d[a[c+0]]+d[a[c+1]]+d[a[c+2]]+d[a[c+3]]+"-"+d[a[c+4]]+d[a[c+5]]+"-"+d[a[c+6]]+d[a[c+7]]+"-"+d[a[c+8]]+d[a[c+9]]+"-"+d[a[c+10]]+d[a[c+11]]+d[a[c+12]]+d[a[c+13]]+d[a[c+14]]+d[a[c+15]]).toLowerCase()}function wc(a,b,c){typeof a==="string"&&(b=a==="binary"?new Uint8Array(16):null,a=null),a=a||{};var d=a.random||(a.rng||le)();d[6]=d[6]&15|64,d[8]=d[8]&63|128;if(b){for(var e=c||0,f=0;f<16;++f)b[e+f]=d[f];return b}return me(d)}var Cb=pc(function(a,b){(function(c){a.exports=c()})(function(c){var d=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function e(q,m){var h=q[0],i=q[1],l=q[2],o=q[3];h+=(i&l|~i&o)+m[0]-680876936|0,h=(h<<7|h>>>25)+i|0,o+=(h&i|~h&l)+m[1]-389564586|0,o=(o<<12|o>>>20)+h|0,l+=(o&h|~o&i)+m[2]+606105819|0,l=(l<<17|l>>>15)+o|0,i+=(l&o|~l&h)+m[3]-1044525330|0,i=(i<<22|i>>>10)+l|0,h+=(i&l|~i&o)+m[4]-176418897|0,h=(h<<7|h>>>25)+i|0,o+=(h&i|~h&l)+m[5]+1200080426|0,o=(o<<12|o>>>20)+h|0,l+=(o&h|~o&i)+m[6]-1473231341|0,l=(l<<17|l>>>15)+o|0,i+=(l&o|~l&h)+m[7]-45705983|0,i=(i<<22|i>>>10)+l|0,h+=(i&l|~i&o)+m[8]+1770035416|0,h=(h<<7|h>>>25)+i|0,o+=(h&i|~h&l)+m[9]-1958414417|0,o=(o<<12|o>>>20)+h|0,l+=(o&h|~o&i)+m[10]-42063|0,l=(l<<17|l>>>15)+o|0,i+=(l&o|~l&h)+m[11]-1990404162|0,i=(i<<22|i>>>10)+l|0,h+=(i&l|~i&o)+m[12]+1804603682|0,h=(h<<7|h>>>25)+i|0,o+=(h&i|~h&l)+m[13]-40341101|0,o=(o<<12|o>>>20)+h|0,l+=(o&h|~o&i)+m[14]-1502002290|0,l=(l<<17|l>>>15)+o|0,i+=(l&o|~l&h)+m[15]+1236535329|0,i=(i<<22|i>>>10)+l|0,h+=(i&o|l&~o)+m[1]-165796510|0,h=(h<<5|h>>>27)+i|0,o+=(h&l|i&~l)+m[6]-1069501632|0,o=(o<<9|o>>>23)+h|0,l+=(o&i|h&~i)+m[11]+643717713|0,l=(l<<14|l>>>18)+o|0,i+=(l&h|o&~h)+m[0]-373897302|0,i=(i<<20|i>>>12)+l|0,h+=(i&o|l&~o)+m[5]-701558691|0,h=(h<<5|h>>>27)+i|0,o+=(h&l|i&~l)+m[10]+38016083|0,o=(o<<9|o>>>23)+h|0,l+=(o&i|h&~i)+m[15]-660478335|0,l=(l<<14|l>>>18)+o|0,i+=(l&h|o&~h)+m[4]-405537848|0,i=(i<<20|i>>>12)+l|0,h+=(i&o|l&~o)+m[9]+568446438|0,h=(h<<5|h>>>27)+i|0,o+=(h&l|i&~l)+m[14]-1019803690|0,o=(o<<9|o>>>23)+h|0,l+=(o&i|h&~i)+m[3]-187363961|0,l=(l<<14|l>>>18)+o|0,i+=(l&h|o&~h)+m[8]+1163531501|0,i=(i<<20|i>>>12)+l|0,h+=(i&o|l&~o)+m[13]-1444681467|0,h=(h<<5|h>>>27)+i|0,o+=(h&l|i&~l)+m[2]-51403784|0,o=(o<<9|o>>>23)+h|0,l+=(o&i|h&~i)+m[7]+1735328473|0,l=(l<<14|l>>>18)+o|0,i+=(l&h|o&~h)+m[12]-1926607734|0,i=(i<<20|i>>>12)+l|0,h+=(i^l^o)+m[5]-378558|0,h=(h<<4|h>>>28)+i|0,o+=(h^i^l)+m[8]-2022574463|0,o=(o<<11|o>>>21)+h|0,l+=(o^h^i)+m[11]+1839030562|0,l=(l<<16|l>>>16)+o|0,i+=(l^o^h)+m[14]-35309556|0,i=(i<<23|i>>>9)+l|0,h+=(i^l^o)+m[1]-1530992060|0,h=(h<<4|h>>>28)+i|0,o+=(h^i^l)+m[4]+1272893353|0,o=(o<<11|o>>>21)+h|0,l+=(o^h^i)+m[7]-155497632|0,l=(l<<16|l>>>16)+o|0,i+=(l^o^h)+m[10]-1094730640|0,i=(i<<23|i>>>9)+l|0,h+=(i^l^o)+m[13]+681279174|0,h=(h<<4|h>>>28)+i|0,o+=(h^i^l)+m[0]-358537222|0,o=(o<<11|o>>>21)+h|0,l+=(o^h^i)+m[3]-722521979|0,l=(l<<16|l>>>16)+o|0,i+=(l^o^h)+m[6]+76029189|0,i=(i<<23|i>>>9)+l|0,h+=(i^l^o)+m[9]-640364487|0,h=(h<<4|h>>>28)+i|0,o+=(h^i^l)+m[12]-421815835|0,o=(o<<11|o>>>21)+h|0,l+=(o^h^i)+m[15]+530742520|0,l=(l<<16|l>>>16)+o|0,i+=(l^o^h)+m[2]-995338651|0,i=(i<<23|i>>>9)+l|0,h+=(l^(i|~o))+m[0]-198630844|0,h=(h<<6|h>>>26)+i|0,o+=(i^(h|~l))+m[7]+1126891415|0,o=(o<<10|o>>>22)+h|0,l+=(h^(o|~i))+m[14]-1416354905|0,l=(l<<15|l>>>17)+o|0,i+=(o^(l|~h))+m[5]-57434055|0,i=(i<<21|i>>>11)+l|0,h+=(l^(i|~o))+m[12]+1700485571|0,h=(h<<6|h>>>26)+i|0,o+=(i^(h|~l))+m[3]-1894986606|0,o=(o<<10|o>>>22)+h|0,l+=(h^(o|~i))+m[10]-1051523|0,l=(l<<15|l>>>17)+o|0,i+=(o^(l|~h))+m[1]-2054922799|0,i=(i<<21|i>>>11)+l|0,h+=(l^(i|~o))+m[8]+1873313359|0,h=(h<<6|h>>>26)+i|0,o+=(i^(h|~l))+m[15]-30611744|0,o=(o<<10|o>>>22)+h|0,l+=(h^(o|~i))+m[6]-1560198380|0,l=(l<<15|l>>>17)+o|0,i+=(o^(l|~h))+m[13]+1309151649|0,i=(i<<21|i>>>11)+l|0,h+=(l^(i|~o))+m[4]-145523070|0,h=(h<<6|h>>>26)+i|0,o+=(i^(h|~l))+m[11]-1120210379|0,o=(o<<10|o>>>22)+h|0,l+=(h^(o|~i))+m[2]+718787259|0,l=(l<<15|l>>>17)+o|0,i+=(o^(l|~h))+m[9]-343485551|0,i=(i<<21|i>>>11)+l|0,q[0]=h+q[0]|0,q[1]=i+q[1]|0,q[2]=l+q[2]|0,q[3]=o+q[3]|0}function f(q){var m=[],h;for(h=0;h<64;h+=4)m[h>>2]=q.charCodeAt(h)+(q.charCodeAt(h+1)<<8)+(q.charCodeAt(h+2)<<16)+(q.charCodeAt(h+3)<<24);return m}function g(q){var m=[],h;for(h=0;h<64;h+=4)m[h>>2]=q[h]+(q[h+1]<<8)+(q[h+2]<<16)+(q[h+3]<<24);return m}function k(q){var m=q.length,h=[1732584193,-271733879,-1732584194,271733878],i,l,o,B,G,I;for(i=64;i<=m;i+=64)e(h,f(q.substring(i-64,i)));for(q=q.substring(i-64),l=q.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;i<l;i+=1)o[i>>2]|=q.charCodeAt(i)<<(i%4<<3);o[i>>2]|=128<<(i%4<<3);if(i>55)for(e(h,o),i=0;i<16;i+=1)o[i]=0;return B=m*8,B=B.toString(16).match(/(.*?)(.{0,8})$/),G=parseInt(B[2],16),I=parseInt(B[1],16)||0,o[14]=G,o[15]=I,e(h,o),h}function n(q){var m=q.length,h=[1732584193,-271733879,-1732584194,271733878],i,l,o,B,G,I;for(i=64;i<=m;i+=64)e(h,g(q.subarray(i-64,i)));for(q=i-64<m?q.subarray(i-64):new Uint8Array(0),l=q.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;i<l;i+=1)o[i>>2]|=q[i]<<(i%4<<3);o[i>>2]|=128<<(i%4<<3);if(i>55)for(e(h,o),i=0;i<16;i+=1)o[i]=0;return B=m*8,B=B.toString(16).match(/(.*?)(.{0,8})$/),G=parseInt(B[2],16),I=parseInt(B[1],16)||0,o[14]=G,o[15]=I,e(h,o),h}function v(q){var m="",h;for(h=0;h<4;h+=1)m+=d[q>>h*8+4&15]+d[q>>h*8&15];return m}function w(q){var m;for(m=0;m<q.length;m+=1)q[m]=v(q[m]);return q.join("")}w(k("hello"))!=="5d41402abc4b2a76b9719d911017c592",typeof ArrayBuffer!=="undefined"&&!ArrayBuffer.prototype.slice&&function(){function q(m,h){return m=m|0||0,m<0?Math.max(m+h,0):Math.min(m,h)}ArrayBuffer.prototype.slice=function(m,h){var i=this.byteLength,l=q(m,i),o=i,B,G,I,H;return h!==c&&(o=q(h,i)),l>o?new ArrayBuffer(0):(B=o-l,G=new ArrayBuffer(B),I=new Uint8Array(G),H=new Uint8Array(this,l,B),I.set(H),G)}}();function j(q){return/[\u0080-\uFFFF]/.test(q)&&(q=unescape(encodeURIComponent(q))),q}function s(q,m){var h=q.length,i=new ArrayBuffer(h),l=new Uint8Array(i),o;for(o=0;o<h;o+=1)l[o]=q.charCodeAt(o);return m?l:i}function u(q){return String.fromCharCode.apply(null,new Uint8Array(q))}function p(q,m,h){var i=new Uint8Array(q.byteLength+m.byteLength);return i.set(new Uint8Array(q)),i.set(new Uint8Array(m),q.byteLength),h?i:i.buffer}function r(q){var m=[],h=q.length,i;for(i=0;i<h-1;i+=2)m.push(parseInt(q.substr(i,2),16));return String.fromCharCode.apply(String,m)}function t(){this.reset()}return t.prototype.append=function(q){return this.appendBinary(j(q)),this},t.prototype.appendBinary=function(q){this._buff+=q,this._length+=q.length;var m=this._buff.length,h;for(h=64;h<=m;h+=64)e(this._hash,f(this._buff.substring(h-64,h)));return this._buff=this._buff.substring(h-64),this},t.prototype.end=function(q){var m=this._buff,h=m.length,i,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o;for(i=0;i<h;i+=1)l[i>>2]|=m.charCodeAt(i)<<(i%4<<3);return this._finish(l,h),o=w(this._hash),q&&(o=r(o)),this.reset(),o},t.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},t.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},t.prototype.setState=function(q){return this._buff=q.buff,this._length=q.length,this._hash=q.hash,this},t.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},t.prototype._finish=function(q,m){var h=m,i,l,o;q[h>>2]|=128<<(h%4<<3);if(h>55)for(e(this._hash,q),h=0;h<16;h+=1)q[h]=0;i=this._length*8,i=i.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(i[2],16),o=parseInt(i[1],16)||0,q[14]=l,q[15]=o,e(this._hash,q)},t.hash=function(q,m){return t.hashBinary(j(q),m)},t.hashBinary=function(q,m){var h=k(q),i=w(h);return m?r(i):i},t.ArrayBuffer=function(){this.reset()},t.ArrayBuffer.prototype.append=function(q){var m=p(this._buff.buffer,q,!0),h=m.length,i;for(this._length+=q.byteLength,i=64;i<=h;i+=64)e(this._hash,g(m.subarray(i-64,i)));return this._buff=i-64<h?new Uint8Array(m.buffer.slice(i-64)):new Uint8Array(0),this},t.ArrayBuffer.prototype.end=function(q){var m=this._buff,h=m.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l,o;for(l=0;l<h;l+=1)i[l>>2]|=m[l]<<(l%4<<3);return this._finish(i,h),o=w(this._hash),q&&(o=r(o)),this.reset(),o},t.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},t.ArrayBuffer.prototype.getState=function(){var q=t.prototype.getState.call(this);return q.buff=u(q.buff),q},t.ArrayBuffer.prototype.setState=function(q){return q.buff=s(q.buff,!0),t.prototype.setState.call(this,q)},t.ArrayBuffer.prototype.destroy=t.prototype.destroy,t.ArrayBuffer.prototype._finish=t.prototype._finish,t.ArrayBuffer.hash=function(q,m){var h=n(new Uint8Array(q)),i=w(h);return m?r(i):i},t})}),ne=function a(b){var c=[];c.push({obj:b});for(var d="",e,f,g,k,n,v,w,j,s,u,p;e=c.pop();){f=e.obj,g=e.prefix||"",k=e.val||"",d+=g;if(k)d+=k;else if(typeof f!=="object")d+=typeof f==="undefined"?null:JSON.stringify(f);else if(f===null)d+="null";else if(Array.isArray(f)){for(c.push({val:"]"}),n=f.length-1;n>=0;n--)v=n===0?"":",",c.push({obj:f[n],prefix:v});c.push({val:"["})}else{w=[];for(j in f)f.hasOwnProperty(j)&&w.push(j);for(c.push({val:"}"}),n=w.length-1;n>=0;n--)s=w[n],u=f[s],p=n>0?",":"",p+=JSON.stringify(s)+":",c.push({obj:u,prefix:p});c.push({val:"{"})}}return d};function Oa(a,b,c){var d=c[c.length-1];a===d.element&&(c.pop(),d=c[c.length-1]);var e=d.element,f=d.index;if(Array.isArray(e))e.push(a);else if(f===b.length-2){var g=b.pop();e[g]=a}else b.push(a)}var oe=function(a){for(var b=[],c=[],d=0,e,f,g,k,n,v,w,j,s;;){e=a[d++];if(e==="}"||e==="]"||typeof e==="undefined"){if(b.length===1)return b.pop();{Oa(b.pop(),b,c);continue}}switch(e){case" ":case"	":case`
`:case":":case",":break;case"n":d+=3,Oa(null,b,c);break;case"t":d+=3,Oa(!0,b,c);break;case"f":d+=4,Oa(!1,b,c);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(f="",d--;;){g=a[d++];if(/[\d\.\-e\+]/.test(g))f+=g;else{d--;break}}Oa(parseFloat(f),b,c);break;case'"':for(k="",n=void 0,v=0;;){w=a[d++];if(w!=='"'||n==="\\"&&v%2===1)k+=w,n=w,n==="\\"?v++:v=0;else break}Oa(JSON.parse('"'+k+'"'),b,c);break;case"[":j={element:[],index:b.length},b.push(j.element),c.push(j);break;case"{":s={element:{},index:b.length},b.push(s.element),c.push(s);break;default:throw new Error("unexpectedly reached end of input: "+e)}}},xc={stringify:ne,parse:oe},Pa=pe;function pe(a){return function(){var b=arguments.length;if(b){for(var c=[],d=-1;++d<b;)c[d]=arguments[d];return a.call(this,c)}else return a.call(this,[])}}var qa=pc(function(a){typeof Object.create==="function"?a.exports=function b(c,d){d&&(c.super_=d,c.prototype=Object.create(d.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}))}:a.exports=function b(c,d){if(d){c.super_=d;var e=function(){};e.prototype=d.prototype,c.prototype=new e(),c.prototype.constructor=c}}}),qe;function Ba(){}Ba.prototype=Object.create(null);function U(){U.init.call(this)}U.EventEmitter=U,U.usingDomains=!1,U.prototype.domain=void 0,U.prototype._events=void 0,U.prototype._maxListeners=void 0,U.defaultMaxListeners=10,U.init=function(){this.domain=null,U.usingDomains&&qe.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new Ba(),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},U.prototype.setMaxListeners=function a(b){if(typeof b!=="number"||b<0||isNaN(b))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=b,this};function yc(a){return a._maxListeners===void 0?U.defaultMaxListeners:a._maxListeners}U.prototype.getMaxListeners=function a(){return yc(this)};function re(a,b,c){if(b)a.call(c);else for(var d=a.length,e=$a(a,d),f=0;f<d;++f)e[f].call(c)}function se(a,b,c,d){if(b)a.call(c,d);else for(var e=a.length,f=$a(a,e),g=0;g<e;++g)f[g].call(c,d)}function te(a,b,c,d,e){if(b)a.call(c,d,e);else for(var f=a.length,g=$a(a,f),k=0;k<f;++k)g[k].call(c,d,e)}function ue(a,b,c,d,e,f){if(b)a.call(c,d,e,f);else for(var g=a.length,k=$a(a,g),n=0;n<g;++n)k[n].call(c,d,e,f)}function ve(a,b,c,d){if(b)a.apply(c,d);else for(var e=a.length,f=$a(a,e),g=0;g<e;++g)f[g].apply(c,d)}U.prototype.emit=function a(b){var c,d,e,f,g,k,n,v=b==="error";k=this._events;if(k)v=v&&k.error==null;else if(!v)return!1;n=this.domain;if(v){c=arguments[1];if(n)c||(c=new Error('Uncaught, unspecified "error" event')),c.domainEmitter=this,c.domain=n,c.domainThrown=!1,n.emit("error",c);else{if(c instanceof Error)throw c;{var w=new Error('Uncaught, unspecified "error" event. ('+c+")");throw w.context=c,w}}return!1}d=k[b];if(!d)return!1;var j=typeof d==="function";e=arguments.length;switch(e){case 1:re(d,j,this);break;case 2:se(d,j,this,arguments[1]);break;case 3:te(d,j,this,arguments[1],arguments[2]);break;case 4:ue(d,j,this,arguments[1],arguments[2],arguments[3]);break;default:for(f=new Array(e-1),g=1;g<e;g++)f[g-1]=arguments[g];ve(d,j,this,f)}return!0};function zc(a,b,c,d){var e,f,g;if(typeof c!=="function")throw new TypeError('"listener" argument must be a function');f=a._events,f?(f.newListener&&(a.emit("newListener",b,c.listener?c.listener:c),f=a._events),g=f[b]):(f=a._events=new Ba(),a._eventsCount=0);if(!g)g=f[b]=c,++a._eventsCount;else{typeof g==="function"?g=f[b]=d?[c,g]:[g,c]:d?g.unshift(c):g.push(c);if(!g.warned){e=yc(a);if(e&&e>0&&g.length>e){g.warned=!0;var k=new Error("Possible EventEmitter memory leak detected. "+g.length+" "+b+" listeners added. Use emitter.setMaxListeners() to increase limit");k.name="MaxListenersExceededWarning",k.emitter=a,k.type=b,k.count=g.length,we(k)}}}return a}function we(a){typeof console.warn==="function"?console.warn(a):console.log(a)}U.prototype.addListener=function a(b,c){return zc(this,b,c,!1)},U.prototype.on=U.prototype.addListener,U.prototype.prependListener=function a(b,c){return zc(this,b,c,!0)};function Ac(a,b,c){var d=!1;function e(){a.removeListener(b,e),d||(d=!0,c.apply(a,arguments))}return e.listener=c,e}U.prototype.once=function a(b,c){if(typeof c!=="function")throw new TypeError('"listener" argument must be a function');return this.on(b,Ac(this,b,c)),this},U.prototype.prependOnceListener=function a(b,c){if(typeof c!=="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(b,Ac(this,b,c)),this},U.prototype.removeListener=function a(b,c){var d,e,f,g,k;if(typeof c!=="function")throw new TypeError('"listener" argument must be a function');e=this._events;if(!e)return this;d=e[b];if(!d)return this;if(d===c||d.listener&&d.listener===c)--this._eventsCount===0?this._events=new Ba():(delete e[b],e.removeListener&&this.emit("removeListener",b,d.listener||c));else if(typeof d!=="function"){for(f=-1,g=d.length;g-- >0;)if(d[g]===c||d[g].listener&&d[g].listener===c){k=d[g].listener,f=g;break}if(f<0)return this;if(d.length===1){d[0]=void 0;if(--this._eventsCount===0)return this._events=new Ba(),this;delete e[b]}else xe(d,f);e.removeListener&&this.emit("removeListener",b,k||c)}return this},U.prototype.removeAllListeners=function a(b){var c,d;d=this._events;if(!d)return this;if(!d.removeListener)return arguments.length===0?(this._events=new Ba(),this._eventsCount=0):d[b]&&(--this._eventsCount===0?this._events=new Ba():delete d[b]),this;if(arguments.length===0){for(var e=Object.keys(d),f=0,g;f<e.length;++f){g=e[f];if(g==="removeListener")continue;this.removeAllListeners(g)}return this.removeAllListeners("removeListener"),this._events=new Ba(),this._eventsCount=0,this}c=d[b];if(typeof c==="function")this.removeListener(b,c);else if(c)do this.removeListener(b,c[c.length-1]);while(c[0]);return this},U.prototype.listeners=function a(b){var c,d,e=this._events;return e?(c=e[b],c?typeof c==="function"?d=[c.listener||c]:d=ye(c):d=[]):d=[],d},U.listenerCount=function(a,b){return typeof a.listenerCount==="function"?a.listenerCount(b):Bc.call(a,b)},U.prototype.listenerCount=Bc;function Bc(a){var b=this._events;if(b){var c=b[a];if(typeof c==="function")return 1;if(c)return c.length}return 0}U.prototype.eventNames=function a(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function xe(a,b){for(var c=b,d=c+1,e=a.length;d<e;c+=1,d+=1)a[c]=a[d];a.pop()}function $a(a,b){for(var c=new Array(b);b--;)c[b]=a[b];return c}function ye(a){for(var b=new Array(a.length),c=0;c<b.length;++c)b[c]=a[c].listener||a[c];return b}function mb(a){return"$"+a}function ze(a){return a.substring(1)}function Ca(){this._store={}}Ca.prototype.get=function(a){var b=mb(a);return this._store[b]},Ca.prototype.set=function(a,b){var c=mb(a);return this._store[c]=b,!0},Ca.prototype.has=function(a){var b=mb(a);return b in this._store},Ca.prototype.delete=function(a){var b=mb(a),c=b in this._store;return delete this._store[b],c},Ca.prototype.forEach=function(a){for(var b=Object.keys(this._store),c=0,d=b.length;c<d;c++){var e=b[c],f=this._store[e];e=ze(e),a(f,e)}},Object.defineProperty(Ca.prototype,"size",{get:function(){return Object.keys(this._store).length}});function ab(a){this._store=new Ca();if(a&&Array.isArray(a))for(var b=0,c=a.length;b<c;b++)this.add(a[b])}ab.prototype.add=function(a){return this._store.set(a,!0)},ab.prototype.has=function(a){return this._store.has(a)},ab.prototype.forEach=function(a){this._store.forEach(function(b,c){a(c)})},Object.defineProperty(ab.prototype,"size",{get:function(){return this._store.size}});function Ae(){if(typeof Symbol==="undefined"||typeof Map==="undefined"||typeof Set==="undefined")return!1;var a=Object.getOwnPropertyDescriptor(Map,Symbol.species);return a&&"get"in a&&Map[Symbol.species]===Map}var Qa,ka;Ae()?(Qa=Set,ka=Map):(Qa=ab,ka=Ca);function Be(a){return typeof ArrayBuffer!=="undefined"&&a instanceof ArrayBuffer||typeof Blob!=="undefined"&&a instanceof Blob}function Ce(a){if(typeof a.slice==="function")return a.slice(0);var b=new ArrayBuffer(a.byteLength),c=new Uint8Array(b),d=new Uint8Array(a);return c.set(d),b}function De(a){if(a instanceof ArrayBuffer)return Ce(a);var b=a.size,c=a.type;return typeof a.slice==="function"?a.slice(0,b,c):a.webkitSlice(0,b,c)}var Cc=Function.prototype.toString,Ee=Cc.call(Object);function Fe(a){var b=Object.getPrototypeOf(a);if(b===null)return!0;var c=b.constructor;return typeof c=="function"&&c instanceof c&&Cc.call(c)==Ee}function fa(a){var b,c,d;if(!a||typeof a!=="object")return a;if(Array.isArray(a)){for(b=[],c=0,d=a.length;c<d;c++)b[c]=fa(a[c]);return b}if(a instanceof Date)return a.toISOString();if(Be(a))return De(a);if(!Fe(a))return a;b={};for(c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var e=fa(a[c]);typeof e!=="undefined"&&(b[c]=e)}return b}function Dc(a){var b=!1;return Pa(function(c){if(b)throw new Error("once called more than once");b=!0,a.apply(this,c)})}function Ec(a){return Pa(function(b){b=fa(b);var c=this,d=typeof b[b.length-1]==="function"?b.pop():!1,e=new Promise(function(f,g){var k;try{var n=Dc(function(v,w){v?g(v):f(w)});b.push(n),k=a.apply(c,b),k&&typeof k.then==="function"&&f(k)}catch(v){g(v)}});return d&&e.then(function(f){d(null,f)},d),e})}function Ge(a,b,c){if(a.constructor.listeners("debug").length){for(var d=["api",a.name,b],e=0;e<c.length-1;e++)d.push(c[e]);a.constructor.emit("debug",d);var f=c[c.length-1];c[c.length-1]=function(g,k){var n=["api",a.name,b];n=n.concat(g?["error",g]:["success",k]),a.constructor.emit("debug",n),f(g,k)}}}function da(a,b){return Ec(Pa(function(c){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var d=this;return Ge(d,a,c),this.taskqueue.isReady?b.apply(this,c):new Promise(function(e,f){d.taskqueue.addTask(function(g){g?f(g):e(d[a].apply(d,c))})})}))}function bb(a,b){for(var c={},d=0,e=b.length;d<e;d++){var f=b[d];f in a&&(c[f]=a[f])}return c}var He=6;function Fc(a){return a}function Ie(a){return[{ok:a}]}function Gc(a,b,c){var d=b.docs,e=new ka();d.forEach(function(r){e.has(r.id)?e.get(r.id).push(r):e.set(r.id,[r])});var f=e.size,g=0,k=new Array(f);function n(){var r=[];k.forEach(function(t){t.docs.forEach(function(q){r.push({id:t.id,docs:[q]})})}),c(null,{results:r})}function v(){++g===f&&n()}function w(r,t,q){k[r]={id:t,docs:q},v()}var j=[];e.forEach(function(r,t){j.push(t)});var s=0;function u(){if(s>=j.length)return;var r=Math.min(s+He,j.length),t=j.slice(s,r);p(t,s),s+=t.length}function p(r,t){r.forEach(function(q,m){var h=t+m,i=e.get(q),l=bb(i[0],["atts_since","attachments"]);l.open_revs=i.map(function(B){return B.rev}),l.open_revs=l.open_revs.filter(Fc);var o=Fc;l.open_revs.length===0&&(delete l.open_revs,o=Ie),["revs","attachments","binary","ajax","latest"].forEach(function(B){B in b&&(l[B]=b[B])}),a.get(q,l,function(B,G){var I;B?I=[{error:B}]:I=o(G),w(h,q,I),u()})})}u()}var Db;try{localStorage.setItem("_pouch_check_localstorage",1),Db=!!localStorage.getItem("_pouch_check_localstorage")}catch(a){Db=!1}function nb(){return Db}qa(Ra,U);function Je(a){nb()&&addEventListener("storage",function(b){a.emit(b.key)})}function Ra(){U.call(this),this._listeners={},Je(this)}Ra.prototype.addListener=function(a,b,c,d){if(this._listeners[b])return;var e=this,f=!1;function g(){if(!e._listeners[b])return;if(f){f="waiting";return}f=!0;var k=bb(d,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function n(){f=!1}c.changes(k).on("change",function(v){v.seq>d.since&&!d.cancelled&&(d.since=v.seq,d.onChange(v))}).on("complete",function(){f==="waiting"&&ua(g),f=!1}).on("error",n)}this._listeners[b]=g,this.on(a,g)},Ra.prototype.removeListener=function(a,b){if(!(b in this._listeners))return;U.prototype.removeListener.call(this,a,this._listeners[b]),delete this._listeners[b]},Ra.prototype.notifyLocalWindows=function(a){nb()&&(localStorage[a]=localStorage[a]==="a"?"b":"a")},Ra.prototype.notify=function(a){this.emit(a),this.notifyLocalWindows(a)};function na(a){if(typeof console!=="undefined"&&typeof console[a]==="function"){var b=Array.prototype.slice.call(arguments,1);console[a].apply(console,b)}}function Ke(a,b){var c=6e5;a=parseInt(a,10)||0,b=parseInt(b,10),b!==b||b<=a?b=(a||1)<<1:b=b+1,b>c&&(a=c>>1,b=c);var d=Math.random(),e=b-a;return~~(e*d+a)}function Le(a){var b=0;return a||(b=2e3),Ke(a,b)}function Eb(a,b){na("info","The above "+a+" is totally normal. "+b)}var Fb;typeof Object.assign==="function"?Fb=Object.assign:Fb=function(a){for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(d!=null)for(var e in d)Object.prototype.hasOwnProperty.call(d,e)&&(b[e]=d[e])}return b};var Sa=Fb;qa($,Error);function $(a,b,c){Error.call(this,c),this.status=a,this.name=b,this.message=c,this.error=!0}$.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var ph=new $(401,"unauthorized","Name or password is incorrect."),Me=new $(400,"bad_request","Missing JSON list of 'docs'"),ra=new $(404,"not_found","missing"),Ta=new $(409,"conflict","Document update conflict"),Hc=new $(400,"bad_request","_id field must contain a string"),Ne=new $(412,"missing_id","_id is required for puts"),Oe=new $(400,"bad_request","Only reserved document ids may start with underscore."),qh=new $(412,"precondition_failed","Database not open"),Ic=new $(500,"unknown_error","Database encountered an unknown error"),Jc=new $(500,"badarg","Some query argument is invalid"),rh=new $(400,"invalid_request","Request was invalid"),Pe=new $(400,"query_parse_error","Some query parameter is invalid"),Kc=new $(500,"doc_validation","Bad special document member"),ob=new $(400,"bad_request","Something wrong with the request"),Gb=new $(400,"bad_request","Document must be a JSON object"),sh=new $(404,"not_found","Database not found"),Hb=new $(500,"indexed_db_went_bad","unknown"),th=new $(500,"web_sql_went_bad","unknown"),uh=new $(500,"levelDB_went_went_bad","unknown"),vh=new $(403,"forbidden","Forbidden by design doc validate_doc_update function"),Lc=new $(400,"bad_request","Invalid rev format"),wh=new $(412,"file_exists","The database could not be created, the file already exists."),Qe=new $(412,"missing_stub","A pre-existing attachment stub wasn't found"),xh=new $(413,"invalid_url","Provided URL is invalid");function V(a,b){function c(d){for(var e=Object.getOwnPropertyNames(a),f=0,g=e.length;f<g;f++)typeof a[e[f]]!=="function"&&(this[e[f]]=a[e[f]]);d!==void 0&&(this.reason=d)}return c.prototype=$.prototype,new c(b)}function Ua(a){if(typeof a!=="object"){var b=a;a=Ic,a.data=b}return"error"in a&&a.error==="conflict"&&(a.name="conflict",a.status=409),"name"in a||(a.name=a.error||"unknown"),"status"in a||(a.status=500),"message"in a||(a.message=a.message||a.reason),a}function Re(a,b,c){try{return!a(b,c)}catch(e){var d="Filter function threw: "+e.toString();return V(ob,d)}}function Ib(a){var b={},c=a.filter&&typeof a.filter==="function";return b.query=a.query_params,function d(e){e.doc||(e.doc={});var f=c&&Re(a.filter,e.doc,b);if(typeof f==="object")return f;if(f)return!1;if(!a.include_docs)delete e.doc;else if(!a.attachments)for(var g in e.doc._attachments)e.doc._attachments.hasOwnProperty(g)&&(e.doc._attachments[g].stub=!0);return!0}}function pb(a){for(var b=[],c=0,d=a.length;c<d;c++)b=b.concat(a[c]);return b}function Mc(a){var b;a?typeof a!=="string"?b=V(Hc):/^_/.test(a)&&!/^_(design|local)/.test(a)&&(b=V(Oe)):b=V(Ne);if(b)throw b}function va(a){return typeof a._remote==="boolean"?a._remote:typeof a.type==="function"?(na("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),a.type()==="http"):!1}function Se(a,b){return"listenerCount"in a?a.listenerCount(b):U.listenerCount(a,b)}function Jb(a){if(!a)return null;var b=a.split("/");return b.length===2?b:b.length===1?[a,a]:null}function Nc(a){var b=Jb(a);return b?b.join("/"):null}var Oc=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Pc="queryKey",Te=/(?:^|&)([^&=]*)=?([^&]*)/g,Ue=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function Qc(a){for(var b=Ue.exec(a),c={},d=14;d--;){var e=Oc[d],f=b[d]||"",g=["user","password"].indexOf(e)!==-1;c[e]=g?decodeURIComponent(f):f}return c[Pc]={},c[Oc[12]].replace(Te,function(k,n,v){n&&(c[Pc][n]=v)}),c}function Kb(a,b){var c=[],d=[];for(var e in b)b.hasOwnProperty(e)&&(c.push(e),d.push(b[e]));return c.push(a),Function.apply(null,c).apply(null,d)}function qb(a,b,c){return new Promise(function(d,e){a.get(b,function(f,g){if(f){if(f.status!==404)return e(f);g={}}var k=g._rev,n=c(g);if(!n)return d({updated:!1,rev:k});n._id=b,n._rev=k,d(Ve(a,n,c))})})}function Ve(a,b,c){return a.put(b).then(function(d){return{updated:!0,rev:d.rev}},function(d){if(d.status!==409)throw d;return qb(a,b._id,c)})}var Lb=function(a){return atob(a)},cb=function(a){return btoa(a)};function Mb(a,b){a=a||[],b=b||{};try{return new Blob(a,b)}catch(f){if(f.name!=="TypeError")throw f;for(var c=typeof BlobBuilder!=="undefined"?BlobBuilder:typeof MSBlobBuilder!=="undefined"?MSBlobBuilder:typeof MozBlobBuilder!=="undefined"?MozBlobBuilder:WebKitBlobBuilder,d=new c(),e=0;e<a.length;e+=1)d.append(a[e]);return d.getBlob(b.type)}}function We(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++)d[e]=a.charCodeAt(e);return c}function Nb(a,b){return Mb([We(a)],{type:b})}function Ob(a,b){return Nb(Lb(a),b)}function Xe(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;e<d;e++)b+=String.fromCharCode(c[e]);return b}function Rc(a,b){var c=new FileReader(),d=typeof c.readAsBinaryString==="function";c.onloadend=function(e){var f=e.target.result||"";if(d)return b(f);b(Xe(f))},d?c.readAsBinaryString(a):c.readAsArrayBuffer(a)}function Sc(a,b){Rc(a,function(c){b(c)})}function Pb(a,b){Sc(a,function(c){b(cb(c))})}function Ye(a,b){var c=new FileReader();c.onloadend=function(d){var e=d.target.result||new ArrayBuffer(0);b(e)},c.readAsArrayBuffer(a)}var Ze=self.setImmediate||self.setTimeout,_e=32768;function $e(a){return cb(a)}function af(a,b,c){return a.webkitSlice?a.webkitSlice(b,c):a.slice(b,c)}function bf(a,b,c,d,e){(c>0||d<b.size)&&(b=af(b,c,d)),Ye(b,function(f){a.append(f),e()})}function cf(a,b,c,d,e){(c>0||d<b.length)&&(b=b.substring(c,d)),a.appendBinary(b),e()}function Qb(a,b){var c=typeof a==="string",d=c?a.length:a.size,e=Math.min(_e,d),f=Math.ceil(d/e),g=0,k=c?new Cb():new Cb.ArrayBuffer(),n=c?cf:bf;function v(){Ze(j)}function w(){var s=k.end(!0),u=$e(s);b(u),k.destroy()}function j(){var s=g*e,u=s+e;g++,g<f?n(k,a,s,u,v):n(k,a,s,u,w)}j()}function Tc(a){return Cb.hash(a)}function Uc(a,b){var c=fa(a);return b?(delete c._rev_tree,Tc(JSON.stringify(c))):wc().replace(/-/g,"").toLowerCase()}var rb=wc;function Ea(a){for(var b,c,d,e=a.rev_tree.slice(),f;f=e.pop();){var g=f.ids,k=g[2],n=f.pos;if(k.length){for(var v=0,w=k.length;v<w;v++)e.push({pos:n+1,ids:k[v]});continue}var j=!!g[1].deleted,s=g[0];(!b||(d!==j?d:c!==n?c<n:b<s))&&(b=s,c=n,d=j)}return c+"-"+b}function Fa(a,b){for(var c=a.slice(),d;d=c.pop();)for(var e=d.pos,f=d.ids,g=f[2],k=b(g.length===0,e,f[0],d.ctx,f[1]),n=0,v=g.length;n<v;n++)c.push({pos:e+1,ids:g[n],ctx:k})}function df(a,b){return a.pos-b.pos}function Rb(a){var b=[];Fa(a,function(e,f,g,k,n){e&&b.push({rev:f+"-"+g,pos:f,opts:n})}),b.sort(df).reverse();for(var c=0,d=b.length;c<d;c++)delete b[c].pos;return b}function Sb(a){for(var b=Ea(a),c=Rb(a.rev_tree),d=[],e=0,f=c.length;e<f;e++){var g=c[e];g.rev!==b&&!g.opts.deleted&&d.push(g.rev)}return d}function ef(a){var b=[];return Fa(a.rev_tree,function(c,d,e,f,g){g.status==="available"&&!c&&(b.push(d+"-"+e),g.status="missing")}),b}function Vc(a){for(var b=[],c=a.slice(),d;d=c.pop();){var e=d.pos,f=d.ids,g=f[0],k=f[1],n=f[2],v=n.length===0,w=d.history?d.history.slice():[];w.push({id:g,opts:k}),v&&b.push({pos:e+1-w.length,ids:w});for(var j=0,s=n.length;j<s;j++)c.push({pos:e+1,ids:n[j],history:w})}return b.reverse()}function ff(a,b){return a.pos-b.pos}function gf(a,b,c){for(var d=0,e=a.length,f;d<e;)f=d+e>>>1,c(a[f],b)<0?d=f+1:e=f;return d}function hf(a,b,c){var d=gf(a,b,c);a.splice(d,0,b)}function Wc(a,b){for(var c,d,e=b,f=a.length;e<f;e++){var g=a[e],k=[g.id,g.opts,[]];d?(d[2].push(k),d=k):c=d=k}return c}function jf(a,b){return a[0]<b[0]?-1:1}function Xc(a,b){for(var c=[{tree1:a,tree2:b}],d=!1;c.length>0;){var e=c.pop(),f=e.tree1,g=e.tree2;(f[1].status||g[1].status)&&(f[1].status=f[1].status==="available"||g[1].status==="available"?"available":"missing");for(var k=0;k<g[2].length;k++){if(!f[2][0]){d="new_leaf",f[2][0]=g[2][k];continue}for(var n=!1,v=0;v<f[2].length;v++)f[2][v][0]===g[2][k][0]&&(c.push({tree1:f[2][v],tree2:g[2][k]}),n=!0);n||(d="new_branch",hf(f[2],g[2][k],jf))}}return{conflicts:d,tree:a}}function Yc(a,b,c){var d=[],e=!1,f=!1,g;if(!a.length)return{tree:[b],conflicts:"new_leaf"};for(var k=0,n=a.length;k<n;k++){var v=a[k];if(v.pos===b.pos&&v.ids[0]===b.ids[0])g=Xc(v.ids,b.ids),d.push({pos:v.pos,ids:g.tree}),e=e||g.conflicts,f=!0;else if(c!==!0){var w=v.pos<b.pos?v:b,j=v.pos<b.pos?b:v,s=j.pos-w.pos,u=[],p=[];for(p.push({ids:w.ids,diff:s,parent:null,parentIdx:null});p.length>0;){var r=p.pop();if(r.diff===0){r.ids[0]===j.ids[0]&&u.push(r);continue}for(var t=r.ids[2],q=0,m=t.length;q<m;q++)p.push({ids:t[q],diff:r.diff-1,parent:r.ids,parentIdx:q})}var h=u[0];h?(g=Xc(h.ids,j.ids),h.parent[2][h.parentIdx]=g.tree,d.push({pos:w.pos,ids:w.ids}),e=e||g.conflicts,f=!0):d.push(v)}else d.push(v)}return f||d.push(b),d.sort(ff),{tree:d,conflicts:e||"internal_node"}}function kf(a,b){for(var c=Vc(a),d,e,f=0,g=c.length;f<g;f++){var k=c[f],n=k.ids,v;if(n.length>b){d||(d={});var w=n.length-b;v={pos:k.pos+w,ids:Wc(n,w)};for(var j=0;j<w;j++){var s=k.pos+j+"-"+n[j].id;d[s]=!0}}else v={pos:k.pos,ids:Wc(n,0)};e?e=Yc(e,v,!0).tree:e=[v]}return d&&Fa(e,function(u,p,r){delete d[p+"-"+r]}),{tree:e,revs:d?Object.keys(d):[]}}function Zc(a,b,c){var d=Yc(a,b),e=kf(d.tree,c);return{tree:e.tree,stemmedRevs:e.revs,conflicts:d.conflicts}}function lf(a,b){for(var c=a.slice(),d=b.split("-"),e=parseInt(d[0],10),f=d[1],g;g=c.pop();){if(g.pos===e&&g.ids[0]===f)return!0;for(var k=g.ids[2],n=0,v=k.length;n<v;n++)c.push({pos:g.pos+1,ids:k[n]})}return!1}function mf(a){return a.ids}function za(a,b){b||(b=Ea(a));for(var c=b.substring(b.indexOf("-")+1),d=a.rev_tree.map(mf),e;e=d.pop();){if(e[0]===c)return!!e[1].deleted;d=d.concat(e[2])}}function Ga(a){return/^_local/.test(a)}function nf(a,b){for(var c=b.rev_tree.slice(),d;d=c.pop();){var e=d.pos,f=d.ids,g=f[0],k=f[1],n=f[2],v=n.length===0,w=d.history?d.history.slice():[];w.push({id:g,pos:e,opts:k});if(v)for(var j=0,s=w.length;j<s;j++){var u=w[j],p=u.pos+"-"+u.id;if(p===a)return e+"-"+g}for(var r=0,t=n.length;r<t;r++)c.push({pos:e+1,ids:n[r],history:w})}throw new Error("Unable to resolve latest revision for id "+b.id+", rev "+a)}qa(db,U);function of(a,b,c,d){try{a.emit("change",b,c,d)}catch(e){na("error",'Error in .on("change", function):',e)}}function db(a,b,c){U.call(this);var d=this;this.db=a,b=b?fa(b):{};var e=b.complete=Dc(function(k,n){k?Se(d,"error")>0&&d.emit("error",k):d.emit("complete",n),d.removeAllListeners(),a.removeListener("destroyed",f)});c&&(d.on("complete",function(k){c(null,k)}),d.on("error",c));function f(){d.cancel()}a.once("destroyed",f),b.onChange=function(k,n,v){if(d.isCancelled)return;of(d,k,n,v)};var g=new Promise(function(k,n){b.complete=function(v,w){v?n(v):k(w)}});d.once("cancel",function(){a.removeListener("destroyed",f),b.complete(null,{status:"cancelled"})}),this.then=g.then.bind(g),this.catch=g.catch.bind(g),this.then(function(k){e(null,k)},e),a.taskqueue.isReady?d.validateChanges(b):a.taskqueue.addTask(function(k){k?b.complete(k):d.isCancelled?d.emit("cancel"):d.validateChanges(b)})}db.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")};function pf(a,b,c){var d=[{rev:a._rev}];c.style==="all_docs"&&(d=Rb(b.rev_tree).map(function(f){return{rev:f.rev}}));var e={id:b.id,changes:d,doc:a};return za(b,a._rev)&&(e.deleted=!0),c.conflicts&&(e.doc._conflicts=Sb(b),e.doc._conflicts.length||delete e.doc._conflicts),e}db.prototype.validateChanges=function(a){var b=a.complete,c=this;S._changesFilterPlugin?S._changesFilterPlugin.validate(a,function(d){if(d)return b(d);c.doChanges(a)}):c.doChanges(a)},db.prototype.doChanges=function(a){var b=this,c=a.complete;a=fa(a),"live"in a&&!("continuous"in a)&&(a.continuous=a.live),a.processChange=pf,a.since==="latest"&&(a.since="now"),a.since||(a.since=0);if(a.since==="now"){this.db.info().then(function(f){if(b.isCancelled){c(null,{status:"cancelled"});return}a.since=f.update_seq,b.doChanges(a)},c);return}if(S._changesFilterPlugin){S._changesFilterPlugin.normalize(a);if(S._changesFilterPlugin.shouldFilter(this,a))return S._changesFilterPlugin.filter(this,a)}else["doc_ids","filter","selector","view"].forEach(function(f){f in a&&na("warn",'The "'+f+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in a||(a.descending=!1),a.limit=a.limit===0?1:a.limit,a.complete=c;var d=this.db._changes(a);if(d&&typeof d.cancel==="function"){var e=b.cancel;b.cancel=Pa(function(f){d.cancel(),e.apply(this,f)})}};function _c(a,b){return a<b?-1:a>b?1:0}function Tb(a,b){return function(c,d){c||d[0]&&d[0].error?(c=c||d[0],c.docId=b,a(c)):a(null,d.length?d[0]:d)}}function qf(a){for(var b=0;b<a.length;b++){var c=a[b];if(c._deleted)delete c._attachments;else if(c._attachments)for(var d=Object.keys(c._attachments),e=0;e<d.length;e++){var f=d[e];c._attachments[f]=bb(c._attachments[f],["data","digest","content_type","length","revpos","stub"])}}}function rf(a,b){var c=_c(a._id,b._id);if(c!==0)return c;var d=a._revisions?a._revisions.start:0,e=b._revisions?b._revisions.start:0;return _c(d,e)}function sf(a){var b={},c=[];return Fa(a,function(d,e,f,g){var k=e+"-"+f;return d&&(b[k]=0),g!==void 0&&c.push({from:g,to:k}),k}),c.reverse(),c.forEach(function(d){b[d.from]===void 0?b[d.from]=1+b[d.to]:b[d.from]=Math.min(b[d.from],1+b[d.to])}),b}function tf(a){var b="limit"in a?a.keys.slice(a.skip,a.limit+a.skip):a.skip>0?a.keys.slice(a.skip):a.keys;a.keys=b,a.skip=0,delete a.limit,a.descending&&(b.reverse(),a.descending=!1)}function $c(a){var b=a._compactionQueue[0],c=b.opts,d=b.callback;a.get("_local/compaction").catch(function(){return!1}).then(function(e){e&&e.last_seq&&(c.last_seq=e.last_seq),a._compact(c,function(f,g){f?d(f):d(null,g),ua(function(){a._compactionQueue.shift(),a._compactionQueue.length&&$c(a)})})})}function uf(a){return a.charAt(0)==="_"?a+" is not a valid attachment name, attachment names cannot start with '_'":!1}qa(ba,U);function ba(){U.call(this);for(var a in ba.prototype)typeof this[a]==="function"&&(this[a]=this[a].bind(this))}ba.prototype.post=da("post",function(a,b,c){typeof b==="function"&&(c=b,b={});if(typeof a!=="object"||Array.isArray(a))return c(V(Gb));this.bulkDocs({docs:[a]},b,Tb(c,a._id))}),ba.prototype.put=da("put",function(a,b,c){typeof b==="function"&&(c=b,b={});if(typeof a!=="object"||Array.isArray(a))return c(V(Gb));Mc(a._id);if(Ga(a._id)&&typeof this._putLocal==="function")return a._deleted?this._removeLocal(a,c):this._putLocal(a,c);var d=this;b.force&&a._rev?(e(),f(function(g){var k=g?null:{ok:!0,id:a._id,rev:a._rev};c(g,k)})):f(c);function e(){var g=a._rev.split("-"),k=g[1],n=parseInt(g[0],10),v=n+1,w=Uc();a._revisions={start:v,ids:[w,k]},a._rev=v+"-"+w,b.new_edits=!1}function f(g){typeof d._put==="function"&&b.new_edits!==!1?d._put(a,b,g):d.bulkDocs({docs:[a]},b,Tb(g,a._id))}}),ba.prototype.putAttachment=da("putAttachment",function(a,b,c,d,e){var f=this;typeof e==="function"&&(e=d,d=c,c=null),typeof e==="undefined"&&(e=d,d=c,c=null),e||na("warn","Attachment",b,"on document",a,"is missing content_type");function g(k){var n="_rev"in k?parseInt(k._rev,10):0;return k._attachments=k._attachments||{},k._attachments[b]={content_type:e,data:d,revpos:++n},f.put(k)}return f.get(a).then(function(k){if(k._rev!==c)throw V(Ta);return g(k)},function(k){if(k.reason===ra.message)return g({_id:a});throw k})}),ba.prototype.removeAttachment=da("removeAttachment",function(a,b,c,d){var e=this;e.get(a,function(f,g){if(f){d(f);return}if(g._rev!==c){d(V(Ta));return}if(!g._attachments)return d();delete g._attachments[b],Object.keys(g._attachments).length===0&&delete g._attachments,e.put(g,d)})}),ba.prototype.remove=da("remove",function(a,b,c,d){var e;typeof b==="string"?(e={_id:a,_rev:b},typeof c==="function"&&(d=c,c={})):(e=a,typeof b==="function"?(d=b,c={}):(d=c,c=b)),c=c||{},c.was_delete=!0;var f={_id:e._id,_rev:e._rev||c.rev};f._deleted=!0;if(Ga(f._id)&&typeof this._removeLocal==="function")return this._removeLocal(e,d);this.bulkDocs({docs:[f]},c,Tb(d,f._id))}),ba.prototype.revsDiff=da("revsDiff",function(a,b,c){typeof b==="function"&&(c=b,b={});var d=Object.keys(a);if(!d.length)return c(null,{});var e=0,f=new ka();function g(n,v){f.has(n)||f.set(n,{missing:[]}),f.get(n).missing.push(v)}function k(n,v){var w=a[n].slice(0);Fa(v,function(j,s,u,p,r){var t=s+"-"+u,q=w.indexOf(t);if(q===-1)return;w.splice(q,1),r.status!=="available"&&g(n,t)}),w.forEach(function(j){g(n,j)})}d.map(function(n){this._getRevisionTree(n,function(v,w){if(v&&v.status===404&&v.message==="missing")f.set(n,{missing:a[n]});else{if(v)return c(v);k(n,w)}if(++e===d.length){var j={};return f.forEach(function(s,u){j[u]=s}),c(null,j)}})},this)}),ba.prototype.bulkGet=da("bulkGet",function(a,b){Gc(this,a,b)}),ba.prototype.compactDocument=da("compactDocument",function(a,b,c){var d=this;this._getRevisionTree(a,function(e,f){if(e)return c(e);var g=sf(f),k=[],n=[];Object.keys(g).forEach(function(v){g[v]>b&&k.push(v)}),Fa(f,function(v,w,j,s,u){var p=w+"-"+j;u.status==="available"&&k.indexOf(p)!==-1&&n.push(p)}),d._doCompaction(a,n,c)})}),ba.prototype.compact=da("compact",function(a,b){typeof a==="function"&&(b=a,a={});var c=this;a=a||{},c._compactionQueue=c._compactionQueue||[],c._compactionQueue.push({opts:a,callback:b}),c._compactionQueue.length===1&&$c(c)}),ba.prototype._compact=function(a,b){var c=this,d={return_docs:!1,last_seq:a.last_seq||0},e=[];function f(k){e.push(c.compactDocument(k.id,0))}function g(k){var n=k.last_seq;Promise.all(e).then(function(){return qb(c,"_local/compaction",function v(w){return!w.last_seq||w.last_seq<n?(w.last_seq=n,w):!1})}).then(function(){b(null,{ok:!0})}).catch(b)}c.changes(d).on("change",f).on("complete",g).on("error",b)},ba.prototype.get=da("get",function(a,b,c){typeof b==="function"&&(c=b,b={});if(typeof a!=="string")return c(V(Hc));if(Ga(a)&&typeof this._getLocal==="function")return this._getLocal(a,c);var d=[],e=this;function f(){var n=[],v=d.length;if(!v)return c(null,n);d.forEach(function(w){e.get(a,{rev:w,revs:b.revs,latest:b.latest,attachments:b.attachments,binary:b.binary},function(j,s){if(j)n.push({missing:w});else{for(var u,p=0,r=n.length;p<r;p++)if(n[p].ok&&n[p].ok._rev===s._rev){u=!0;break}u||n.push({ok:s})}v--,v||c(null,n)})})}if(b.open_revs){if(b.open_revs==="all")this._getRevisionTree(a,function(n,v){if(n)return c(n);d=Rb(v).map(function(w){return w.rev}),f()});else if(Array.isArray(b.open_revs)){d=b.open_revs;for(var g=0;g<d.length;g++){var k=d[g];if(!(typeof k==="string"&&/^\d+-/.test(k)))return c(V(Lc))}f()}else return c(V(Ic,"function_clause"));return}return this._get(a,b,function(n,v){if(n)return n.docId=a,c(n);var w=v.doc,j=v.metadata,s=v.ctx;if(b.conflicts){var u=Sb(j);u.length&&(w._conflicts=u)}za(j,w._rev)&&(w._deleted=!0);if(b.revs||b.revs_info){for(var p=w._rev.split("-"),r=parseInt(p[0],10),t=p[1],q=Vc(j.rev_tree),m=null,h=0;h<q.length;h++){var i=q[h],l=i.ids.map(function(R){return R.id}).indexOf(t),o=l===r-1;(o||!m&&l!==-1)&&(m=i)}if(!m)return n=new Error("invalid rev tree"),n.docId=a,c(n);var B=m.ids.map(function(R){return R.id}).indexOf(w._rev.split("-")[1])+1,G=m.ids.length-B;m.ids.splice(B,G),m.ids.reverse(),b.revs&&(w._revisions={start:m.pos+m.ids.length-1,ids:m.ids.map(function(R){return R.id})});if(b.revs_info){var I=m.pos+m.ids.length;w._revs_info=m.ids.map(function(R){return I--,{rev:I+"-"+R.id,status:R.opts.status}})}}if(b.attachments&&w._attachments){var H=w._attachments,P=Object.keys(H).length;if(P===0)return c(null,w);Object.keys(H).forEach(function(R){this._getAttachment(w._id,R,H[R],{rev:w._rev,binary:b.binary,ctx:s},function(Q,N){var X=w._attachments[R];X.data=N,delete X.stub,delete X.length,--P||c(null,w)})},e)}else{if(w._attachments)for(var T in w._attachments)w._attachments.hasOwnProperty(T)&&(w._attachments[T].stub=!0);c(null,w)}})}),ba.prototype.getAttachment=da("getAttachment",function(a,b,c,d){var e=this;c instanceof Function&&(d=c,c={}),this._get(a,c,function(f,g){if(f)return d(f);if(g.doc._attachments&&g.doc._attachments[b])c.ctx=g.ctx,c.binary=!0,e._getAttachment(a,b,g.doc._attachments[b],c,d);else return d(V(ra))})}),ba.prototype.allDocs=da("allDocs",function(a,b){typeof a==="function"&&(b=a,a={}),a.skip=typeof a.skip!=="undefined"?a.skip:0,a.start_key&&(a.startkey=a.start_key),a.end_key&&(a.endkey=a.end_key);if("keys"in a){if(!Array.isArray(a.keys))return b(new TypeError("options.keys must be an array"));var c=["startkey","endkey","key"].filter(function(d){return d in a})[0];if(c){b(V(Pe,"Query parameter `"+c+"` is not compatible with multi-get"));return}if(!va(this)){tf(a);if(a.keys.length===0)return this._allDocs({limit:0},b)}}return this._allDocs(a,b)}),ba.prototype.changes=function(a,b){return typeof a==="function"&&(b=a,a={}),a=a||{},a.return_docs="return_docs"in a?a.return_docs:!a.live,new db(this,a,b)},ba.prototype.close=da("close",function(a){return this._closed=!0,this.emit("closed"),this._close(a)}),ba.prototype.info=da("info",function(a){var b=this;this._info(function(c,d){if(c)return a(c);d.db_name=d.db_name||b.name,d.auto_compaction=!!(b.auto_compaction&&!va(b)),d.adapter=b.adapter,a(null,d)})}),ba.prototype.id=da("id",function(a){return this._id(a)}),ba.prototype.type=function(){return typeof this._type==="function"?this._type():this.adapter},ba.prototype.bulkDocs=da("bulkDocs",function(a,b,c){typeof b==="function"&&(c=b,b={}),b=b||{},Array.isArray(a)&&(a={docs:a});if(!a||!a.docs||!Array.isArray(a.docs))return c(V(Me));for(var d=0;d<a.docs.length;++d)if(typeof a.docs[d]!=="object"||Array.isArray(a.docs[d]))return c(V(Gb));var e;a.docs.forEach(function(k){k._attachments&&Object.keys(k._attachments).forEach(function(n){e=e||uf(n),k._attachments[n].content_type||na("warn","Attachment",n,"on document",k._id,"is missing content_type")})});if(e)return c(V(ob,e));"new_edits"in b||("new_edits"in a?b.new_edits=a.new_edits:b.new_edits=!0);var f=this;!b.new_edits&&!va(f)&&a.docs.sort(rf),qf(a.docs);var g=a.docs.map(function(k){return k._id});return this._bulkDocs(a,b,function(k,n){if(k)return c(k);b.new_edits||(n=n.filter(function(j){return j.error}));if(!va(f))for(var v=0,w=n.length;v<w;v++)n[v].id=n[v].id||g[v];c(null,n)})}),ba.prototype.registerDependentDatabase=da("registerDependentDatabase",function(a,b){var c=new this.constructor(a,this.__opts);function d(e){return e.dependentDbs=e.dependentDbs||{},e.dependentDbs[a]?!1:(e.dependentDbs[a]=!0,e)}qb(this,"_local/_pouch_dependentDbs",d).then(function(){b(null,{db:c})}).catch(b)}),ba.prototype.destroy=da("destroy",function(a,b){typeof a==="function"&&(b=a,a={});var c=this,d="use_prefix"in c?c.use_prefix:!0;function e(){c._destroy(a,function(f,g){if(f)return b(f);c._destroyed=!0,c.emit("destroyed"),b(null,g||{ok:!0})})}if(va(c))return e();c.get("_local/_pouch_dependentDbs",function(f,g){if(f)return f.status!==404?b(f):e();var k=g.dependentDbs,n=c.constructor,v=Object.keys(k).map(function(w){var j=d?w.replace(new RegExp("^"+n.prefix),""):w;return new n(j,c.__opts).destroy()});Promise.all(v).then(e,b)})});function eb(){this.isReady=!1,this.failed=!1,this.queue=[]}eb.prototype.execute=function(){var a;if(this.failed)for(;a=this.queue.shift();)a(this.failed);else for(;a=this.queue.shift();)a()},eb.prototype.fail=function(a){this.failed=a,this.execute()},eb.prototype.ready=function(a){this.isReady=!0,this.db=a,this.execute()},eb.prototype.addTask=function(a){this.queue.push(a),this.failed&&this.execute()};function vf(a,b){var c=a.match(/([a-z-]*):\/\/(.*)/);if(c)return{name:/https?/.test(c[1])?c[1]+"://"+c[2]:c[2],adapter:c[1]};var d=S.adapters,e=S.preferredAdapters,f=S.prefix,g=b.adapter;if(!g)for(var k=0;k<e.length;++k){g=e[k];if(g==="idb"&&"websql"in d&&nb()&&localStorage["_pouch__websqldb_"+f+a]){na("log",'PouchDB is downgrading "'+a+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}var n=d[g],v=n&&"use_prefix"in n?n.use_prefix:!0;return{name:v?f+a:a,adapter:g}}function wf(a){function b(d){a.removeListener("closed",c),d||a.constructor.emit("destroyed",a.name)}function c(){a.removeListener("destroyed",b),a.constructor.emit("unref",a)}a.once("destroyed",b),a.once("closed",c),a.constructor.emit("ref",a)}qa(S,ba);function S(a,b){if(!(this instanceof S))return new S(a,b);var c=this;b=b||{},a&&typeof a==="object"&&(b=a,a=b.name,delete b.name),b.deterministic_revs===void 0&&(b.deterministic_revs=!0),this.__opts=b=fa(b),c.auto_compaction=b.auto_compaction,c.prefix=S.prefix;if(typeof a!=="string")throw new Error("Missing/invalid DB name");var d=(b.prefix||"")+a,e=vf(d,b);b.name=e.name,b.adapter=b.adapter||e.adapter,c.name=a,c._adapter=b.adapter,S.emit("debug",["adapter","Picked adapter: ",b.adapter]);if(!S.adapters[b.adapter]||!S.adapters[b.adapter].valid())throw new Error("Invalid Adapter: "+b.adapter);ba.call(c),c.taskqueue=new eb(),c.adapter=b.adapter,S.adapters[b.adapter].call(c,b,function(f){if(f)return c.taskqueue.fail(f);wf(c),c.emit("created",c),S.emit("created",c.name),c.taskqueue.ready(c)})}var xf=typeof AbortController!=="undefined"?AbortController:function(){return{abort:function(){}}},ad=fetch,Va=Headers;S.adapters={},S.preferredAdapters=[],S.prefix="_pouch_";var bd=new U();function yf(a){Object.keys(U.prototype).forEach(function(c){typeof U.prototype[c]==="function"&&(a[c]=bd[c].bind(bd))});var b=a._destructionListeners=new ka();a.on("ref",function c(d){b.has(d.name)||b.set(d.name,[]),b.get(d.name).push(d)}),a.on("unref",function c(d){if(!b.has(d.name))return;var e=b.get(d.name),f=e.indexOf(d);if(f<0)return;e.splice(f,1),e.length>1?b.set(d.name,e):b.delete(d.name)}),a.on("destroyed",function c(d){if(!b.has(d))return;var e=b.get(d);b.delete(d),e.forEach(function(f){f.emit("destroyed",!0)})})}yf(S),S.adapter=function(a,b,c){b.valid()&&(S.adapters[a]=b,c&&S.preferredAdapters.push(a))},S.plugin=function(a){if(typeof a==="function")a(S);else{if(typeof a!=="object"||Object.keys(a).length===0)throw new Error('Invalid plugin: got "'+a+'", expected an object or a function');Object.keys(a).forEach(function(b){S.prototype[b]=a[b]})}return this.__defaults&&(S.__defaults=Sa({},this.__defaults)),S},S.defaults=function(a){function b(c,d){if(!(this instanceof b))return new b(c,d);d=d||{},c&&typeof c==="object"&&(d=c,c=d.name,delete d.name),d=Sa({},b.__defaults,d),S.call(this,c,d)}return qa(b,S),b.preferredAdapters=S.preferredAdapters.slice(),Object.keys(S).forEach(function(c){c in b||(b[c]=S[c])}),b.__defaults=Sa({},this.__defaults,a),b},S.fetch=function(a,b){return ad(a,b)};var zf="7.2.2";function cd(a,b){for(var c=a,d=0,e=b.length;d<e;d++){var f=b[d];c=c[f];if(!c)break}return c}function Af(a,b){return a<b?-1:a>b?1:0}function dd(a){for(var b=[],c="",d=0,e=a.length;d<e;d++){var f=a[d];f==="."?d>0&&a[d-1]==="\\"?c=c.substring(0,c.length-1)+".":(b.push(c),c=""):c+=f}return b.push(c),b}var Bf=["$or","$nor","$not"];function ed(a){return Bf.indexOf(a)>-1}function fd(a){return Object.keys(a)[0]}function Cf(a){return a[fd(a)]}function fb(a){var b={};return a.forEach(function(c){Object.keys(c).forEach(function(d){var e=c[d];typeof e!=="object"&&(e={$eq:e});if(ed(d))e instanceof Array?b[d]=e.map(function(g){return fb([g])}):b[d]=fb([e]);else{var f=b[d]=b[d]||{};Object.keys(e).forEach(function(g){var k=e[g];if(g==="$gt"||g==="$gte")return Df(g,k,f);{if(g==="$lt"||g==="$lte")return Ef(g,k,f);{if(g==="$ne")return Ff(k,f);if(g==="$eq")return Gf(k,f)}}f[g]=k})}})}),b}function Df(a,b,c){if(typeof c.$eq!=="undefined")return;typeof c.$gte!=="undefined"?a==="$gte"?b>c.$gte&&(c.$gte=b):b>=c.$gte&&(delete c.$gte,c.$gt=b):typeof c.$gt!=="undefined"?a==="$gte"?b>c.$gt&&(delete c.$gt,c.$gte=b):b>c.$gt&&(c.$gt=b):c[a]=b}function Ef(a,b,c){if(typeof c.$eq!=="undefined")return;typeof c.$lte!=="undefined"?a==="$lte"?b<c.$lte&&(c.$lte=b):b<=c.$lte&&(delete c.$lte,c.$lt=b):typeof c.$lt!=="undefined"?a==="$lte"?b<c.$lt&&(delete c.$lt,c.$lte=b):b<c.$lt&&(c.$lt=b):c[a]=b}function Ff(a,b){"$ne"in b?b.$ne.push(a):b.$ne=[a]}function Gf(a,b){delete b.$gt,delete b.$gte,delete b.$lt,delete b.$lte,delete b.$ne,b.$eq=a}function gd(a){for(var b in a){if(Array.isArray(a))for(var c in a)a[c].$and&&(a[c]=fb(a[c].$and));var d=a[b];typeof d==="object"&&gd(d)}return a}function hd(a,b){for(var c in a){c==="$and"&&(b=!0);var d=a[c];typeof d==="object"&&(b=hd(d,b))}return b}function Hf(a){var b=fa(a),c=!1;hd(b,!1)&&(b=gd(b),"$and"in b&&(b=fb(b.$and)),c=!0),["$or","$nor"].forEach(function(k){k in b&&b[k].forEach(function(n){for(var v=Object.keys(n),w=0;w<v.length;w++){var j=v[w],s=n[j];(typeof s!=="object"||s===null)&&(n[j]={$eq:s})}})}),"$not"in b&&(b.$not=fb([b.$not]));for(var d=Object.keys(b),e=0;e<d.length;e++){var f=d[e],g=b[f];typeof g!=="object"||g===null?g={$eq:g}:"$ne"in g&&!c&&(g.$ne=[g.$ne]),b[f]=g}return b}function If(a,b,c){for(var d="",e=c-a.length;d.length<e;)d+=b;return d}function Jf(a,b,c){var d=If(a,b,c);return d+a}var id=-324,Ub=3,Vb="";function ha(a,b){if(a===b)return 0;a=Ha(a),b=Ha(b);var c=Wb(a),d=Wb(b);if(c-d!==0)return c-d;switch(typeof a){case"number":return a-b;case"boolean":return a<b?-1:1;case"string":return Pf(a,b)}return Array.isArray(a)?Of(a,b):Qf(a,b)}function Ha(a){switch(typeof a){case"undefined":return null;case"number":return a===Infinity||a===-Infinity||isNaN(a)?null:a;case"object":var b=a;if(Array.isArray(a)){var c=a.length;a=new Array(c);for(var d=0;d<c;d++)a[d]=Ha(b[d])}else{if(a instanceof Date)return a.toJSON();if(a!==null){a={};for(var e in b)if(b.hasOwnProperty(e)){var f=b[e];typeof f!=="undefined"&&(a[e]=Ha(f))}}}}return a}function Kf(a){if(a!==null)switch(typeof a){case"boolean":return a?1:0;case"number":return Rf(a);case"string":return a.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var b=Array.isArray(a),c=b?a:Object.keys(a),d=-1,e=c.length,f="";if(b)for(;++d<e;)f+=sa(c[d]);else for(;++d<e;){var g=c[d];f+=sa(g)+sa(a[g])}return f}return""}function sa(a){var b="\0";return a=Ha(a),Wb(a)+Vb+Kf(a)+b}function Lf(a,b){var c=b,d,e=a[b]==="1";if(e)d=0,b++;else{var f=a[b]==="0";b++;var g="",k=a.substring(b,b+Ub),n=parseInt(k,10)+id;for(f&&(n=-n),b+=Ub;;){var v=a[b];if(v==="\0")break;g+=v,b++}g=g.split("."),g.length===1?d=parseInt(g,10):d=parseFloat(g[0]+"."+g[1]),f&&(d=d-10),n!==0&&(d=parseFloat(d+"e"+n))}return{num:d,length:b-c}}function Mf(a,b){var c=a.pop();if(b.length){var d=b[b.length-1];c===d.element&&(b.pop(),d=b[b.length-1]);var e=d.element,f=d.index;if(Array.isArray(e))e.push(c);else if(f===a.length-2){var g=a.pop();e[g]=c}else a.push(c)}}function Nf(a){for(var b=[],c=[],d=0;;){var e=a[d++];if(e==="\0"){if(b.length===1)return b.pop();{Mf(b,c);continue}}switch(e){case"1":b.push(null);break;case"2":b.push(a[d]==="1"),d++;break;case"3":var f=Lf(a,d);b.push(f.num),d+=f.length;break;case"4":for(var g="";;){var k=a[d];if(k==="\0")break;g+=k,d++}g=g.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),b.push(g);break;case"5":var n={element:[],index:b.length};b.push(n.element),c.push(n);break;case"6":var v={element:{},index:b.length};b.push(v.element),c.push(v);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+e)}}}function Of(a,b){for(var c=Math.min(a.length,b.length),d=0;d<c;d++){var e=ha(a[d],b[d]);if(e!==0)return e}return a.length===b.length?0:a.length>b.length?1:-1}function Pf(a,b){return a===b?0:a>b?1:-1}function Qf(a,b){for(var c=Object.keys(a),d=Object.keys(b),e=Math.min(c.length,d.length),f=0;f<e;f++){var g=ha(c[f],d[f]);if(g!==0)return g;g=ha(a[c[f]],b[d[f]]);if(g!==0)return g}return c.length===d.length?0:c.length>d.length?1:-1}function Wb(a){var b=["boolean","number","string","object"],c=b.indexOf(typeof a);if(~c)return a===null?1:Array.isArray(a)?5:c<3?c+2:c+3;if(Array.isArray(a))return 5}function Rf(a){if(a===0)return"1";var b=a.toExponential().split(/e\+?/),c=parseInt(b[1],10),d=a<0,e=d?"0":"2",f=(d?-c:c)-id,g=Jf(f.toString(),"0",Ub);e+=Vb+g;var k=Math.abs(parseFloat(b[0]));d&&(k=10-k);var n=k.toFixed(20);return n=n.replace(/\.?0+$/,""),e+=Vb+n,e}function Sf(a){function b(c){return a.map(function(d){var e=fd(d),f=dd(e),g=cd(c,f);return g})}return function(c,d){var e=b(c.doc),f=b(d.doc),g=ha(e,f);return g!==0?g:Af(c.doc._id,d.doc._id)}}function Tf(a,b,c){a=a.filter(function(g){return Wa(g.doc,b.selector,c)});if(b.sort){var d=Sf(b.sort);a=a.sort(d),typeof b.sort[0]!=="string"&&Cf(b.sort[0])==="desc"&&(a=a.reverse())}if("limit"in b||"skip"in b){var e=b.skip||0,f=("limit"in b?b.limit:a.length)+e;a=a.slice(e,f)}return a}function Wa(a,b,c){return c.every(function(d){var e=b[d],f=dd(d),g=cd(a,f);return ed(d)?Uf(d,e,a):Xb(e,a,f,g)})}function Xb(a,b,c,d){return a?typeof a==="object"?Object.keys(a).every(function(e){var f=a[e];return Vf(e,b,f,c,d)}):a===d:!0}function Uf(a,b,c){return a==="$or"?b.some(function(d){return Wa(c,d,Object.keys(d))}):a==="$not"?!Wa(c,b,Object.keys(b)):!b.find(function(d){return Wa(c,d,Object.keys(d))})}function Vf(a,b,c,d,e){if(!kd[a])throw new Error('unknown operator "'+a+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return kd[a](b,c,d,e)}function gb(a){return typeof a!=="undefined"&&a!==null}function Ia(a){return typeof a!=="undefined"}function Wf(a,b){var c=b[0],d=b[1];if(c===0)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(c,10)!==c)throw new Error("Divisor is not an integer");if(parseInt(d,10)!==d)throw new Error("Modulus is not an integer");return parseInt(a,10)!==a?!1:a%c===d}function jd(a,b){return b.some(function(c){return a instanceof Array?a.indexOf(c)>-1:a===c})}function Xf(a,b){return b.every(function(c){return a.indexOf(c)>-1})}function Yf(a,b){return a.length===b}function Zf(a,b){var c=new RegExp(b);return c.test(a)}function _f(a,b){switch(b){case"null":return a===null;case"boolean":return typeof a==="boolean";case"number":return typeof a==="number";case"string":return typeof a==="string";case"array":return a instanceof Array;case"object":return{}.toString.call(a)==="[object Object]"}throw new Error(b+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}var kd={$elemMatch:function(a,b,c,d){return Array.isArray(d)?d.length===0?!1:typeof d[0]==="object"?d.some(function(e){return Wa(e,b,Object.keys(b))}):d.some(function(e){return Xb(b,a,c,e)}):!1},$allMatch:function(a,b,c,d){return Array.isArray(d)?d.length===0?!1:typeof d[0]==="object"?d.every(function(e){return Wa(e,b,Object.keys(b))}):d.every(function(e){return Xb(b,a,c,e)}):!1},$eq:function(a,b,c,d){return Ia(d)&&ha(d,b)===0},$gte:function(a,b,c,d){return Ia(d)&&ha(d,b)>=0},$gt:function(a,b,c,d){return Ia(d)&&ha(d,b)>0},$lte:function(a,b,c,d){return Ia(d)&&ha(d,b)<=0},$lt:function(a,b,c,d){return Ia(d)&&ha(d,b)<0},$exists:function(a,b,c,d){return b?Ia(d):!Ia(d)},$mod:function(a,b,c,d){return gb(d)&&Wf(d,b)},$ne:function(a,b,c,d){return b.every(function(e){return ha(d,e)!==0})},$in:function(a,b,c,d){return gb(d)&&jd(d,b)},$nin:function(a,b,c,d){return gb(d)&&!jd(d,b)},$size:function(a,b,c,d){return gb(d)&&Yf(d,b)},$all:function(a,b,c,d){return Array.isArray(d)&&Xf(d,b)},$regex:function(a,b,c,d){return gb(d)&&Zf(d,b)},$type:function(a,b,c,d){return _f(d,b)}};function $f(a,b){if(typeof b!=="object")throw new Error("Selector error: expected a JSON object");b=Hf(b);var c={doc:a},d=Tf([c],{selector:b},Object.keys(b));return d&&d.length===1}function ag(a){return Kb(`"use strict";
return `+a+";",{})}function bg(a){var b=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+a+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join(`
`);return Kb(b,{})}function cg(a,b){if(a.selector){if(a.filter&&a.filter!=="_selector"){var c=typeof a.filter==="string"?a.filter:"function";return b(new Error('selector invalid for filter "'+c+'"'))}}b()}function dg(a){a.view&&!a.filter&&(a.filter="_view"),a.selector&&!a.filter&&(a.filter="_selector"),a.filter&&typeof a.filter==="string"&&(a.filter==="_view"?a.view=Nc(a.view):a.filter=Nc(a.filter))}function eg(a,b){return b.filter&&typeof b.filter==="string"&&!b.doc_ids&&!va(a.db)}function fg(a,b){var c=b.complete;if(b.filter==="_view"){if(!b.view||typeof b.view!=="string"){var d=V(ob,"`view` filter parameter not found or invalid.");return c(d)}var e=Jb(b.view);a.db.get("_design/"+e[0],function(g,k){if(a.isCancelled)return c(null,{status:"cancelled"});if(g)return c(Ua(g));var n=k&&k.views&&k.views[e[1]]&&k.views[e[1]].map;if(!n)return c(V(ra,k.views?"missing json key: "+e[1]:"missing json key: views"));b.filter=bg(n),a.doChanges(b)})}else if(b.selector)b.filter=function(g){return $f(g,b.selector)},a.doChanges(b);else{var f=Jb(b.filter);a.db.get("_design/"+f[0],function(g,k){if(a.isCancelled)return c(null,{status:"cancelled"});if(g)return c(Ua(g));var n=k&&k.filters&&k.filters[f[1]];if(!n)return c(V(ra,k&&k.filters?"missing json key: "+f[1]:"missing json key: filters"));b.filter=ag(n),a.doChanges(b)})}}function gg(a){a._changesFilterPlugin={validate:cg,normalize:dg,shouldFilter:eg,filter:fg}}S.plugin(gg),S.version=zf;function ld(a){return a.reduce(function(b,c){return b[c]=!0,b},{})}var hg=ld(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),ig=ld(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function md(a){if(!/^\d+-/.test(a))return V(Lc);var b=a.indexOf("-"),c=a.substring(0,b),d=a.substring(b+1);return{prefix:parseInt(c,10),id:d}}function jg(a,b){for(var c=a.start-a.ids.length+1,d=a.ids,e=[d[0],b,[]],f=1,g=d.length;f<g;f++)e=[d[f],{status:"missing"},[e]];return[{pos:c,ids:e}]}function nd(a,b,c){c||(c={deterministic_revs:!0});var d,e,f,g={status:"available"};a._deleted&&(g.deleted=!0);if(b){a._id||(a._id=rb()),e=Uc(a,c.deterministic_revs);if(a._rev){f=md(a._rev);if(f.error)return f;a._rev_tree=[{pos:f.prefix,ids:[f.id,{status:"missing"},[[e,g,[]]]]}],d=f.prefix+1}else a._rev_tree=[{pos:1,ids:[e,g,[]]}],d=1}else{a._revisions&&(a._rev_tree=jg(a._revisions,g),d=a._revisions.start,e=a._revisions.ids[0]);if(!a._rev_tree){f=md(a._rev);if(f.error)return f;d=f.prefix,e=f.id,a._rev_tree=[{pos:d,ids:[e,g,[]]}]}}Mc(a._id),a._rev=d+"-"+e;var k={metadata:{},data:{}};for(var n in a)if(Object.prototype.hasOwnProperty.call(a,n)){var v=n[0]==="_";if(v&&!hg[n]){var w=V(Kc,n);throw w.message=Kc.message+": "+n,w}else v&&!ig[n]?k.metadata[n.slice(1)]=a[n]:k.data[n]=a[n]}return k}function kg(a){try{return Lb(a)}catch(c){var b=V(Jc,"Attachment is not a valid base64 string");return{error:b}}}function lg(a,b,c){var d=kg(a.data);if(d.error)return c(d.error);a.length=d.length,b==="blob"?a.data=Nb(d,a.content_type):b==="base64"?a.data=cb(d):a.data=d,Qb(d,function(e){a.digest="md5-"+e,c()})}function mg(a,b,c){Qb(a.data,function(d){a.digest="md5-"+d,a.length=a.data.size||a.data.length||0,b==="binary"?Sc(a.data,function(e){a.data=e,c()}):b==="base64"?Pb(a.data,function(e){a.data=e,c()}):c()})}function ng(a,b,c){if(a.stub)return c();typeof a.data==="string"?lg(a,b,c):mg(a,b,c)}function og(a,b,c){if(!a.length)return c();var d=0,e;a.forEach(function(g){var k=g.data&&g.data._attachments?Object.keys(g.data._attachments):[],n=0;if(!k.length)return f();function v(j){e=j,n++,n===k.length&&f()}for(var w in g.data._attachments)g.data._attachments.hasOwnProperty(w)&&ng(g.data._attachments[w],b,v)});function f(){d++,a.length===d&&(e?c(e):c())}}function pg(a,b,c,d,e,f,g,k){if(lf(b.rev_tree,c.metadata.rev)&&!k)return d[e]=c,f();var n=b.winningRev||Ea(b),v="deleted"in b?b.deleted:za(b,n),w="deleted"in c.metadata?c.metadata.deleted:za(c.metadata),j=/^1-/.test(c.metadata.rev);if(v&&!w&&k&&j){var s=c.data;s._rev=n,s._id=c.metadata.id,c=nd(s,k)}var u=Zc(b.rev_tree,c.metadata.rev_tree[0],a),p=k&&(v&&w&&u.conflicts!=="new_leaf"||!v&&u.conflicts!=="new_leaf"||v&&!w&&u.conflicts==="new_branch");if(p){var r=V(Ta);return d[e]=r,f()}var t=c.metadata.rev;c.metadata.rev_tree=u.tree,c.stemmedRevs=u.stemmedRevs||[],b.rev_map&&(c.metadata.rev_map=b.rev_map);var q=Ea(c.metadata),m=za(c.metadata,q),h=v===m?0:v<m?-1:1,i;t===q?i=m:i=za(c.metadata,t),g(c,q,m,i,!0,h,e,f)}function qg(a){return a.metadata.rev_tree[0].ids[1].status==="missing"}function rg(a,b,c,d,e,f,g,k,n){a=a||1e3;function v(r,t,q){var m=Ea(r.metadata),h=za(r.metadata,m);if("was_delete"in k&&h)return f[t]=V(ra,"deleted"),q();var i=w&&qg(r);if(i){var l=V(Ta);return f[t]=l,q()}var o=h?0:1;g(r,m,h,h,!1,o,t,q)}var w=k.new_edits,j=new ka(),s=0,u=b.length;function p(){++s===u&&n&&n()}b.forEach(function(r,t){if(r._id&&Ga(r._id)){var q=r._deleted?"_removeLocal":"_putLocal";c[q](r,{ctx:e},function(h,i){f[t]=h||i,p()});return}var m=r.metadata.id;j.has(m)?(u--,j.get(m).push([r,t])):j.set(m,[[r,t]])}),j.forEach(function(r,t){var q=0;function m(){++q<r.length?h():p()}function h(){var i=r[q],l=i[0],o=i[1];if(d.has(t))pg(a,d.get(t),l,f,o,m,g,w);else{var B=Zc([],l.metadata.rev_tree[0],a);l.metadata.rev_tree=B.tree,l.stemmedRevs=B.stemmedRevs||[],v(l,o,m)}}h()})}var sg=5,ea="document-store",ia="by-sequence",oa="attach-store",Ja="attach-seq-store",ja="meta-store",wa="local-store",Yb="detect-blob-support";function tg(a){try{return JSON.parse(a)}catch(b){return xc.parse(a)}}function ug(a){try{return JSON.stringify(a)}catch(b){return xc.stringify(a)}}function xa(a){return function(b){var c="unknown_error";b.target&&b.target.error&&(c=b.target.error.name||b.target.error.message),a(V(Hb,c,b.type))}}function Zb(a,b,c){return{data:ug(a),winningRev:b,deletedOrLocal:c?"1":"0",seq:a.seq,id:a.id}}function Ka(a){if(!a)return null;var b=tg(a.data);return b.winningRev=a.winningRev,b.deleted=a.deletedOrLocal==="1",b.seq=a.seq,b}function sb(a){if(!a)return a;var b=a._doc_id_rev.lastIndexOf(":");return a._id=a._doc_id_rev.substring(0,b-1),a._rev=a._doc_id_rev.substring(b+1),delete a._doc_id_rev,a}function od(a,b,c,d){c?a?typeof a!=="string"?d(a):d(Ob(a,b)):d(Mb([""],{type:b})):a?typeof a!=="string"?Rc(a,function(e){d(cb(e))}):d(a):d("")}function pd(a,b,c,d){var e=Object.keys(a._attachments||{});if(!e.length)return d&&d();var f=0;function g(){++f===e.length&&d&&d()}function k(n,v){var w=n._attachments[v],j=w.digest,s=c.objectStore(oa).get(j);s.onsuccess=function(u){w.body=u.target.result.body,g()}}e.forEach(function(n){b.attachments&&b.include_docs?k(a,n):(a._attachments[n].stub=!0,g())})}function _b(a,b){return Promise.all(a.map(function(c){if(c.doc&&c.doc._attachments){var d=Object.keys(c.doc._attachments);return Promise.all(d.map(function(e){var f=c.doc._attachments[e];if(!("body"in f))return;var g=f.body,k=f.content_type;return new Promise(function(n){od(g,k,b,function(v){c.doc._attachments[e]=Sa(bb(f,["digest","content_type"]),{data:v}),n()})})}))}}))}function qd(a,b,c){var d=[],e=c.objectStore(ia),f=c.objectStore(oa),g=c.objectStore(Ja),k=a.length;function n(){k--,k||v()}function v(){if(!d.length)return;d.forEach(function(w){var j=g.index("digestSeq").count(IDBKeyRange.bound(w+"::",w+"::",!1,!1));j.onsuccess=function(s){var u=s.target.result;u||f.delete(w)}})}a.forEach(function(w){var j=e.index("_doc_id_rev"),s=b+"::"+w;j.getKey(s).onsuccess=function(u){var p=u.target.result;if(typeof p!=="number")return n();e.delete(p);var r=g.index("seq").openCursor(IDBKeyRange.only(p));r.onsuccess=function(t){var q=t.target.result;if(q){var m=q.value.digestSeq.split("::")[0];d.push(m),g.delete(q.primaryKey),q.continue()}else n()}}})}function ta(a,b,c){try{return{txn:a.transaction(b,c)}}catch(d){return{error:d}}}var hb=new Ra();function vg(a,b,c,d,e,f){for(var g=b.docs,k,n,v,w,j,s,u,p,r=0,t=g.length;r<t;r++){var q=g[r];if(q._id&&Ga(q._id))continue;q=g[r]=nd(q,c.new_edits,a),q.error&&!u&&(u=q)}if(u)return f(u);var m=!1,h=0,i=new Array(g.length),l=new ka(),o=!1,B=d._meta.blobSupport?"blob":"base64";og(g,B,function(C){if(C)return f(C);G()});function G(){var C=[ea,ia,oa,wa,Ja,ja],z=ta(e,C,"readwrite");if(z.error)return f(z.error);k=z.txn,k.onabort=xa(f),k.ontimeout=xa(f),k.oncomplete=R,n=k.objectStore(ea),v=k.objectStore(ia),w=k.objectStore(oa),j=k.objectStore(Ja),s=k.objectStore(ja),s.get(ja).onsuccess=function(D){p=D.target.result,P()},N(function(D){if(D)return o=!0,f(D);T()})}function I(){m=!0,P()}function H(){rg(a.revs_limit,g,d,l,k,i,X,c,I)}function P(){if(!p||!m)return;p.docCount+=h,s.put(p)}function T(){if(!g.length)return;var C=0;function z(){++C===g.length&&H()}function D(E){var M=Ka(E.target.result);M&&l.set(M.id,M),z()}for(var J=0,K=g.length;J<K;J++){var O=g[J];if(O._id&&Ga(O._id)){z();continue}var L=n.get(O.metadata.id);L.onsuccess=D}}function R(){if(o)return;hb.notify(d._meta.name),f(null,i)}function Q(C,z){var D=w.get(C);D.onsuccess=function(J){if(J.target.result)z();else{var K=V(Qe,"unknown stub attachment with digest "+C);K.status=412,z(K)}}}function N(C){var z=[];g.forEach(function(O){O.data&&O.data._attachments&&Object.keys(O.data._attachments).forEach(function(L){var E=O.data._attachments[L];E.stub&&z.push(E.digest)})});if(!z.length)return C();var D=0,J;function K(){++D===z.length&&C(J)}z.forEach(function(O){Q(O,function(L){L&&!J&&(J=L),K()})})}function X(C,z,D,J,K,O,L,E){C.metadata.winningRev=z,C.metadata.deleted=D;var M=C.data;M._id=C.metadata.id,M._rev=C.metadata.rev,J&&(M._deleted=!0);var W=M._attachments&&Object.keys(M._attachments).length;if(W)return y(C,z,D,K,L,E);h+=O,P(),x(C,z,D,K,L,E)}function x(C,z,D,J,K,O){var L=C.data,E=C.metadata;L._doc_id_rev=E.id+"::"+E.rev,delete L._id,delete L._rev;function M(Y){var _=C.stemmedRevs||[];J&&d.auto_compaction&&(_=_.concat(ef(C.metadata))),_&&_.length&&qd(_,C.metadata.id,k),E.seq=Y.target.result;var ca=Zb(E,z,D),pa=n.put(ca);pa.onsuccess=aa}function W(Y){Y.preventDefault(),Y.stopPropagation();var _=v.index("_doc_id_rev"),ca=_.getKey(L._doc_id_rev);ca.onsuccess=function(pa){var la=v.put(L,pa.target.result);la.onsuccess=M}}function aa(){i[K]={ok:!0,id:E.id,rev:E.rev},l.set(C.metadata.id,C.metadata),A(C,E.seq,O)}var Z=v.put(L);Z.onsuccess=M,Z.onerror=W}function y(C,z,D,J,K,O){var L=C.data,E=0,M=Object.keys(L._attachments);function W(){E===M.length&&x(C,z,D,J,K,O)}function aa(){E++,W()}M.forEach(function(Z){var Y=C.data._attachments[Z];if(Y.stub)E++,W();else{var _=Y.data;delete Y.data,Y.revpos=parseInt(z,10);var ca=Y.digest;F(ca,_,aa)}})}function A(C,z,D){var J=0,K=Object.keys(C.data._attachments||{});if(!K.length)return D();function O(){++J===K.length&&D()}function L(M){var W=C.data._attachments[M].digest,aa=j.put({seq:z,digestSeq:W+"::"+z});aa.onsuccess=O,aa.onerror=function(Z){Z.preventDefault(),Z.stopPropagation(),O()}}for(var E=0;E<K.length;E++)L(K[E])}function F(C,z,D){var J=w.count(C);J.onsuccess=function(K){var O=K.target.result;if(O)return D();var L={digest:C,body:z},E=w.put(L);E.onsuccess=D}}}function rd(a,b,c,d,e){d===-1&&(d=1e3);var f=typeof a.getAll==="function"&&typeof a.getAllKeys==="function"&&d>1&&!c,g,k,n;function v(u){k=u.target.result,g&&e(g,k,n)}function w(u){g=u.target.result,k&&e(g,k,n)}function j(){if(!g.length)return e();var u=g[g.length-1],p;if(b&&b.upper)try{p=IDBKeyRange.bound(u,b.upper,!0,b.upperOpen)}catch(r){if(r.name==="DataError"&&r.code===0)return e()}else p=IDBKeyRange.lowerBound(u,!0);b=p,g=null,k=null,a.getAll(b,d).onsuccess=v,a.getAllKeys(b,d).onsuccess=w}function s(u){var p=u.target.result;if(!p)return e();e([p.key],[p.value],p)}f?(n={continue:j},a.getAll(b,d).onsuccess=v,a.getAllKeys(b,d).onsuccess=w):c?a.openCursor(b,"prev").onsuccess=s:a.openCursor(b).onsuccess=s}function wg(a,b,c){if(typeof a.getAll==="function"){a.getAll(b).onsuccess=c;return}var d=[];function e(f){var g=f.target.result;g?(d.push(g.value),g.continue()):c({target:{result:d}})}a.openCursor(b).onsuccess=e}function xg(a,b,c){var d=new Array(a.length),e=0;a.forEach(function(f,g){b.get(f).onsuccess=function(k){k.target.result?d[g]=k.target.result:d[g]={key:f,error:"not_found"},e++,e===a.length&&c(a,d,{})}})}function yg(a,b,c,d,e){try{if(a&&b)return e?IDBKeyRange.bound(b,a,!c,!1):IDBKeyRange.bound(a,b,!1,!c);{if(a)return e?IDBKeyRange.upperBound(a):IDBKeyRange.lowerBound(a);{if(b)return e?IDBKeyRange.lowerBound(b,!c):IDBKeyRange.upperBound(b,!c);if(d)return IDBKeyRange.only(d)}}}catch(f){return{error:f}}return null}function zg(a,b,c){var d="startkey"in a?a.startkey:!1,e="endkey"in a?a.endkey:!1,f="key"in a?a.key:!1,g="keys"in a?a.keys:!1,k=a.skip||0,n=typeof a.limit==="number"?a.limit:-1,v=a.inclusive_end!==!1,w,j;if(!g){w=yg(d,e,v,f,a.descending),j=w&&w.error;if(j&&!(j.name==="DataError"&&j.code===0))return c(V(Hb,j.name,j.message))}var s=[ea,ia,ja];a.attachments&&s.push(oa);var u=ta(b,s,"readonly");if(u.error)return c(u.error);var p=u.txn;p.oncomplete=R,p.onabort=xa(c);var r=p.objectStore(ea),t=p.objectStore(ia),q=p.objectStore(ja),m=t.index("_doc_id_rev"),h=[],i,l;q.get(ja).onsuccess=function(Q){i=Q.target.result.docCount},a.update_seq&&o(t,function(Q){Q.target.result&&Q.target.result.length>0&&(l=Q.target.result[0])});function o(Q,N){function X(x){var y=x.target.result,A=void 0;return y&&y.key&&(A=y.key),N({target:{result:[A]}})}Q.openCursor(null,"prev").onsuccess=X}function B(Q,N,X){var x=Q.id+"::"+X;m.get(x).onsuccess=function y(A){N.doc=sb(A.target.result)||{};if(a.conflicts){var F=Sb(Q);F.length&&(N.doc._conflicts=F)}pd(N.doc,a,p)}}function G(Q,N){var X={id:N.id,key:N.id,value:{rev:Q}},x=N.deleted;x?g&&(h.push(X),X.value.deleted=!0,X.doc=null):k--<=0&&(h.push(X),a.include_docs&&B(N,X,Q))}function I(Q){for(var N=0,X=Q.length;N<X;N++){if(h.length===n)break;var x=Q[N];if(x.error&&g){h.push(x);continue}var y=Ka(x),A=y.winningRev;G(A,y)}}function H(Q,N,X){if(!X)return;I(N),h.length<n&&X.continue()}function P(Q){var N=Q.target.result;a.descending&&(N=N.reverse()),I(N)}function T(){var Q={total_rows:i,offset:a.skip,rows:h};a.update_seq&&l!==void 0&&(Q.update_seq=l),c(null,Q)}function R(){a.attachments?_b(h,a.binary).then(T):T()}if(j||n===0)return;if(g)return xg(a.keys,r,H);if(n===-1)return wg(r,w,P);rd(r,w,a.descending,n+k,H)}function Ag(a){return new Promise(function(b){var c=Mb([""]),d=a.objectStore(Yb).put(c,"key");d.onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),f=navigator.userAgent.match(/Edge\//);b(f||!e||parseInt(e[1],10)>=43)},d.onerror=a.onabort=function(e){e.preventDefault(),e.stopPropagation(),b(!1)}}).catch(function(){return!1})}function Bg(a,b){var c=a.objectStore(ea).index("deletedOrLocal");c.count(IDBKeyRange.only("0")).onsuccess=function(d){b(d.target.result)}}var $b=!1,ac=[];function Cg(a,b,c,d){try{a(b,c)}catch(e){d.emit("error",e)}}function sd(){if($b||!ac.length)return;$b=!0,ac.shift()()}function Dg(a,b,c){ac.push(function d(){a(function e(f,g){Cg(b,f,g,c),$b=!1,ua(function k(){sd()})})}),sd()}function Eg(a,b,c,d){a=fa(a);if(a.continuous){var e=c+":"+rb();return hb.addListener(c,e,b,a),hb.notify(c),{cancel:function(){hb.removeListener(c,e)}}}var f=a.doc_ids&&new Qa(a.doc_ids);a.since=a.since||0;var g=a.since,k="limit"in a?a.limit:-1;k===0&&(k=1);var n=[],v=0,w=Ib(a),j=new ka(),s,u,p,r;function t(G,I,H){if(!H||!G.length)return;var P=new Array(G.length),T=new Array(G.length);function R(X,x){var y=a.processChange(x,X,a);g=y.seq=X.seq;var A=w(y);return typeof A==="object"?Promise.reject(A):A?(v++,a.return_docs&&n.push(y),a.attachments&&a.include_docs?new Promise(function(F){pd(x,a,s,function(){_b([y],a.binary).then(function(){F(y)})})}):Promise.resolve(y)):Promise.resolve()}function Q(){for(var X=[],x=0,y=P.length;x<y;x++){if(v===k)break;var A=P[x];if(!A)continue;var F=T[x];X.push(R(F,A))}Promise.all(X).then(function(C){for(var z=0,D=C.length;z<D;z++)C[z]&&a.onChange(C[z])}).catch(a.complete),v!==k&&H.continue()}var N=0;I.forEach(function(X,x){var y=sb(X),A=G[x];m(y,A,function(F,C){T[x]=F,P[x]=C,++N===G.length&&Q()})})}function q(G,I,H,P){if(H.seq!==I)return P();if(H.winningRev===G._rev)return P(H,G);var T=G._id+"::"+H.winningRev,R=r.get(T);R.onsuccess=function(Q){P(H,sb(Q.target.result))}}function m(G,I,H){if(f&&!f.has(G._id))return H();var P=j.get(G._id);if(P)return q(G,I,P,H);p.get(G._id).onsuccess=function(T){P=Ka(T.target.result),j.set(G._id,P),q(G,I,P,H)}}function h(){a.complete(null,{results:n,last_seq:g})}function i(){!a.continuous&&a.attachments?_b(n).then(h):h()}var l=[ea,ia];a.attachments&&l.push(oa);var o=ta(d,l,"readonly");if(o.error)return a.complete(o.error);s=o.txn,s.onabort=xa(a.complete),s.oncomplete=i,u=s.objectStore(ia),p=s.objectStore(ea),r=u.index("_doc_id_rev");var B=a.since&&!a.descending?IDBKeyRange.lowerBound(a.since,!0):null;rd(u,B,a.descending,k,t)}var Xa=new ka(),bc,cc=new ka();function td(a,b){var c=this;Dg(function(d){Fg(c,a,d)},b,c.constructor)}function Fg(a,b,c){var d=b.name,e=null;a._meta=null;function f(p){var r=p.createObjectStore(ea,{keyPath:"id"});p.createObjectStore(ia,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),p.createObjectStore(oa,{keyPath:"digest"}),p.createObjectStore(ja,{keyPath:"id",autoIncrement:!1}),p.createObjectStore(Yb),r.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),p.createObjectStore(wa,{keyPath:"_id"});var t=p.createObjectStore(Ja,{autoIncrement:!0});t.createIndex("seq","seq"),t.createIndex("digestSeq","digestSeq",{unique:!0})}function g(p,r){var t=p.objectStore(ea);t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),t.openCursor().onsuccess=function(q){var m=q.target.result;if(m){var h=m.value,i=za(h);h.deletedOrLocal=i?"1":"0",t.put(h),m.continue()}else r()}}function k(p){p.createObjectStore(wa,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function n(p,r){var t=p.objectStore(wa),q=p.objectStore(ea),m=p.objectStore(ia),h=q.openCursor();h.onsuccess=function(i){var l=i.target.result;if(l){var o=l.value,B=o.id,G=Ga(B),I=Ea(o);if(G){var H=B+"::"+I,P=B+"::",T=B+"::~",R=m.index("_doc_id_rev"),Q=IDBKeyRange.bound(P,T,!1,!1),N=R.openCursor(Q);N.onsuccess=function(X){N=X.target.result;if(!N)q.delete(l.primaryKey),l.continue();else{var x=N.value;x._doc_id_rev===H&&t.put(x),m.delete(N.primaryKey),N.continue()}}}else l.continue()}else r&&r()}}function v(p){var r=p.createObjectStore(Ja,{autoIncrement:!0});r.createIndex("seq","seq"),r.createIndex("digestSeq","digestSeq",{unique:!0})}function w(p,r){var t=p.objectStore(ia),q=p.objectStore(oa),m=p.objectStore(Ja),h=q.count();h.onsuccess=function(i){var l=i.target.result;if(!l)return r();t.openCursor().onsuccess=function(o){var B=o.target.result;if(!B)return r();for(var G=B.value,I=B.primaryKey,H=Object.keys(G._attachments||{}),P={},T=0;T<H.length;T++){var R=G._attachments[H[T]];P[R.digest]=!0}var Q=Object.keys(P);for(T=0;T<Q.length;T++){var N=Q[T];m.put({seq:I,digestSeq:N+"::"+I})}B.continue()}}}function j(p){function r(h){return h.data?Ka(h):(h.deleted=h.deletedOrLocal==="1",h)}var t=p.objectStore(ia),q=p.objectStore(ea),m=q.openCursor();m.onsuccess=function(h){var i=h.target.result;if(!i)return;var l=r(i.value);l.winningRev=l.winningRev||Ea(l);function o(){var G=l.id+"::",I=l.id+"::",H=t.index("_doc_id_rev").openCursor(IDBKeyRange.bound(G,I)),P=0;H.onsuccess=function(T){var R=T.target.result;if(!R)return l.seq=P,B();var Q=R.primaryKey;Q>P&&(P=Q),R.continue()}}function B(){var G=Zb(l,l.winningRev,l.deleted),I=q.put(G);I.onsuccess=function(){i.continue()}}if(l.seq)return B();o()}}a._remote=!1,a.type=function(){return"idb"},a._id=Ec(function(p){p(null,a._meta.instanceId)}),a._bulkDocs=function p(r,t,q){vg(b,r,t,a,e,q)},a._get=function p(r,t,q){var m,h,i,l=t.ctx;if(!l){var o=ta(e,[ea,ia,oa],"readonly");if(o.error)return q(o.error);l=o.txn}function B(){q(i,{doc:m,metadata:h,ctx:l})}l.objectStore(ea).get(r).onsuccess=function(G){h=Ka(G.target.result);if(!h)return i=V(ra,"missing"),B();var I;if(t.rev)I=t.latest?nf(t.rev,h):t.rev;else{I=h.winningRev;var H=za(h);if(H)return i=V(ra,"deleted"),B()}var P=l.objectStore(ia),T=h.id+"::"+I;P.index("_doc_id_rev").get(T).onsuccess=function(R){m=R.target.result,m&&(m=sb(m));if(!m)return i=V(ra,"missing"),B();B()}}},a._getAttachment=function(p,r,t,q,m){var h;if(q.ctx)h=q.ctx;else{var i=ta(e,[ea,ia,oa],"readonly");if(i.error)return m(i.error);h=i.txn}var l=t.digest,o=t.content_type;h.objectStore(oa).get(l).onsuccess=function(B){var G=B.target.result.body;od(G,o,q.binary,function(I){m(null,I)})}},a._info=function p(r){var t,q,m=ta(e,[ja,ia],"readonly");if(m.error)return r(m.error);var h=m.txn;h.objectStore(ja).get(ja).onsuccess=function(i){q=i.target.result.docCount},h.objectStore(ia).openCursor(null,"prev").onsuccess=function(i){var l=i.target.result;t=l?l.key:0},h.oncomplete=function(){r(null,{doc_count:q,update_seq:t,idb_attachment_format:a._meta.blobSupport?"binary":"base64"})}},a._allDocs=function p(r,t){zg(r,e,t)},a._changes=function p(r){return Eg(r,a,d,e)},a._close=function(p){e.close(),Xa.delete(d),p()},a._getRevisionTree=function(p,r){var t=ta(e,[ea],"readonly");if(t.error)return r(t.error);var q=t.txn,m=q.objectStore(ea).get(p);m.onsuccess=function(h){var i=Ka(h.target.result);i?r(null,i.rev_tree):r(V(ra))}},a._doCompaction=function(p,r,t){var q=[ea,ia,oa,Ja],m=ta(e,q,"readwrite");if(m.error)return t(m.error);var h=m.txn,i=h.objectStore(ea);i.get(p).onsuccess=function(l){var o=Ka(l.target.result);Fa(o.rev_tree,function(I,H,P,T,R){var Q=H+"-"+P;r.indexOf(Q)!==-1&&(R.status="missing")}),qd(r,p,h);var B=o.winningRev,G=o.deleted;h.objectStore(ea).put(Zb(o,B,G))},h.onabort=xa(t),h.oncomplete=function(){t()}},a._getLocal=function(p,r){var t=ta(e,[wa],"readonly");if(t.error)return r(t.error);var q=t.txn,m=q.objectStore(wa).get(p);m.onerror=xa(r),m.onsuccess=function(h){var i=h.target.result;i?(delete i._doc_id_rev,r(null,i)):r(V(ra))}},a._putLocal=function(p,r,t){typeof r==="function"&&(t=r,r={}),delete p._revisions;var q=p._rev,m=p._id;q?p._rev="0-"+(parseInt(q.split("-")[1],10)+1):p._rev="0-1";var h=r.ctx,i;if(!h){var l=ta(e,[wa],"readwrite");if(l.error)return t(l.error);h=l.txn,h.onerror=xa(t),h.oncomplete=function(){i&&t(null,i)}}var o=h.objectStore(wa),B;q?(B=o.get(m),B.onsuccess=function(G){var I=G.target.result;if(!I||I._rev!==q)t(V(Ta));else{var H=o.put(p);H.onsuccess=function(){i={ok:!0,id:p._id,rev:p._rev},r.ctx&&t(null,i)}}}):(B=o.add(p),B.onerror=function(G){t(V(Ta)),G.preventDefault(),G.stopPropagation()},B.onsuccess=function(){i={ok:!0,id:p._id,rev:p._rev},r.ctx&&t(null,i)})},a._removeLocal=function(p,r,t){typeof r==="function"&&(t=r,r={});var q=r.ctx;if(!q){var m=ta(e,[wa],"readwrite");if(m.error)return t(m.error);q=m.txn,q.oncomplete=function(){h&&t(null,h)}}var h,i=p._id,l=q.objectStore(wa),o=l.get(i);o.onerror=xa(t),o.onsuccess=function(B){var G=B.target.result;!G||G._rev!==p._rev?t(V(ra)):(l.delete(i),h={ok:!0,id:i,rev:"0-0"},r.ctx&&t(null,h))}},a._destroy=function(p,r){hb.removeAllListeners(d);var t=cc.get(d);t&&t.result&&(t.result.close(),Xa.delete(d));var q=indexedDB.deleteDatabase(d);q.onsuccess=function(){cc.delete(d),nb()&&d in localStorage&&delete localStorage[d],r(null,{ok:!0})},q.onerror=xa(r)};var s=Xa.get(d);if(s)return e=s.idb,a._meta=s.global,ua(function(){c(null,a)});var u=indexedDB.open(d,sg);cc.set(d,u),u.onupgradeneeded=function(p){var r=p.target.result;if(p.oldVersion<1)return f(r);var t=p.currentTarget.transaction;p.oldVersion<3&&k(r),p.oldVersion<4&&v(r);var q=[g,n,w,j],m=p.oldVersion;function h(){var i=q[m-1];m++,i&&i(t,h)}h()},u.onsuccess=function(p){e=p.target.result,e.onversionchange=function(){e.close(),Xa.delete(d)},e.onabort=function(B){na("error","Database has a global failure",B.target.error),e.close(),Xa.delete(d)};var r=e.transaction([ja,Yb,ea],"readwrite"),t=!1,q,m,h,i;function l(){if(typeof h==="undefined"||!t)return;a._meta={name:d,instanceId:i,blobSupport:h},Xa.set(d,{idb:e,global:a._meta}),c(null,a)}function o(){if(typeof m==="undefined"||typeof q==="undefined")return;var B=d+"_id";B in q?i=q[B]:q[B]=i=rb(),q.docCount=m,r.objectStore(ja).put(q)}r.objectStore(ja).get(ja).onsuccess=function(B){q=B.target.result||{id:ja},o()},Bg(r,function(B){m=B,o()}),bc||(bc=Ag(r)),bc.then(function(B){h=B,l()}),r.oncomplete=function(){t=!0,l()},r.onabort=xa(c)},u.onerror=function(p){var r=p.target.error&&p.target.error.message;r?r.indexOf("stored database is a higher version")!==-1&&(r=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):r="Failed to open indexedDB, are you in private browsing mode?",na("error",r),c(V(Hb,r))}}td.valid=function(){try{return typeof indexedDB!=="undefined"&&typeof IDBKeyRange!=="undefined"}catch(a){return!1}};function Gg(a){a.adapter("idb",td,!0)}function Hg(a,b){return new Promise(function(c,d){var e=0,f=0,g=0,k=a.length,n;function v(){e++,a[f++]().then(j,s)}function w(){++g===k?n?d(n):c():u()}function j(){e--,w()}function s(p){e--,n=n||p,w()}function u(){for(;e<b&&f<k;)v()}u()})}var Ig=25,Jg=50,tb=5e3,Kg=1e4,dc={};function ec(a){var b=a.doc||a.ok,c=b&&b._attachments;if(!c)return;Object.keys(c).forEach(function(d){var e=c[d];e.data=Ob(e.data,e.content_type)})}function La(a){return/^_design/.test(a)?"_design/"+encodeURIComponent(a.slice(8)):/^_local/.test(a)?"_local/"+encodeURIComponent(a.slice(7)):encodeURIComponent(a)}function ud(a){return!a._attachments||!Object.keys(a._attachments)?Promise.resolve():Promise.all(Object.keys(a._attachments).map(function(b){var c=a._attachments[b];if(c.data&&typeof c.data!=="string")return new Promise(function(d){Pb(c.data,d)}).then(function(d){c.data=d})}))}function Lg(a){if(!a.prefix)return!1;var b=Qc(a.prefix).protocol;return b==="http"||b==="https"}function Mg(a,b){if(Lg(b)){var c=b.name.substr(b.prefix.length),d=b.prefix.replace(/\/?$/,"/");a=d+encodeURIComponent(c)}var e=Qc(a);(e.user||e.password)&&(e.auth={username:e.user,password:e.password});var f=e.path.replace(/(^\/|\/$)/g,"").split("/");return e.db=f.pop(),e.db.indexOf("%")===-1&&(e.db=encodeURIComponent(e.db)),e.path=f.join("/"),e}function ga(a,b){return ub(a,a.db+"/"+b)}function ub(a,b){var c=a.path?"/":"";return a.protocol+"://"+a.host+(a.port?":"+a.port:"")+"/"+a.path+c+b}function vb(a){return"?"+Object.keys(a).map(function(b){return b+"="+encodeURIComponent(a[b])}).join("&")}function Ng(a){var b=typeof navigator!=="undefined"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",c=b.indexOf("msie")!==-1,d=b.indexOf("trident")!==-1,e=b.indexOf("edge")!==-1,f=!("method"in a)||a.method==="GET";return(c||d||e)&&f}function fc(a,b){var c=this,d=Mg(a.name,a),e=ga(d,"");a=fa(a);var f=function(j,s){s=s||{},s.headers=s.headers||new Va(),s.credentials="include";if(a.auth||d.auth){var u=a.auth||d.auth,p=u.username+":"+u.password,r=cb(unescape(encodeURIComponent(p)));s.headers.set("Authorization","Basic "+r)}var t=a.headers||{};Object.keys(t).forEach(function(m){s.headers.append(m,t[m])}),Ng(s)&&(j+=(j.indexOf("?")===-1?"?":"&")+"_nonce="+Date.now());var q=a.fetch||ad;return q(j,s)};function g(j,s){return da(j,Pa(function(u){v().then(function(){return s.apply(this,u)}).catch(function(p){var r=u.pop();r(p)})})).bind(c)}function k(j,s,u){var p={};return s=s||{},s.headers=s.headers||new Va(),s.headers.get("Content-Type")||s.headers.set("Content-Type","application/json"),s.headers.get("Accept")||s.headers.set("Accept","application/json"),f(j,s).then(function(r){return p.ok=r.ok,p.status=r.status,r.json()}).then(function(r){p.data=r;if(!p.ok){p.data.status=p.status;var t=Ua(p.data);if(u)return u(t);throw t}Array.isArray(p.data)&&(p.data=p.data.map(function(q){return q.error||q.missing?Ua(q):q}));if(u)u(null,p.data);else return p})}var n;function v(){return a.skip_setup?Promise.resolve():n?n:(n=k(e).catch(function(j){return j&&j.status&&j.status===404?(Eb(404,"PouchDB is just detecting if the remote exists."),k(e,{method:"PUT"})):Promise.reject(j)}).catch(function(j){return j&&j.status&&j.status===412?!0:Promise.reject(j)}),n.catch(function(){n=null}),n)}ua(function(){b(null,c)}),c._remote=!0,c.type=function(){return"http"},c.id=g("id",function(j){f(ub(d,"")).then(function(s){return s.json()}).catch(function(){return{}}).then(function(s){var u=s&&s.uuid?s.uuid+d.db:ga(d,"");j(null,u)})}),c.compact=g("compact",function(j,s){typeof j==="function"&&(s=j,j={}),j=fa(j),k(ga(d,"_compact"),{method:"POST"}).then(function(){function u(){c.info(function(p,r){r&&!r.compact_running?s(null,{ok:!0}):setTimeout(u,j.interval||200)})}u()})}),c.bulkGet=da("bulkGet",function(j,s){var u=this;function p(m){var h={};j.revs&&(h.revs=!0),j.attachments&&(h.attachments=!0),j.latest&&(h.latest=!0),k(ga(d,"_bulk_get"+vb(h)),{method:"POST",body:JSON.stringify({docs:j.docs})}).then(function(i){j.attachments&&j.binary&&i.data.results.forEach(function(l){l.docs.forEach(ec)}),m(null,i.data)}).catch(m)}function r(){var m=Jg,h=Math.ceil(j.docs.length/m),i=0,l=new Array(h);function o(I){return function(H,P){l[I]=P.results,++i===h&&s(null,{results:pb(l)})}}for(var B=0;B<h;B++){var G=bb(j,["revs","attachments","binary","latest"]);G.docs=j.docs.slice(B*m,Math.min(j.docs.length,(B+1)*m)),Gc(u,G,o(B))}}var t=ub(d,""),q=dc[t];typeof q!=="boolean"?p(function(m,h){m?(dc[t]=!1,Eb(m.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),r()):(dc[t]=!0,s(null,h))}):q?p(s):r()}),c._info=function(j){v().then(function(){return f(ga(d,""))}).then(function(s){return s.json()}).then(function(s){s.host=ga(d,""),j(null,s)}).catch(j)},c.fetch=function(j,s){return v().then(function(){var u=j.substring(0,1)==="/"?ub(d,j.substring(1)):ga(d,j);return f(u,s)})},c.get=g("get",function(j,s,u){typeof s==="function"&&(u=s,s={}),s=fa(s);var p={};s.revs&&(p.revs=!0),s.revs_info&&(p.revs_info=!0),s.latest&&(p.latest=!0),s.open_revs&&(s.open_revs!=="all"&&(s.open_revs=JSON.stringify(s.open_revs)),p.open_revs=s.open_revs),s.rev&&(p.rev=s.rev),s.conflicts&&(p.conflicts=s.conflicts),s.update_seq&&(p.update_seq=s.update_seq),j=La(j);function r(m){var h=m._attachments,i=h&&Object.keys(h);if(!h||!i.length)return;function l(B){var G=h[B],I=La(m._id)+"/"+w(B)+"?rev="+m._rev;return f(ga(d,I)).then(function(H){return"buffer"in H?H.buffer():H.blob()}).then(function(H){if(s.binary){var P=Object.getOwnPropertyDescriptor(H.__proto__,"type");return(!P||P.set)&&(H.type=G.content_type),H}return new Promise(function(T){Pb(H,T)})}).then(function(H){delete G.stub,delete G.length,G.data=H})}var o=i.map(function(B){return function(){return l(B)}});return Hg(o,5)}function t(m){return Array.isArray(m)?Promise.all(m.map(function(h){if(h.ok)return r(h.ok)})):r(m)}var q=ga(d,j+vb(p));k(q).then(function(m){return Promise.resolve().then(function(){if(s.attachments)return t(m.data)}).then(function(){u(null,m.data)})}).catch(function(m){m.docId=j,u(m)})}),c.remove=g("remove",function(j,s,u,p){var r;typeof s==="string"?(r={_id:j,_rev:s},typeof u==="function"&&(p=u,u={})):(r=j,typeof s==="function"?(p=s,u={}):(p=u,u=s));var t=r._rev||u.rev,q=ga(d,La(r._id))+"?rev="+t;k(q,{method:"DELETE"},p).catch(p)});function w(j){return j.split("/").map(encodeURIComponent).join("/")}c.getAttachment=g("getAttachment",function(j,s,u,p){typeof u==="function"&&(p=u,u={});var r=u.rev?"?rev="+u.rev:"",t=ga(d,La(j))+"/"+w(s)+r,q;f(t,{method:"GET"}).then(function(m){q=m.headers.get("content-type");if(m.ok)return m.blob();throw m}).then(function(m){p(null,m)}).catch(function(m){p(m)})}),c.removeAttachment=g("removeAttachment",function(j,s,u,p){var r=ga(d,La(j)+"/"+w(s))+"?rev="+u;k(r,{method:"DELETE"},p).catch(p)}),c.putAttachment=g("putAttachment",function(j,s,u,p,r,t){typeof r==="function"&&(t=r,r=p,p=u,u=null);var q=La(j)+"/"+w(s),m=ga(d,q);u&&(m+="?rev="+u);if(typeof p==="string"){var h;try{h=Lb(p)}catch(i){return t(V(Jc,"Attachment is not a valid base64 string"))}p=h?Nb(h,r):""}k(m,{headers:new Va({"Content-Type":r}),method:"PUT",body:p},t).catch(t)}),c._bulkDocs=function(j,s,u){j.new_edits=s.new_edits,v().then(function(){return Promise.all(j.docs.map(ud))}).then(function(){return k(ga(d,"_bulk_docs"),{method:"POST",body:JSON.stringify(j)},u)}).catch(u)},c._put=function(j,s,u){v().then(function(){return ud(j)}).then(function(){return k(ga(d,La(j._id)),{method:"PUT",body:JSON.stringify(j)})}).then(function(p){u(null,p.data)}).catch(function(p){p.docId=j&&j._id,u(p)})},c.allDocs=g("allDocs",function(j,s){typeof j==="function"&&(s=j,j={}),j=fa(j);var u={},p,r="GET";j.conflicts&&(u.conflicts=!0),j.update_seq&&(u.update_seq=!0),j.descending&&(u.descending=!0),j.include_docs&&(u.include_docs=!0),j.attachments&&(u.attachments=!0),j.key&&(u.key=JSON.stringify(j.key)),j.start_key&&(j.startkey=j.start_key),j.startkey&&(u.startkey=JSON.stringify(j.startkey)),j.end_key&&(j.endkey=j.end_key),j.endkey&&(u.endkey=JSON.stringify(j.endkey)),typeof j.inclusive_end!=="undefined"&&(u.inclusive_end=!!j.inclusive_end),typeof j.limit!=="undefined"&&(u.limit=j.limit),typeof j.skip!=="undefined"&&(u.skip=j.skip);var t=vb(u);typeof j.keys!=="undefined"&&(r="POST",p={keys:j.keys}),k(ga(d,"_all_docs"+t),{method:r,body:JSON.stringify(p)}).then(function(q){j.include_docs&&j.attachments&&j.binary&&q.data.rows.forEach(ec),s(null,q.data)}).catch(s)}),c._changes=function(j){var s="batch_size"in j?j.batch_size:Ig;j=fa(j),j.continuous&&!("heartbeat"in j)&&(j.heartbeat=Kg);var u="timeout"in j?j.timeout:30*1e3;"timeout"in j&&j.timeout&&u-j.timeout<tb&&(u=j.timeout+tb),"heartbeat"in j&&j.heartbeat&&u-j.heartbeat<tb&&(u=j.heartbeat+tb);var p={};"timeout"in j&&j.timeout&&(p.timeout=j.timeout);var r=typeof j.limit!=="undefined"?j.limit:!1,t=r;j.style&&(p.style=j.style),(j.include_docs||j.filter&&typeof j.filter==="function")&&(p.include_docs=!0),j.attachments&&(p.attachments=!0),j.continuous&&(p.feed="longpoll"),j.seq_interval&&(p.seq_interval=j.seq_interval),j.conflicts&&(p.conflicts=!0),j.descending&&(p.descending=!0),j.update_seq&&(p.update_seq=!0),"heartbeat"in j&&(j.heartbeat&&(p.heartbeat=j.heartbeat)),j.filter&&typeof j.filter==="string"&&(p.filter=j.filter),j.view&&typeof j.view==="string"&&(p.filter="_view",p.view=j.view);if(j.query_params&&typeof j.query_params==="object")for(var q in j.query_params)j.query_params.hasOwnProperty(q)&&(p[q]=j.query_params[q]);var m="GET",h;j.doc_ids?(p.filter="_doc_ids",m="POST",h={doc_ids:j.doc_ids}):j.selector&&(p.filter="_selector",m="POST",h={selector:j.selector});var i=new xf(),l,o=function(I,H){if(j.aborted)return;p.since=I,typeof p.since==="object"&&(p.since=JSON.stringify(p.since)),j.descending?r&&(p.limit=t):p.limit=!r||t>s?s:t;var P=ga(d,"_changes"+vb(p)),T={signal:i.signal,method:m,body:JSON.stringify(h)};l=I;if(j.aborted)return;v().then(function(){return k(P,T,H)}).catch(H)},B={results:[]},G=function(I,H){if(j.aborted)return;var P=0;if(H&&H.results){P=H.results.length,B.last_seq=H.last_seq;var T=null,R=null;typeof H.pending==="number"&&(T=H.pending),(typeof B.last_seq==="string"||typeof B.last_seq==="number")&&(R=B.last_seq);var Q={};Q.query=j.query_params,H.results=H.results.filter(function(X){t--;var x=Ib(j)(X);return x&&(j.include_docs&&j.attachments&&j.binary&&ec(X),j.return_docs&&B.results.push(X),j.onChange(X,T,R)),x})}else if(I){j.aborted=!0,j.complete(I);return}H&&H.last_seq&&(l=H.last_seq);var N=r&&t<=0||H&&P<s||j.descending;j.continuous&&!(r&&t<=0)||!N?ua(function(){o(l,G)}):j.complete(null,B)};return o(j.since||0,G),{cancel:function(){j.aborted=!0,i.abort()}}},c.revsDiff=g("revsDiff",function(j,s,u){typeof s==="function"&&(u=s,s={}),k(ga(d,"_revs_diff"),{method:"POST",body:JSON.stringify(j)},u).catch(u)}),c._close=function(j){j()},c._destroy=function(j,s){k(ga(d,""),{method:"DELETE"}).then(function(u){s(null,u)}).catch(function(u){u.status===404?s(null,{ok:!0}):s(u)})}}fc.valid=function(){return!0};function Og(a){a.adapter("http",fc,!1),a.adapter("https",fc,!1)}function Ma(a){this.status=400,this.name="query_parse_error",this.message=a,this.error=!0;try{Error.captureStackTrace(this,Ma)}catch(b){}}qa(Ma,Error);function wb(a){this.status=404,this.name="not_found",this.message=a,this.error=!0;try{Error.captureStackTrace(this,wb)}catch(b){}}qa(wb,Error);function xb(a){this.status=500,this.name="invalid_value",this.message=a,this.error=!0;try{Error.captureStackTrace(this,xb)}catch(b){}}qa(xb,Error);function vd(a,b){return b&&a.then(function(c){ua(function(){b(null,c)})},function(c){ua(function(){b(c)})}),a}function Pg(a){return Pa(function(b){var c=b.pop(),d=a.apply(this,b);return typeof c==="function"&&vd(d,c),d})}function Qg(a,b){return a.then(function(c){return b().then(function(){return c})},function(c){return b().then(function(){throw c})})}function gc(a,b){return function(){var c=arguments,d=this;return a.add(function(){return b.apply(d,c)})}}function wd(a){var b=new Qa(a),c=new Array(b.size),d=-1;return b.forEach(function(e){c[++d]=e}),c}function hc(a){var b=new Array(a.size),c=-1;return a.forEach(function(d,e){b[++c]=e}),b}function xd(a){var b="builtin "+a+" function requires map values to be numbers or number arrays";return new xb(b)}function ic(a){for(var b=0,c=0,d=a.length;c<d;c++){var e=a[c];if(typeof e!=="number")if(Array.isArray(e)){b=typeof b==="number"?[b]:b;for(var f=0,g=e.length;f<g;f++){var k=e[f];if(typeof k!=="number")throw xd("_sum");typeof b[f]==="undefined"?b.push(k):b[f]+=k}}else throw xd("_sum");else typeof b==="number"?b+=e:b[0]+=e}return b}var Rg=na.bind(null,"log"),Sg=Array.isArray,Tg=JSON.parse;function yd(a,b){return Kb("return ("+a.replace(/;\s*$/,"")+");",{emit:b,sum:ic,log:Rg,isArray:Sg,toJSON:Tg})}function ib(){this.promise=new Promise(function(a){a()})}ib.prototype.add=function(a){return this.promise=this.promise.catch(function(){}).then(function(){return a()}),this.promise},ib.prototype.finish=function(){return this.promise};function zd(a){if(!a)return"undefined";switch(typeof a){case"function":return a.toString();case"string":return a.toString();default:return JSON.stringify(a)}}function Ug(a,b){return zd(a)+zd(b)+"undefined"}function Ad(a,b,c,d,e,f){var g=Ug(c,d),k;if(!e){k=a._cachedViews=a._cachedViews||{};if(k[g])return k[g]}var n=a.info().then(function(v){var w=v.db_name+"-mrview-"+(e?"temp":Tc(g));function j(s){s.views=s.views||{};var u=b;u.indexOf("/")===-1&&(u=b+"/"+b);var p=s.views[u]=s.views[u]||{};return p[w]?void 0:(p[w]=!0,s)}return qb(a,"_local/"+f,j).then(function(){return a.registerDependentDatabase(w).then(function(s){var u=s.db;u.auto_compaction=!0;var p={name:w,db:u,sourceDB:a,adapter:a.adapter,mapFun:c,reduceFun:d};return p.db.get("_local/lastSeq").catch(function(r){if(r.status!==404)throw r}).then(function(r){return p.seq=r?r.seq:0,k&&p.db.once("destroyed",function(){delete k[g]}),p})})})});return k&&(k[g]=n),n}var Bd={},Cd=new ib(),Dd=50;function jc(a){return a.indexOf("/")===-1?[a,a]:a.split("/")}function Vg(a){return a.length===1&&/^1-/.test(a[0].rev)}function Ed(a,b){try{a.emit("error",b)}catch(c){na("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),na("error",b)}}function Wg(a,b,c,d){function e(x,y,A){try{y(A)}catch(F){Ed(x,F)}}function f(x,y,A,F,C){try{return{output:y(A,F,C)}}catch(z){return Ed(x,z),{error:z}}}function g(x,y){var A=ha(x.key,y.key);return A!==0?A:ha(x.value,y.value)}function k(x,y,A){return A=A||0,typeof y==="number"?x.slice(A,y+A):A>0?x.slice(A):x}function n(x){var y=x.value,A=y&&typeof y==="object"&&y._id||x.id;return A}function v(x){x.rows.forEach(function(y){var A=y.doc&&y.doc._attachments;if(!A)return;Object.keys(A).forEach(function(F){var C=A[F];A[F].data=Ob(C.data,C.content_type)})})}function w(x){return function(y){return x.include_docs&&x.attachments&&x.binary&&v(y),y}}function j(x,y,A,F){var C=y[x];typeof C!=="undefined"&&(F&&(C=encodeURIComponent(JSON.stringify(C))),A.push(x+"="+C))}function s(x){if(typeof x!=="undefined"){var y=Number(x);return!isNaN(y)&&y===parseInt(x,10)?y:x}}function u(x){return x.group_level=s(x.group_level),x.limit=s(x.limit),x.skip=s(x.skip),x}function p(x){if(x){if(typeof x!=="number")return new Ma('Invalid value for integer: "'+x+'"');if(x<0)return new Ma('Invalid value for positive integer: "'+x+'"')}}function r(x,y){var A=x.descending?"endkey":"startkey",F=x.descending?"startkey":"endkey";if(typeof x[A]!=="undefined"&&typeof x[F]!=="undefined"&&ha(x[A],x[F])>0)throw new Ma("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(y.reduce&&x.reduce!==!1){if(x.include_docs)throw new Ma("{include_docs:true} is invalid for reduce");if(x.keys&&x.keys.length>1&&!x.group&&!x.group_level)throw new Ma("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(C){var z=p(x[C]);if(z)throw z})}function t(x,y,A){var F=[],C,z="GET",D,J;j("reduce",A,F),j("include_docs",A,F),j("attachments",A,F),j("limit",A,F),j("descending",A,F),j("group",A,F),j("group_level",A,F),j("skip",A,F),j("stale",A,F),j("conflicts",A,F),j("startkey",A,F,!0),j("start_key",A,F,!0),j("endkey",A,F,!0),j("end_key",A,F,!0),j("inclusive_end",A,F),j("key",A,F,!0),j("update_seq",A,F),F=F.join("&"),F=F===""?"":"?"+F;if(typeof A.keys!=="undefined"){var K=2e3,O="keys="+encodeURIComponent(JSON.stringify(A.keys));O.length+F.length+1<=K?F+=(F[0]==="?"?"&":"?")+O:(z="POST",typeof y==="string"?C={keys:A.keys}:y.keys=A.keys)}if(typeof y==="string"){var L=jc(y);return x.fetch("_design/"+L[0]+"/_view/"+L[1]+F,{headers:new Va({"Content-Type":"application/json"}),method:z,body:JSON.stringify(C)}).then(function(E){return D=E.ok,J=E.status,E.json()}).then(function(E){if(!D)throw E.status=J,Ua(E);return E.rows.forEach(function(M){if(M.value&&M.value.error&&M.value.error==="builtin_reduce_error")throw new Error(M.reason)}),E}).then(w(A))}return C=C||{},Object.keys(y).forEach(function(E){Array.isArray(y[E])?C[E]=y[E]:C[E]=y[E].toString()}),x.fetch("_temp_view"+F,{headers:new Va({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(C)}).then(function(E){return D=E.ok,J=E.status,E.json()}).then(function(E){if(!D)throw E.status=J,Ua(E);return E}).then(w(A))}function q(x,y,A){return new Promise(function(F,C){x._query(y,A,function(z,D){if(z)return C(z);F(D)})})}function m(x){return new Promise(function(y,A){x._viewCleanup(function(F,C){if(F)return A(F);y(C)})})}function h(x){return function(y){if(y.status===404)return x;throw y}}function i(x,y,A){var F="_local/doc_"+x,C={_id:F,keys:[]},z=A.get(x),D=z[0],J=z[1];function K(){return Vg(J)?Promise.resolve(C):y.db.get(F).catch(h(C))}function O(E){return E.keys.length?y.db.allDocs({keys:E.keys,include_docs:!0}):Promise.resolve({rows:[]})}function L(E,M){for(var W=[],aa=new Qa(),Z=0,Y=M.rows.length;Z<Y;Z++){var _=M.rows[Z],ca=_.doc;if(!ca)continue;W.push(ca),aa.add(ca._id),ca._deleted=!D.has(ca._id);if(!ca._deleted){var pa=D.get(ca._id);"value"in pa&&(ca.value=pa.value)}}var la=hc(D);return la.forEach(function(kb){if(!aa.has(kb)){var lb={_id:kb},Pd=D.get(kb);"value"in Pd&&(lb.value=Pd.value),W.push(lb)}}),E.keys=wd(la.concat(E.keys)),W.push(E),W}return K().then(function(E){return O(E).then(function(M){return L(E,M)})})}function l(x,y,A){var F="_local/lastSeq";return x.db.get(F).catch(h({_id:F,seq:0})).then(function(C){var z=hc(y);return Promise.all(z.map(function(D){return i(D,x,y)})).then(function(D){var J=pb(D);return C.seq=A,J.push(C),x.db.bulkDocs({docs:J})})})}function o(x){var y=typeof x==="string"?x:x.name,A=Bd[y];return A||(A=Bd[y]=new ib()),A}function B(x){return gc(o(x),function(){return G(x)})()}function G(x){var y,A;function F(M,W){var aa={id:A._id,key:Ha(M)};typeof W!=="undefined"&&W!==null&&(aa.value=Ha(W)),y.push(aa)}var C=b(x.mapFun,F),z=x.seq||0;function D(M,W){return function(){return l(x,M,W)}}var J=new ib();function K(){return x.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:z,limit:Dd}).then(O)}function O(M){var W=M.results;if(!W.length)return;var aa=L(W);return J.add(D(aa,z)),W.length<Dd?void 0:K()}function L(M){for(var W=new ka(),aa=0,Z=M.length;aa<Z;aa++){var Y=M[aa];if(Y.doc._id[0]!=="_"){y=[],A=Y.doc,A._deleted||e(x.sourceDB,C,A),y.sort(g);var _=E(y);W.set(Y.doc._id,[_,Y.changes])}z=Y.seq}return W}function E(M){for(var W=new ka(),aa,Z=0,Y=M.length;Z<Y;Z++){var _=M[Z],ca=[_.key,_.id];Z>0&&ha(_.key,aa)===0&&ca.push(Z),W.set(sa(ca),_),aa=_.key}return W}return K().then(function(){return J.finish()}).then(function(){x.seq=z})}function I(x,y,A){A.group_level===0&&delete A.group_level;var F=A.group||A.group_level,C=c(x.reduceFun),z=[],D=isNaN(A.group_level)?Number.POSITIVE_INFINITY:A.group_level;y.forEach(function(E){var M=z[z.length-1],W=F?E.key:null;F&&Array.isArray(W)&&(W=W.slice(0,D));if(M&&ha(M.groupKey,W)===0){M.keys.push([E.key,E.id]),M.values.push(E.value);return}z.push({keys:[[E.key,E.id]],values:[E.value],groupKey:W})}),y=[];for(var J=0,K=z.length;J<K;J++){var O=z[J],L=f(x.sourceDB,C,O.keys,O.values,!1);if(L.error&&L.error instanceof xb)throw L.error;y.push({value:L.error?null:L.output,key:O.groupKey})}return{rows:k(y,A.limit,A.skip)}}function H(x,y){return gc(o(x),function(){return P(x,y)})()}function P(x,y){var A,F=x.reduceFun&&y.reduce!==!1,C=y.skip||0;typeof y.keys!=="undefined"&&!y.keys.length&&(y.limit=0,delete y.keys);function z(Z){return Z.include_docs=!0,x.db.allDocs(Z).then(function(Y){return A=Y.total_rows,Y.rows.map(function(_){if("value"in _.doc&&typeof _.doc.value==="object"&&_.doc.value!==null){var ca=Object.keys(_.doc.value).sort(),pa=["id","key","value"];if(!(ca<pa||ca>pa))return _.doc.value}var la=Nf(_.doc._id);return{key:la[0],id:la[1],value:"value"in _.doc?_.doc.value:null}})})}function D(Z){var Y;F?Y=I(x,Z,y):Y={total_rows:A,offset:C,rows:Z},y.update_seq&&(Y.update_seq=x.seq);if(y.include_docs){var _=wd(Z.map(n));return x.sourceDB.allDocs({keys:_,include_docs:!0,conflicts:y.conflicts,attachments:y.attachments,binary:y.binary}).then(function(ca){var pa=new ka();return ca.rows.forEach(function(la){pa.set(la.id,la.doc)}),Z.forEach(function(la){var kb=n(la),lb=pa.get(kb);lb&&(la.doc=lb)}),Y})}else return Y}if(typeof y.keys!=="undefined"){var J=y.keys,K=J.map(function(Z){var Y={startkey:sa([Z]),endkey:sa([Z,{}])};return y.update_seq&&(Y.update_seq=!0),z(Y)});return Promise.all(K).then(pb).then(D)}else{var O={descending:y.descending};y.update_seq&&(O.update_seq=!0);var L,E;"start_key"in y&&(L=y.start_key),"startkey"in y&&(L=y.startkey),"end_key"in y&&(E=y.end_key),"endkey"in y&&(E=y.endkey),typeof L!=="undefined"&&(O.startkey=y.descending?sa([L,{}]):sa([L]));if(typeof E!=="undefined"){var M=y.inclusive_end!==!1;y.descending&&(M=!M),O.endkey=sa(M?[E,{}]:[E])}if(typeof y.key!=="undefined"){var W=sa([y.key]),aa=sa([y.key,{}]);O.descending?(O.endkey=W,O.startkey=aa):(O.startkey=W,O.endkey=aa)}return F||(typeof y.limit==="number"&&(O.limit=y.limit),O.skip=C),z(O).then(D)}}function T(x){return x.fetch("_view_cleanup",{headers:new Va({"Content-Type":"application/json"}),method:"POST"}).then(function(y){return y.json()})}function R(x){return x.get("_local/"+a).then(function(y){var A=new ka();Object.keys(y.views).forEach(function(C){var z=jc(C),D="_design/"+z[0],J=z[1],K=A.get(D);K||(K=new Qa(),A.set(D,K)),K.add(J)});var F={keys:hc(A),include_docs:!0};return x.allDocs(F).then(function(C){var z={};C.rows.forEach(function(K){var O=K.key.substring(8);A.get(K.key).forEach(function(L){var E=O+"/"+L;y.views[E]||(E=L);var M=Object.keys(y.views[E]),W=K.doc&&K.doc.views&&K.doc.views[L];M.forEach(function(aa){z[aa]=z[aa]||W})})});var D=Object.keys(z).filter(function(K){return!z[K]}),J=D.map(function(K){return gc(o(K),function(){return new x.constructor(K,x.__opts).destroy()})()});return Promise.all(J).then(function(){return{ok:!0}})})},h({ok:!0}))}function Q(x,y,A){if(typeof x._query==="function")return q(x,y,A);if(va(x))return t(x,y,A);if(typeof y!=="string")return r(A,y),Cd.add(function(){var J=Ad(x,"temp_view/temp_view",y.map,y.reduce,!0,a);return J.then(function(K){return Qg(B(K).then(function(){return H(K,A)}),function(){return K.db.destroy()})})}),Cd.finish();{var F=y,C=jc(F),z=C[0],D=C[1];return x.get("_design/"+z).then(function(J){var K=J.views&&J.views[D];if(!K)throw new wb("ddoc "+J._id+" has no view named "+D);d(J,D),r(A,K);var O=Ad(x,F,K.map,K.reduce,!1,a);return O.then(function(L){return A.stale==="ok"||A.stale==="update_after"?(A.stale==="update_after"&&ua(function(){B(L)}),H(L,A)):B(L).then(function(){return H(L,A)})})})}}function N(x,y,A){var F=this;typeof y==="function"&&(A=y,y={}),y=y?u(y):{},typeof x==="function"&&(x={map:x});var C=Promise.resolve().then(function(){return Q(F,x,y)});return vd(C,A),C}var X=Pg(function(){var x=this;return typeof x._viewCleanup==="function"?m(x):va(x)?T(x):R(x)});return{query:N,viewCleanup:X}}var kc={_sum:function(a,b){return ic(b)},_count:function(a,b){return b.length},_stats:function(a,b){function c(d){for(var e=0,f=0,g=d.length;f<g;f++){var k=d[f];e+=k*k}return e}return{sum:ic(b),min:Math.min.apply(null,b),max:Math.max.apply(null,b),count:b.length,sumsqr:c(b)}}};function Xg(a){if(/^_sum/.test(a))return kc._sum;{if(/^_count/.test(a))return kc._count;{if(/^_stats/.test(a))return kc._stats;if(/^_/.test(a))throw new Error(a+" is not a supported reduce function.")}}}function Yg(a,b){if(typeof a==="function"&&a.length===2){var c=a;return function(d){return c(d,b)}}else return yd(a.toString(),b)}function Zg(a){var b=a.toString(),c=Xg(b);return c?c:yd(b)}function _g(a,b){var c=a.views&&a.views[b];if(typeof c.map!=="string")throw new wb("ddoc "+a._id+" has no string view named "+b+", instead found object of type: "+typeof c.map)}var $g="mrviews",Fd=Wg($g,Yg,Zg,_g);function ah(a,b,c){return Fd.query.call(this,a,b,c)}function bh(a){return Fd.viewCleanup.call(this,a)}var ch={query:ah,viewCleanup:bh};function Gd(a){return/^1-/.test(a)}function dh(a,b,c){return!a._attachments||!a._attachments[c]||a._attachments[c].digest!==b._attachments[c].digest}function Hd(a,b){var c=Object.keys(b._attachments);return Promise.all(c.map(function(d){return a.getAttachment(b._id,d,{rev:b._rev})}))}function eh(a,b,c){var d=va(b)&&!va(a),e=Object.keys(c._attachments);return d?a.get(c._id).then(function(f){return Promise.all(e.map(function(g){return dh(f,c,g)?b.getAttachment(c._id,g):a.getAttachment(f._id,g)}))}).catch(function(f){if(f.status!==404)throw f;return Hd(b,c)}):Hd(b,c)}function fh(a){var b=[];return Object.keys(a).forEach(function(c){var d=a[c].missing;d.forEach(function(e){b.push({id:c,rev:e})})}),{docs:b,revs:!0,latest:!0}}function gh(a,b,c,d){c=fa(c);var e=[],f=!0;function g(){var s=fh(c);return s.docs.length?a.bulkGet(s).then(function(u){if(d.cancelled)throw new Error("cancelled");return Promise.all(u.results.map(function(p){return Promise.all(p.docs.map(function(r){var t=r.ok;return r.error&&(f=!1),!t||!t._attachments?t:eh(b,a,t).then(function(q){var m=Object.keys(t._attachments);return q.forEach(function(h,i){var l=t._attachments[m[i]];delete l.stub,delete l.length,l.data=h}),t})}))})).then(function(p){e=e.concat(pb(p).filter(Boolean))})}):void 0}function k(s){return s._attachments&&Object.keys(s._attachments).length>0}function n(s){return s._conflicts&&s._conflicts.length>0}function v(s){return a.allDocs({keys:s,include_docs:!0,conflicts:!0}).then(function(u){if(d.cancelled)throw new Error("cancelled");u.rows.forEach(function(p){if(p.deleted||!p.doc||!Gd(p.value.rev)||k(p.doc)||n(p.doc))return;p.doc._conflicts&&delete p.doc._conflicts,e.push(p.doc),delete c[p.id]})})}function w(){var s=Object.keys(c).filter(function(u){var p=c[u].missing;return p.length===1&&Gd(p[0])});if(s.length>0)return v(s)}function j(){return{ok:f,docs:e}}return Promise.resolve().then(w).then(g).then(j)}var Id=1,Jd="pouchdb",hh=5,ya=0;function lc(a,b,c,d,e){return a.get(b).catch(function(f){if(f.status===404)return(a.adapter==="http"||a.adapter==="https")&&Eb(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:d,_id:b,history:[],replicator:Jd,version:Id};throw f}).then(function(f){return e.cancelled?void 0:f.last_seq===c?void 0:(f.history=(f.history||[]).filter(function(g){return g.session_id!==d}),f.history.unshift({last_seq:c,session_id:d}),f.history=f.history.slice(0,hh),f.version=Id,f.replicator=Jd,f.session_id=d,f.last_seq=c,a.put(f).catch(function(g){if(g.status===409)return lc(a,b,c,d,e);throw g}))})}function jb(a,b,c,d,e){this.src=a,this.target=b,this.id=c,this.returnValue=d,this.opts=e||{}}jb.prototype.writeCheckpoint=function(a,b){var c=this;return this.updateTarget(a,b).then(function(){return c.updateSource(a,b)})},jb.prototype.updateTarget=function(a,b){return this.opts.writeTargetCheckpoint?lc(this.target,this.id,a,b,this.returnValue):Promise.resolve(!0)},jb.prototype.updateSource=function(a,b){if(this.opts.writeSourceCheckpoint){var c=this;return lc(this.src,this.id,a,b,this.returnValue).catch(function(d){if(Md(d))return c.opts.writeSourceCheckpoint=!1,!0;throw d})}else return Promise.resolve(!0)};var Kd={undefined:function(a,b){return ha(a.last_seq,b.last_seq)===0?b.last_seq:0},"1":function(a,b){return ih(b,a).last_seq}};jb.prototype.getCheckpoint=function(){var a=this;return a.opts&&a.opts.writeSourceCheckpoint&&!a.opts.writeTargetCheckpoint?a.src.get(a.id).then(function(b){return b.last_seq||ya}).catch(function(b){if(b.status!==404)throw b;return ya}):a.target.get(a.id).then(function(b){return a.opts&&a.opts.writeTargetCheckpoint&&!a.opts.writeSourceCheckpoint?b.last_seq||ya:a.src.get(a.id).then(function(c){if(b.version!==c.version)return ya;var d;return b.version?d=b.version.toString():d="undefined",d in Kd?Kd[d](b,c):ya},function(c){if(c.status===404&&b.last_seq)return a.src.put({_id:a.id,last_seq:ya}).then(function(){return ya},function(d){return Md(d)?(a.opts.writeSourceCheckpoint=!1,b.last_seq):ya});throw c})}).catch(function(b){if(b.status!==404)throw b;return ya})};function ih(a,b){return a.session_id===b.session_id?{last_seq:a.last_seq,history:a.history}:Ld(a.history,b.history)}function Ld(a,b){var c=a[0],d=a.slice(1),e=b[0],f=b.slice(1);if(!c||b.length===0)return{last_seq:ya,history:[]};var g=c.session_id;if(mc(g,b))return{last_seq:c.last_seq,history:a};var k=e.session_id;return mc(k,d)?{last_seq:e.last_seq,history:f}:Ld(d,f)}function mc(a,b){var c=b[0],d=b.slice(1);return!a||b.length===0?!1:a===c.session_id?!0:mc(a,d)}function Md(a){return typeof a.status==="number"&&Math.floor(a.status/100)===4}var Nd=0;function jh(a,b,c,d){if(a.retry===!1){b.emit("error",c),b.removeAllListeners();return}typeof a.back_off_function!=="function"&&(a.back_off_function=Le),b.emit("requestError",c);if(b.state==="active"||b.state==="pending"){b.emit("paused",c),b.state="stopped";var e=function g(){a.current_back_off=Nd},f=function g(){b.removeListener("active",e)};b.once("paused",f),b.once("active",e)}a.current_back_off=a.current_back_off||Nd,a.current_back_off=a.back_off_function(a.current_back_off),setTimeout(d,a.current_back_off)}function kh(a){return Object.keys(a).sort(ha).reduce(function(b,c){return b[c]=a[c],b},{})}function lh(a,b,c){var d=c.doc_ids?c.doc_ids.sort(ha):"",e=c.filter?c.filter.toString():"",f="",g="",k="";return c.selector&&(k=JSON.stringify(c.selector)),c.filter&&c.query_params&&(f=JSON.stringify(kh(c.query_params))),c.filter&&c.filter==="_view"&&(g=c.view.toString()),Promise.all([a.id(),b.id()]).then(function(n){var v=n[0]+n[1]+e+g+f+d+k;return new Promise(function(w){Qb(v,w)})}).then(function(n){return n=n.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+n})}function Od(a,b,c,d,e){var f=[],g,k={seq:0,changes:[],docs:[]},n=!1,v=!1,w=!1,j=0,s=c.continuous||c.live||!1,u=c.batch_size||100,p=c.batches_limit||10,r=!1,t=c.doc_ids,q=c.selector,m,h,i=[],l=rb();e=e||{ok:!0,start_time:new Date().toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var o={};d.ready(a,b);function B(){return h?Promise.resolve():lh(a,b,c).then(function(z){m=z;var D={};c.checkpoint===!1?D={writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:c.checkpoint==="source"?D={writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:c.checkpoint==="target"?D={writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:D={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},h=new jb(a,b,m,d,D)})}function G(){i=[];if(g.docs.length===0)return;var z=g.docs,D={timeout:c.timeout};return b.bulkDocs({docs:z,new_edits:!1},D).then(function(J){if(d.cancelled)throw N(),new Error("cancelled");var K=Object.create(null);J.forEach(function(L){L.error&&(K[L.id]=L)});var O=Object.keys(K).length;e.doc_write_failures+=O,e.docs_written+=z.length-O,z.forEach(function(L){var E=K[L._id];if(E){e.errors.push(E);var M=(E.name||"").toLowerCase();if(M==="unauthorized"||M==="forbidden")d.emit("denied",fa(E));else throw E}else i.push(L)})},function(J){throw e.doc_write_failures+=z.length,J})}function I(){if(g.error)throw new Error("There was a problem getting docs.");e.last_seq=j=g.seq;var z=fa(e);return i.length&&(z.docs=i,typeof g.pending==="number"&&(z.pending=g.pending,delete g.pending),d.emit("change",z)),n=!0,h.writeCheckpoint(g.seq,l).then(function(){n=!1;if(d.cancelled)throw N(),new Error("cancelled");g=void 0,A()}).catch(function(D){throw C(D),D})}function H(){var z={};return g.changes.forEach(function(D){if(D.id==="_user/")return;z[D.id]=D.changes.map(function(J){return J.rev})}),b.revsDiff(z).then(function(D){if(d.cancelled)throw N(),new Error("cancelled");g.diffs=D})}function P(){return gh(a,b,g.diffs,d).then(function(z){g.error=!z.ok,z.docs.forEach(function(D){delete g.diffs[D._id],e.docs_read++,g.docs.push(D)})})}function T(){if(d.cancelled||g)return;if(f.length===0){R(!0);return}g=f.shift(),H().then(P).then(G).then(I).then(T).catch(function(z){Q("batch processing terminated with error",z)})}function R(z){if(k.changes.length===0){f.length===0&&!g&&((s&&o.live||v)&&(d.state="pending",d.emit("paused")),v&&N());return}(z||v||k.changes.length>=u)&&(f.push(k),k={seq:0,changes:[],docs:[]},(d.state==="pending"||d.state==="stopped")&&(d.state="active",d.emit("active")),T())}function Q(z,D){if(w)return;D.message||(D.message=z),e.ok=!1,e.status="aborting",f=[],k={seq:0,changes:[],docs:[]},N(D)}function N(z){if(w)return;if(d.cancelled){e.status="cancelled";if(n)return}e.status=e.status||"complete",e.end_time=new Date().toISOString(),e.last_seq=j,w=!0;if(z){z=V(z),z.result=e;var D=(z.name||"").toLowerCase();D==="unauthorized"||D==="forbidden"?(d.emit("error",z),d.removeAllListeners()):jh(c,d,z,function(){Od(a,b,c,d)})}else d.emit("complete",e),d.removeAllListeners()}function X(z,D,J){if(d.cancelled)return N();typeof D==="number"&&(k.pending=D);var K=Ib(c)(z);if(!K)return;k.seq=z.seq||J,k.changes.push(z),ua(function(){R(f.length===0&&o.live)})}function x(z){r=!1;if(d.cancelled)return N();if(z.results.length>0)o.since=z.results[z.results.length-1].seq,A(),R(!0);else{var D=function(){s?(o.live=!0,A()):v=!0,R(!0)};!g&&z.results.length===0?(n=!0,h.writeCheckpoint(z.last_seq,l).then(function(){n=!1,e.last_seq=j=z.last_seq,D()}).catch(C)):D()}}function y(z){r=!1;if(d.cancelled)return N();Q("changes rejected",z)}function A(){if(!(!r&&!v&&f.length<p))return;r=!0;function z(){J.cancel()}function D(){d.removeListener("cancel",z)}d._changes&&(d.removeListener("cancel",d._abortChanges),d._changes.cancel()),d.once("cancel",z);var J=a.changes(o).on("change",X);J.then(D,D),J.then(x).catch(y),c.retry&&(d._changes=J,d._abortChanges=z)}function F(){B().then(function(){if(d.cancelled){N();return}return h.getCheckpoint().then(function(z){j=z,o={since:j,limit:u,batch_size:u,style:"all_docs",doc_ids:t,selector:q,return_docs:!0},c.filter&&(typeof c.filter!=="string"?o.include_docs=!0:o.filter=c.filter),"heartbeat"in c&&(o.heartbeat=c.heartbeat),"timeout"in c&&(o.timeout=c.timeout),c.query_params&&(o.query_params=c.query_params),c.view&&(o.view=c.view),A()})}).catch(function(z){Q("getCheckpoint rejected with ",z)})}function C(z){n=!1,Q("writeCheckpoint completed with error",z)}if(d.cancelled){N();return}d._addedListeners||(d.once("cancel",N),typeof c.complete==="function"&&(d.once("error",c.complete),d.once("complete",function(z){c.complete(null,z)})),d._addedListeners=!0),typeof c.since==="undefined"?F():B().then(function(){return n=!0,h.writeCheckpoint(c.since,l)}).then(function(){n=!1;if(d.cancelled){N();return}j=c.since,F()}).catch(C)}qa(yb,U);function yb(){U.call(this),this.cancelled=!1,this.state="pending";var a=this,b=new Promise(function(c,d){a.once("complete",c),a.once("error",d)});a.then=function(c,d){return b.then(c,d)},a.catch=function(c){return b.catch(c)},a.catch(function(){})}yb.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},yb.prototype.ready=function(a,b){var c=this;if(c._readyCalled)return;c._readyCalled=!0;function d(){c.cancel()}a.once("destroyed",d),b.once("destroyed",d);function e(){a.removeListener("destroyed",d),b.removeListener("destroyed",d)}c.once("complete",e)};function zb(a,b){var c=b.PouchConstructor;return typeof a==="string"?new c(a,b):a}function nc(a,b,c,d){typeof c==="function"&&(d=c,c={}),typeof c==="undefined"&&(c={});if(c.doc_ids&&!Array.isArray(c.doc_ids))throw V(ob,"`doc_ids` filter parameter is not a list.");c.complete=d,c=fa(c),c.continuous=c.continuous||c.live,c.retry="retry"in c?c.retry:!1,c.PouchConstructor=c.PouchConstructor||this;var e=new yb(c),f=zb(a,c),g=zb(b,c);return Od(f,g,c,e),e}qa(oc,U);function mh(a,b,c,d){return typeof c==="function"&&(d=c,c={}),typeof c==="undefined"&&(c={}),c=fa(c),c.PouchConstructor=c.PouchConstructor||this,a=zb(a,c),b=zb(b,c),new oc(a,b,c,d)}function oc(a,b,c,d){var e=this;this.canceled=!1;var f=c.push?Sa({},c,c.push):c,g=c.pull?Sa({},c,c.pull):c;this.push=nc(a,b,f),this.pull=nc(b,a,g),this.pushPaused=!0,this.pullPaused=!0;function k(h){e.emit("change",{direction:"pull",change:h})}function n(h){e.emit("change",{direction:"push",change:h})}function v(h){e.emit("denied",{direction:"push",doc:h})}function w(h){e.emit("denied",{direction:"pull",doc:h})}function j(){e.pushPaused=!0,e.pullPaused&&e.emit("paused")}function s(){e.pullPaused=!0,e.pushPaused&&e.emit("paused")}function u(){e.pushPaused=!1,e.pullPaused&&e.emit("active",{direction:"push"})}function p(){e.pullPaused=!1,e.pushPaused&&e.emit("active",{direction:"pull"})}var r={};function t(h){return function(i,l){var o=i==="change"&&(l===k||l===n),B=i==="denied"&&(l===w||l===v),G=i==="paused"&&(l===s||l===j),I=i==="active"&&(l===p||l===u);(o||B||G||I)&&(i in r||(r[i]={}),r[i][h]=!0,Object.keys(r[i]).length===2&&e.removeAllListeners(i))}}c.live&&(this.push.on("complete",e.pull.cancel.bind(e.pull)),this.pull.on("complete",e.push.cancel.bind(e.push)));function q(h,i,l){h.listeners(i).indexOf(l)==-1&&h.on(i,l)}this.on("newListener",function(h){h==="change"?(q(e.pull,"change",k),q(e.push,"change",n)):h==="denied"?(q(e.pull,"denied",w),q(e.push,"denied",v)):h==="active"?(q(e.pull,"active",p),q(e.push,"active",u)):h==="paused"&&(q(e.pull,"paused",s),q(e.push,"paused",j))}),this.on("removeListener",function(h){h==="change"?(e.pull.removeListener("change",k),e.push.removeListener("change",n)):h==="denied"?(e.pull.removeListener("denied",w),e.push.removeListener("denied",v)):h==="active"?(e.pull.removeListener("active",p),e.push.removeListener("active",u)):h==="paused"&&(e.pull.removeListener("paused",s),e.push.removeListener("paused",j))}),this.pull.on("removeListener",t("pull")),this.push.on("removeListener",t("push"));var m=Promise.all([this.push,this.pull]).then(function(h){var i={push:h[0],pull:h[1]};return e.emit("complete",i),d&&d(null,i),e.removeAllListeners(),i},function(h){e.cancel(),d?d(h):e.emit("error",h),e.removeAllListeners();if(d)throw h});this.then=function(h,i){return m.then(h,i)},this.catch=function(h){return m.catch(h)}}oc.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};function nh(a){a.replicate=nc,a.sync=mh,Object.defineProperty(a.prototype,"replicate",{get:function(){var b=this;return typeof this.replicateMethods==="undefined"&&(this.replicateMethods={from:function(c,d,e){return b.constructor.replicate(c,b,d,e)},to:function(c,d,e){return b.constructor.replicate(b,c,d,e)}}),this.replicateMethods}}),a.prototype.sync=function(b,c,d){return this.constructor.sync(this,b,c,d)}}S.plugin(Gg).plugin(Og).plugin(ch).plugin(nh);export default S;
