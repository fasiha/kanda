import{c as de,g as ri,a as Cn}from"./common/_commonjsHelpers-ef01b4ac.js";function Tn(){throw new Error("setTimeout has not been defined")}function qn(){throw new Error("clearTimeout has not been defined")}var Te=Tn,qe=qn;typeof window.setTimeout=="function"&&(Te=setTimeout),typeof window.clearTimeout=="function"&&(qe=clearTimeout);function Dn(e){if(Te===setTimeout)return setTimeout(e,0);if((Te===Tn||!Te)&&setTimeout)return Te=setTimeout,setTimeout(e,0);try{return Te(e,0)}catch(t){try{return Te.call(null,e,0)}catch(n){return Te.call(this,e,0)}}}function ii(e){if(qe===clearTimeout)return clearTimeout(e);if((qe===qn||!qe)&&clearTimeout)return qe=clearTimeout,clearTimeout(e);try{return qe(e)}catch(t){try{return qe.call(null,e)}catch(n){return qe.call(this,e)}}}var ke=[],ze=!1,Be,_t=-1;function ai(){if(!ze||!Be)return;ze=!1,Be.length?ke=Be.concat(ke):_t=-1,ke.length&&En()}function En(){if(ze)return;var e=Dn(ai);ze=!0;for(var t=ke.length;t;){for(Be=ke,ke=[];++_t<t;)Be&&Be[_t].run();_t=-1,t=ke.length}Be=null,ze=!1,ii(e)}function oi(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];ke.push(new On(e,t)),ke.length===1&&!ze&&Dn(En)}function On(e,t){this.fun=e,this.array=t}On.prototype.run=function(){this.fun.apply(null,this.array)};var si="browser",ui="browser",ci=!0,fi=[],li="",hi={},di={},vi={};function Ie(){}var gi=Ie,pi=Ie,mi=Ie,yi=Ie,_i=Ie,bi=Ie,wi=Ie;function Ai(e){throw new Error("process.binding is not supported")}function Si(){return"/"}function xi(e){throw new Error("process.chdir is not supported")}function ki(){return 0}var Je=window.performance||{},Ci=Je.now||Je.mozNow||Je.msNow||Je.oNow||Je.webkitNow||function(){return new Date().getTime()};function Ti(e){var t=Ci.call(Je)*.001,n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n=n-e[0],r=r-e[1],r<0&&(n--,r+=1e9)),[n,r]}var qi=new Date();function Di(){var e=new Date(),t=e-qi;return t/1e3}var bt={nextTick:oi,title:si,browser:ci,env:{NODE_ENV:"production"},argv:fi,version:li,versions:hi,on:gi,addListener:pi,once:mi,off:yi,removeListener:_i,removeAllListeners:bi,emit:wi,binding:Ai,cwd:Si,chdir:xi,umask:ki,hrtime:Ti,platform:ui,release:di,config:vi,uptime:Di},Ei={},Oi=Object.freeze({__proto__:null,default:Ei}),Bi=function(){return typeof de.queueMicrotask=="function"},Ii=function(e){return function(){de.queueMicrotask(e)}},Pi={test:Bi,install:Ii},Bn=de.MutationObserver||de.WebKitMutationObserver,Ri=function(){return Bn},Li=function(e){var t=0,n=new Bn(e),r=de.document.createTextNode("");return n.observe(r,{characterData:!0}),function(){r.data=t=++t%2}},ji={test:Ri,install:Li},$i=function(){return de.setImmediate?!1:typeof de.MessageChannel!="undefined"},Ni=function(e){var t=new de.MessageChannel();return t.port1.onmessage=e,function(){t.port2.postMessage(0)}},Fi={test:$i,install:Ni},Ui=function(){return"document"in de&&"onreadystatechange"in de.document.createElement("script")},Mi=function(e){return function(){var t=de.document.createElement("script");return t.onreadystatechange=function(){e(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},de.document.documentElement.appendChild(t),e}},Gi={test:Ui,install:Mi},zi=function(){return!0},Ji=function(e){return function(){setTimeout(e,0)}},Wi={test:zi,install:Ji},Qi=ri(Oi),at=[Qi,Pi,ji,Fi,Gi,Wi],We,Pe,ot=-1,De=[],Rt=!1;function Xi(){if(!We||!Pe)return;We=!1,Pe.length?De=Pe.concat(De):ot=-1,De.length&&In()}function In(){if(We)return;Rt=!1,We=!0;for(var e=De.length,t=setTimeout(Xi);e;){for(Pe=De,De=[];Pe&&++ot<e;)Pe[ot].run();ot=-1,e=De.length}Pe=null,ot=-1,We=!1,clearTimeout(t)}for(var Pn,st=-1,Ki=at.length;++st<Ki;)if(at[st]&&at[st].test&&at[st].test()){Pn=at[st].install(In);break}function Rn(e,t){this.fun=e,this.array=t}Rn.prototype.run=function(){var e=this.fun,t=this.array;switch(t.length){case 0:return e();case 1:return e(t[0]);case 2:return e(t[0],t[1]);case 3:return e(t[0],t[1],t[2]);default:return e.apply(null,t)}};var be=Hi;function Hi(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];De.push(new Rn(e,t)),!Rt&&!We&&(Rt=!0,Pn())}var Ln=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),Yi=new Uint8Array(16);function Zi(){if(!Ln)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ln(Yi)}for(var jn=[],Lt=0;Lt<256;++Lt)jn.push((Lt+256).toString(16).substr(1));function Vi(e,t){var n=t||0,r=jn;return(r[e[n+0]]+r[e[n+1]]+r[e[n+2]]+r[e[n+3]]+"-"+r[e[n+4]]+r[e[n+5]]+"-"+r[e[n+6]]+r[e[n+7]]+"-"+r[e[n+8]]+r[e[n+9]]+"-"+r[e[n+10]]+r[e[n+11]]+r[e[n+12]]+r[e[n+13]]+r[e[n+14]]+r[e[n+15]]).toLowerCase()}function $n(e,t,n){typeof e=="string"&&(t=e==="binary"?new Uint8Array(16):null,e=null),e=e||{};var r=e.random||(e.rng||Zi)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){for(var i=n||0,a=0;a<16;++a)t[i+a]=r[a];return t}return Vi(r)}var jt=Cn(function(e,t){(function(n){e.exports=n()})(function(n){var r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function i(p,h){var s=p[0],u=p[1],l=p[2],v=p[3];s+=(u&l|~u&v)+h[0]-680876936|0,s=(s<<7|s>>>25)+u|0,v+=(s&u|~s&l)+h[1]-389564586|0,v=(v<<12|v>>>20)+s|0,l+=(v&s|~v&u)+h[2]+606105819|0,l=(l<<17|l>>>15)+v|0,u+=(l&v|~l&s)+h[3]-1044525330|0,u=(u<<22|u>>>10)+l|0,s+=(u&l|~u&v)+h[4]-176418897|0,s=(s<<7|s>>>25)+u|0,v+=(s&u|~s&l)+h[5]+1200080426|0,v=(v<<12|v>>>20)+s|0,l+=(v&s|~v&u)+h[6]-1473231341|0,l=(l<<17|l>>>15)+v|0,u+=(l&v|~l&s)+h[7]-45705983|0,u=(u<<22|u>>>10)+l|0,s+=(u&l|~u&v)+h[8]+1770035416|0,s=(s<<7|s>>>25)+u|0,v+=(s&u|~s&l)+h[9]-1958414417|0,v=(v<<12|v>>>20)+s|0,l+=(v&s|~v&u)+h[10]-42063|0,l=(l<<17|l>>>15)+v|0,u+=(l&v|~l&s)+h[11]-1990404162|0,u=(u<<22|u>>>10)+l|0,s+=(u&l|~u&v)+h[12]+1804603682|0,s=(s<<7|s>>>25)+u|0,v+=(s&u|~s&l)+h[13]-40341101|0,v=(v<<12|v>>>20)+s|0,l+=(v&s|~v&u)+h[14]-1502002290|0,l=(l<<17|l>>>15)+v|0,u+=(l&v|~l&s)+h[15]+1236535329|0,u=(u<<22|u>>>10)+l|0,s+=(u&v|l&~v)+h[1]-165796510|0,s=(s<<5|s>>>27)+u|0,v+=(s&l|u&~l)+h[6]-1069501632|0,v=(v<<9|v>>>23)+s|0,l+=(v&u|s&~u)+h[11]+643717713|0,l=(l<<14|l>>>18)+v|0,u+=(l&s|v&~s)+h[0]-373897302|0,u=(u<<20|u>>>12)+l|0,s+=(u&v|l&~v)+h[5]-701558691|0,s=(s<<5|s>>>27)+u|0,v+=(s&l|u&~l)+h[10]+38016083|0,v=(v<<9|v>>>23)+s|0,l+=(v&u|s&~u)+h[15]-660478335|0,l=(l<<14|l>>>18)+v|0,u+=(l&s|v&~s)+h[4]-405537848|0,u=(u<<20|u>>>12)+l|0,s+=(u&v|l&~v)+h[9]+568446438|0,s=(s<<5|s>>>27)+u|0,v+=(s&l|u&~l)+h[14]-1019803690|0,v=(v<<9|v>>>23)+s|0,l+=(v&u|s&~u)+h[3]-187363961|0,l=(l<<14|l>>>18)+v|0,u+=(l&s|v&~s)+h[8]+1163531501|0,u=(u<<20|u>>>12)+l|0,s+=(u&v|l&~v)+h[13]-1444681467|0,s=(s<<5|s>>>27)+u|0,v+=(s&l|u&~l)+h[2]-51403784|0,v=(v<<9|v>>>23)+s|0,l+=(v&u|s&~u)+h[7]+1735328473|0,l=(l<<14|l>>>18)+v|0,u+=(l&s|v&~s)+h[12]-1926607734|0,u=(u<<20|u>>>12)+l|0,s+=(u^l^v)+h[5]-378558|0,s=(s<<4|s>>>28)+u|0,v+=(s^u^l)+h[8]-2022574463|0,v=(v<<11|v>>>21)+s|0,l+=(v^s^u)+h[11]+1839030562|0,l=(l<<16|l>>>16)+v|0,u+=(l^v^s)+h[14]-35309556|0,u=(u<<23|u>>>9)+l|0,s+=(u^l^v)+h[1]-1530992060|0,s=(s<<4|s>>>28)+u|0,v+=(s^u^l)+h[4]+1272893353|0,v=(v<<11|v>>>21)+s|0,l+=(v^s^u)+h[7]-155497632|0,l=(l<<16|l>>>16)+v|0,u+=(l^v^s)+h[10]-1094730640|0,u=(u<<23|u>>>9)+l|0,s+=(u^l^v)+h[13]+681279174|0,s=(s<<4|s>>>28)+u|0,v+=(s^u^l)+h[0]-358537222|0,v=(v<<11|v>>>21)+s|0,l+=(v^s^u)+h[3]-722521979|0,l=(l<<16|l>>>16)+v|0,u+=(l^v^s)+h[6]+76029189|0,u=(u<<23|u>>>9)+l|0,s+=(u^l^v)+h[9]-640364487|0,s=(s<<4|s>>>28)+u|0,v+=(s^u^l)+h[12]-421815835|0,v=(v<<11|v>>>21)+s|0,l+=(v^s^u)+h[15]+530742520|0,l=(l<<16|l>>>16)+v|0,u+=(l^v^s)+h[2]-995338651|0,u=(u<<23|u>>>9)+l|0,s+=(l^(u|~v))+h[0]-198630844|0,s=(s<<6|s>>>26)+u|0,v+=(u^(s|~l))+h[7]+1126891415|0,v=(v<<10|v>>>22)+s|0,l+=(s^(v|~u))+h[14]-1416354905|0,l=(l<<15|l>>>17)+v|0,u+=(v^(l|~s))+h[5]-57434055|0,u=(u<<21|u>>>11)+l|0,s+=(l^(u|~v))+h[12]+1700485571|0,s=(s<<6|s>>>26)+u|0,v+=(u^(s|~l))+h[3]-1894986606|0,v=(v<<10|v>>>22)+s|0,l+=(s^(v|~u))+h[10]-1051523|0,l=(l<<15|l>>>17)+v|0,u+=(v^(l|~s))+h[1]-2054922799|0,u=(u<<21|u>>>11)+l|0,s+=(l^(u|~v))+h[8]+1873313359|0,s=(s<<6|s>>>26)+u|0,v+=(u^(s|~l))+h[15]-30611744|0,v=(v<<10|v>>>22)+s|0,l+=(s^(v|~u))+h[6]-1560198380|0,l=(l<<15|l>>>17)+v|0,u+=(v^(l|~s))+h[13]+1309151649|0,u=(u<<21|u>>>11)+l|0,s+=(l^(u|~v))+h[4]-145523070|0,s=(s<<6|s>>>26)+u|0,v+=(u^(s|~l))+h[11]-1120210379|0,v=(v<<10|v>>>22)+s|0,l+=(s^(v|~u))+h[2]+718787259|0,l=(l<<15|l>>>17)+v|0,u+=(v^(l|~s))+h[9]-343485551|0,u=(u<<21|u>>>11)+l|0,p[0]=s+p[0]|0,p[1]=u+p[1]|0,p[2]=l+p[2]|0,p[3]=v+p[3]|0}function a(p){var h=[],s;for(s=0;s<64;s+=4)h[s>>2]=p.charCodeAt(s)+(p.charCodeAt(s+1)<<8)+(p.charCodeAt(s+2)<<16)+(p.charCodeAt(s+3)<<24);return h}function o(p){var h=[],s;for(s=0;s<64;s+=4)h[s>>2]=p[s]+(p[s+1]<<8)+(p[s+2]<<16)+(p[s+3]<<24);return h}function f(p){var h=p.length,s=[1732584193,-271733879,-1732584194,271733878],u,l,v,T,B,P;for(u=64;u<=h;u+=64)i(s,a(p.substring(u-64,u)));for(p=p.substring(u-64),l=p.length,v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=0;u<l;u+=1)v[u>>2]|=p.charCodeAt(u)<<(u%4<<3);if(v[u>>2]|=128<<(u%4<<3),u>55)for(i(s,v),u=0;u<16;u+=1)v[u]=0;return T=h*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),B=parseInt(T[2],16),P=parseInt(T[1],16)||0,v[14]=B,v[15]=P,i(s,v),s}function d(p){var h=p.length,s=[1732584193,-271733879,-1732584194,271733878],u,l,v,T,B,P;for(u=64;u<=h;u+=64)i(s,o(p.subarray(u-64,u)));for(p=u-64<h?p.subarray(u-64):new Uint8Array(0),l=p.length,v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=0;u<l;u+=1)v[u>>2]|=p[u]<<(u%4<<3);if(v[u>>2]|=128<<(u%4<<3),u>55)for(i(s,v),u=0;u<16;u+=1)v[u]=0;return T=h*8,T=T.toString(16).match(/(.*?)(.{0,8})$/),B=parseInt(T[2],16),P=parseInt(T[1],16)||0,v[14]=B,v[15]=P,i(s,v),s}function w(p){var h="",s;for(s=0;s<4;s+=1)h+=r[p>>s*8+4&15]+r[p>>s*8&15];return h}function A(p){var h;for(h=0;h<p.length;h+=1)p[h]=w(p[h]);return p.join("")}A(f("hello"))!=="5d41402abc4b2a76b9719d911017c592",typeof ArrayBuffer!="undefined"&&!ArrayBuffer.prototype.slice&&function(){function p(h,s){return h=h|0||0,h<0?Math.max(h+s,0):Math.min(h,s)}ArrayBuffer.prototype.slice=function(h,s){var u=this.byteLength,l=p(h,u),v=u,T,B,P,I;return s!==n&&(v=p(s,u)),l>v?new ArrayBuffer(0):(T=v-l,B=new ArrayBuffer(T),P=new Uint8Array(B),I=new Uint8Array(this,l,T),P.set(I),B)}}();function c(p){return/[\u0080-\uFFFF]/.test(p)&&(p=unescape(encodeURIComponent(p))),p}function y(p,h){var s=p.length,u=new ArrayBuffer(s),l=new Uint8Array(u),v;for(v=0;v<s;v+=1)l[v]=p.charCodeAt(v);return h?l:u}function b(p){return String.fromCharCode.apply(null,new Uint8Array(p))}function g(p,h,s){var u=new Uint8Array(p.byteLength+h.byteLength);return u.set(new Uint8Array(p)),u.set(new Uint8Array(h),p.byteLength),s?u:u.buffer}function m(p){var h=[],s=p.length,u;for(u=0;u<s-1;u+=2)h.push(parseInt(p.substr(u,2),16));return String.fromCharCode.apply(String,h)}function _(){this.reset()}return _.prototype.append=function(p){return this.appendBinary(c(p)),this},_.prototype.appendBinary=function(p){this._buff+=p,this._length+=p.length;var h=this._buff.length,s;for(s=64;s<=h;s+=64)i(this._hash,a(this._buff.substring(s-64,s)));return this._buff=this._buff.substring(s-64),this},_.prototype.end=function(p){var h=this._buff,s=h.length,u,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],v;for(u=0;u<s;u+=1)l[u>>2]|=h.charCodeAt(u)<<(u%4<<3);return this._finish(l,s),v=A(this._hash),p&&(v=m(v)),this.reset(),v},_.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},_.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},_.prototype.setState=function(p){return this._buff=p.buff,this._length=p.length,this._hash=p.hash,this},_.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},_.prototype._finish=function(p,h){var s=h,u,l,v;if(p[s>>2]|=128<<(s%4<<3),s>55)for(i(this._hash,p),s=0;s<16;s+=1)p[s]=0;u=this._length*8,u=u.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(u[2],16),v=parseInt(u[1],16)||0,p[14]=l,p[15]=v,i(this._hash,p)},_.hash=function(p,h){return _.hashBinary(c(p),h)},_.hashBinary=function(p,h){var s=f(p),u=A(s);return h?m(u):u},_.ArrayBuffer=function(){this.reset()},_.ArrayBuffer.prototype.append=function(p){var h=g(this._buff.buffer,p,!0),s=h.length,u;for(this._length+=p.byteLength,u=64;u<=s;u+=64)i(this._hash,o(h.subarray(u-64,u)));return this._buff=u-64<s?new Uint8Array(h.buffer.slice(u-64)):new Uint8Array(0),this},_.ArrayBuffer.prototype.end=function(p){var h=this._buff,s=h.length,u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l,v;for(l=0;l<s;l+=1)u[l>>2]|=h[l]<<(l%4<<3);return this._finish(u,s),v=A(this._hash),p&&(v=m(v)),this.reset(),v},_.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},_.ArrayBuffer.prototype.getState=function(){var p=_.prototype.getState.call(this);return p.buff=b(p.buff),p},_.ArrayBuffer.prototype.setState=function(p){return p.buff=y(p.buff,!0),_.prototype.setState.call(this,p)},_.ArrayBuffer.prototype.destroy=_.prototype.destroy,_.ArrayBuffer.prototype._finish=_.prototype._finish,_.ArrayBuffer.hash=function(p,h){var s=d(new Uint8Array(p)),u=A(s);return h?m(u):u},_})}),ea=function(t){var n=[];n.push({obj:t});for(var r="",i,a,o,f,d,w,A,c,y,b,g;i=n.pop();)if(a=i.obj,o=i.prefix||"",f=i.val||"",r+=o,f)r+=f;else if(typeof a!="object")r+=typeof a=="undefined"?null:JSON.stringify(a);else if(a===null)r+="null";else if(Array.isArray(a)){for(n.push({val:"]"}),d=a.length-1;d>=0;d--)w=d===0?"":",",n.push({obj:a[d],prefix:w});n.push({val:"["})}else{A=[];for(c in a)a.hasOwnProperty(c)&&A.push(c);for(n.push({val:"}"}),d=A.length-1;d>=0;d--)y=A[d],b=a[y],g=d>0?",":"",g+=JSON.stringify(y)+":",n.push({obj:b,prefix:g});n.push({val:"{"})}return r};function Qe(e,t,n){var r=n[n.length-1];e===r.element&&(n.pop(),r=n[n.length-1]);var i=r.element,a=r.index;if(Array.isArray(i))i.push(e);else if(a===t.length-2){var o=t.pop();i[o]=e}else t.push(e)}var ta=function(e){for(var t=[],n=[],r=0,i,a,o,f,d,w,A,c,y;;){if(i=e[r++],i==="}"||i==="]"||typeof i=="undefined"){if(t.length===1)return t.pop();Qe(t.pop(),t,n);continue}switch(i){case" ":case"	":case`
`:case":":case",":break;case"n":r+=3,Qe(null,t,n);break;case"t":r+=3,Qe(!0,t,n);break;case"f":r+=4,Qe(!1,t,n);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(a="",r--;;)if(o=e[r++],/[\d\.\-e\+]/.test(o))a+=o;else{r--;break}Qe(parseFloat(a),t,n);break;case'"':for(f="",d=void 0,w=0;A=e[r++],A!=='"'||d==="\\"&&w%2===1;)f+=A,d=A,d==="\\"?w++:w=0;Qe(JSON.parse('"'+f+'"'),t,n);break;case"[":c={element:[],index:t.length},t.push(c.element),n.push(c);break;case"{":y={element:{},index:t.length},t.push(y.element),n.push(y);break;default:throw new Error("unexpectedly reached end of input: "+i)}}},Nn={stringify:ea,parse:ta},Xe=na;function na(e){return function(){var t=arguments.length;if(t){for(var n=[],r=-1;++r<t;)n[r]=arguments[r];return e.call(this,n)}else return e.call(this,[])}}var pe=Cn(function(e){typeof Object.create=="function"?e.exports=function(n,r){r&&(n.super_=r,n.prototype=Object.create(r.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(n,r){if(r){n.super_=r;var i=function(){};i.prototype=r.prototype,n.prototype=new i(),n.prototype.constructor=n}}}),ra;function Ee(){}Ee.prototype=Object.create(null);function Q(){Q.init.call(this)}Q.EventEmitter=Q,Q.usingDomains=!1,Q.prototype.domain=void 0,Q.prototype._events=void 0,Q.prototype._maxListeners=void 0,Q.defaultMaxListeners=10,Q.init=function(){this.domain=null,Q.usingDomains&&ra.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new Ee(),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Q.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this};function Fn(e){return e._maxListeners===void 0?Q.defaultMaxListeners:e._maxListeners}Q.prototype.getMaxListeners=function(){return Fn(this)};function ia(e,t,n){if(t)e.call(n);else for(var r=e.length,i=ut(e,r),a=0;a<r;++a)i[a].call(n)}function aa(e,t,n,r){if(t)e.call(n,r);else for(var i=e.length,a=ut(e,i),o=0;o<i;++o)a[o].call(n,r)}function oa(e,t,n,r,i){if(t)e.call(n,r,i);else for(var a=e.length,o=ut(e,a),f=0;f<a;++f)o[f].call(n,r,i)}function sa(e,t,n,r,i,a){if(t)e.call(n,r,i,a);else for(var o=e.length,f=ut(e,o),d=0;d<o;++d)f[d].call(n,r,i,a)}function ua(e,t,n,r){if(t)e.apply(n,r);else for(var i=e.length,a=ut(e,i),o=0;o<i;++o)a[o].apply(n,r)}Q.prototype.emit=function(t){var n,r,i,a,o,f,d,w=t==="error";if(f=this._events,f)w=w&&f.error==null;else if(!w)return!1;if(d=this.domain,w){if(n=arguments[1],d)n||(n=new Error('Uncaught, unspecified "error" event')),n.domainEmitter=this,n.domain=d,n.domainThrown=!1,d.emit("error",n);else{if(n instanceof Error)throw n;var A=new Error('Uncaught, unspecified "error" event. ('+n+")");throw A.context=n,A}return!1}if(r=f[t],!r)return!1;var c=typeof r=="function";i=arguments.length;switch(i){case 1:ia(r,c,this);break;case 2:aa(r,c,this,arguments[1]);break;case 3:oa(r,c,this,arguments[1],arguments[2]);break;case 4:sa(r,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(a=new Array(i-1),o=1;o<i;o++)a[o-1]=arguments[o];ua(r,c,this,a)}return!0};function Un(e,t,n,r){var i,a,o;if(typeof n!="function")throw new TypeError('"listener" argument must be a function');if(a=e._events,a?(a.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),a=e._events),o=a[t]):(a=e._events=new Ee(),e._eventsCount=0),!o)o=a[t]=n,++e._eventsCount;else if(typeof o=="function"?o=a[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(i=Fn(e),i&&i>0&&o.length>i)){o.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=e,f.type=t,f.count=o.length,ca(f)}return e}function ca(e){typeof console.warn=="function"?console.warn(e):console.log(e)}Q.prototype.addListener=function(t,n){return Un(this,t,n,!1)},Q.prototype.on=Q.prototype.addListener,Q.prototype.prependListener=function(t,n){return Un(this,t,n,!0)};function Mn(e,t,n){var r=!1;function i(){e.removeListener(t,i),r||(r=!0,n.apply(e,arguments))}return i.listener=n,i}Q.prototype.once=function(t,n){if(typeof n!="function")throw new TypeError('"listener" argument must be a function');return this.on(t,Mn(this,t,n)),this},Q.prototype.prependOnceListener=function(t,n){if(typeof n!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(t,Mn(this,t,n)),this},Q.prototype.removeListener=function(t,n){var r,i,a,o,f;if(typeof n!="function")throw new TypeError('"listener" argument must be a function');if(i=this._events,!i)return this;if(r=i[t],!r)return this;if(r===n||r.listener&&r.listener===n)--this._eventsCount===0?this._events=new Ee():(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||n));else if(typeof r!="function"){for(a=-1,o=r.length;o-- >0;)if(r[o]===n||r[o].listener&&r[o].listener===n){f=r[o].listener,a=o;break}if(a<0)return this;if(r.length===1){if(r[0]=void 0,--this._eventsCount===0)return this._events=new Ee(),this;delete i[t]}else fa(r,a);i.removeListener&&this.emit("removeListener",t,f||n)}return this},Q.prototype.removeAllListeners=function(t){var n,r;if(r=this._events,!r)return this;if(!r.removeListener)return arguments.length===0?(this._events=new Ee(),this._eventsCount=0):r[t]&&(--this._eventsCount===0?this._events=new Ee():delete r[t]),this;if(arguments.length===0){for(var i=Object.keys(r),a=0,o;a<i.length;++a){if(o=i[a],o==="removeListener")continue;this.removeAllListeners(o)}return this.removeAllListeners("removeListener"),this._events=new Ee(),this._eventsCount=0,this}if(n=r[t],typeof n=="function")this.removeListener(t,n);else if(n)do this.removeListener(t,n[n.length-1]);while(n[0]);return this},Q.prototype.listeners=function(t){var n,r,i=this._events;return i?(n=i[t],n?typeof n=="function"?r=[n.listener||n]:r=la(n):r=[]):r=[],r},Q.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):Gn.call(e,t)},Q.prototype.listenerCount=Gn;function Gn(e){var t=this._events;if(t){var n=t[e];if(typeof n=="function")return 1;if(n)return n.length}return 0}Q.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function fa(e,t){for(var n=t,r=n+1,i=e.length;r<i;n+=1,r+=1)e[n]=e[r];e.pop()}function ut(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}function la(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function wt(e){return"$"+e}function ha(e){return e.substring(1)}function Oe(){this._store={}}Oe.prototype.get=function(e){var t=wt(e);return this._store[t]},Oe.prototype.set=function(e,t){var n=wt(e);return this._store[n]=t,!0},Oe.prototype.has=function(e){var t=wt(e);return t in this._store},Oe.prototype.delete=function(e){var t=wt(e),n=t in this._store;return delete this._store[t],n},Oe.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,r=t.length;n<r;n++){var i=t[n],a=this._store[i];i=ha(i),e(a,i)}},Object.defineProperty(Oe.prototype,"size",{get:function(){return Object.keys(this._store).length}});function ct(e){if(this._store=new Oe(),e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}ct.prototype.add=function(e){return this._store.set(e,!0)},ct.prototype.has=function(e){return this._store.has(e)},ct.prototype.forEach=function(e){this._store.forEach(function(t,n){e(n)})},Object.defineProperty(ct.prototype,"size",{get:function(){return this._store.size}});function da(){if(typeof Symbol=="undefined"||typeof Map=="undefined"||typeof Set=="undefined")return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}var Ke,fe;da()?(Ke=Set,fe=Map):(Ke=ct,fe=Oe);function va(e){return typeof ArrayBuffer!="undefined"&&e instanceof ArrayBuffer||typeof Blob!="undefined"&&e instanceof Blob}function ga(e){if(typeof e.slice=="function")return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e);return n.set(r),t}function pa(e){if(e instanceof ArrayBuffer)return ga(e);var t=e.size,n=e.type;return typeof e.slice=="function"?e.slice(0,t,n):e.webkitSlice(0,t,n)}var zn=Function.prototype.toString,ma=zn.call(Object);function ya(e){var t=Object.getPrototypeOf(e);if(t===null)return!0;var n=t.constructor;return typeof n=="function"&&n instanceof n&&zn.call(n)==ma}function ae(e){var t,n,r;if(!e||typeof e!="object")return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=ae(e[n]);return t}if(e instanceof Date)return e.toISOString();if(va(e))return pa(e);if(!ya(e))return e;t={};for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var i=ae(e[n]);typeof i!="undefined"&&(t[n]=i)}return t}function Jn(e){var t=!1;return Xe(function(n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)})}function Wn(e){return Xe(function(t){t=ae(t);var n=this,r=typeof t[t.length-1]=="function"?t.pop():!1,i=new Promise(function(a,o){var f;try{var d=Jn(function(w,A){w?o(w):a(A)});t.push(d),f=e.apply(n,t),f&&typeof f.then=="function"&&a(f)}catch(w){o(w)}});return r&&i.then(function(a){r(null,a)},r),i})}function _a(e,t,n){if(e.constructor.listeners("debug").length){for(var r=["api",e.name,t],i=0;i<n.length-1;i++)r.push(n[i]);e.constructor.emit("debug",r);var a=n[n.length-1];n[n.length-1]=function(o,f){var d=["api",e.name,t];d=d.concat(o?["error",o]:["success",f]),e.constructor.emit("debug",d),a(o,f)}}}function re(e,t){return Wn(Xe(function(n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return _a(r,e,n),this.taskqueue.isReady?t.apply(this,n):new Promise(function(i,a){r.taskqueue.addTask(function(o){o?a(o):i(r[e].apply(r,n))})})}))}function ft(e,t){for(var n={},r=0,i=t.length;r<i;r++){var a=t[r];a in e&&(n[a]=e[a])}return n}var ba=6;function Qn(e){return e}function wa(e){return[{ok:e}]}function Xn(e,t,n){var r=t.docs,i=new fe();r.forEach(function(m){i.has(m.id)?i.get(m.id).push(m):i.set(m.id,[m])});var a=i.size,o=0,f=new Array(a);function d(){var m=[];f.forEach(function(_){_.docs.forEach(function(p){m.push({id:_.id,docs:[p]})})}),n(null,{results:m})}function w(){++o===a&&d()}function A(m,_,p){f[m]={id:_,docs:p},w()}var c=[];i.forEach(function(m,_){c.push(_)});var y=0;function b(){if(y>=c.length)return;var m=Math.min(y+ba,c.length),_=c.slice(y,m);g(_,y),y+=_.length}function g(m,_){m.forEach(function(p,h){var s=_+h,u=i.get(p),l=ft(u[0],["atts_since","attachments"]);l.open_revs=u.map(function(T){return T.rev}),l.open_revs=l.open_revs.filter(Qn);var v=Qn;l.open_revs.length===0&&(delete l.open_revs,v=wa),["revs","attachments","binary","ajax","latest"].forEach(function(T){T in t&&(l[T]=t[T])}),e.get(p,l,function(T,B){var P;T?P=[{error:T}]:P=v(B),A(s,p,P),b()})})}b()}var $t;try{localStorage.setItem("_pouch_check_localstorage",1),$t=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){$t=!1}function At(){return $t}pe(He,Q);function Aa(e){At()&&addEventListener("storage",function(t){e.emit(t.key)})}function He(){Q.call(this),this._listeners={},Aa(this)}He.prototype.addListener=function(e,t,n,r){if(this._listeners[t])return;var i=this,a=!1;function o(){if(!i._listeners[t])return;if(a){a="waiting";return}a=!0;var f=ft(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function d(){a=!1}n.changes(f).on("change",function(w){w.seq>r.since&&!r.cancelled&&(r.since=w.seq,r.onChange(w))}).on("complete",function(){a==="waiting"&&be(o),a=!1}).on("error",d)}this._listeners[t]=o,this.on(e,o)},He.prototype.removeListener=function(e,t){if(!(t in this._listeners))return;Q.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t]},He.prototype.notifyLocalWindows=function(e){At()&&(localStorage[e]=localStorage[e]==="a"?"b":"a")},He.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};function ve(e){if(typeof console!="undefined"&&typeof console[e]=="function"){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function Sa(e,t){var n=6e5;e=parseInt(e,10)||0,t=parseInt(t,10),t!==t||t<=e?t=(e||1)<<1:t=t+1,t>n&&(e=n>>1,t=n);var r=Math.random(),i=t-e;return~~(i*r+e)}function xa(e){var t=0;return e||(t=2e3),Sa(e,t)}function Nt(e,t){ve("info","The above "+e+" is totally normal. "+t)}var Ft;typeof Object.assign=="function"?Ft=Object.assign:Ft=function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!=null)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};var Ye=Ft;pe(ee,Error);function ee(e,t,n){Error.call(this,n),this.status=e,this.name=t,this.message=n,this.error=!0}ee.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var ru=new ee(401,"unauthorized","Name or password is incorrect."),ka=new ee(400,"bad_request","Missing JSON list of 'docs'"),me=new ee(404,"not_found","missing"),Ze=new ee(409,"conflict","Document update conflict"),Kn=new ee(400,"bad_request","_id field must contain a string"),Ca=new ee(412,"missing_id","_id is required for puts"),Ta=new ee(400,"bad_request","Only reserved document ids may start with underscore."),iu=new ee(412,"precondition_failed","Database not open"),Hn=new ee(500,"unknown_error","Database encountered an unknown error"),Yn=new ee(500,"badarg","Some query argument is invalid"),au=new ee(400,"invalid_request","Request was invalid"),qa=new ee(400,"query_parse_error","Some query parameter is invalid"),Zn=new ee(500,"doc_validation","Bad special document member"),St=new ee(400,"bad_request","Something wrong with the request"),Ut=new ee(400,"bad_request","Document must be a JSON object"),ou=new ee(404,"not_found","Database not found"),Mt=new ee(500,"indexed_db_went_bad","unknown"),su=new ee(500,"web_sql_went_bad","unknown"),uu=new ee(500,"levelDB_went_went_bad","unknown"),cu=new ee(403,"forbidden","Forbidden by design doc validate_doc_update function"),Vn=new ee(400,"bad_request","Invalid rev format"),fu=new ee(412,"file_exists","The database could not be created, the file already exists."),Da=new ee(412,"missing_stub","A pre-existing attachment stub wasn't found"),lu=new ee(413,"invalid_url","Provided URL is invalid");function X(e,t){function n(r){for(var i=Object.getOwnPropertyNames(e),a=0,o=i.length;a<o;a++)typeof e[i[a]]!="function"&&(this[i[a]]=e[i[a]]);r!==void 0&&(this.reason=r)}return n.prototype=ee.prototype,new n(t)}function Ve(e){if(typeof e!="object"){var t=e;e=Hn,e.data=t}return"error"in e&&e.error==="conflict"&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function Ea(e,t,n){try{return!e(t,n)}catch(i){var r="Filter function threw: "+i.toString();return X(St,r)}}function Gt(e){var t={},n=e.filter&&typeof e.filter=="function";return t.query=e.query_params,function(i){i.doc||(i.doc={});var a=n&&Ea(e.filter,i.doc,t);if(typeof a=="object")return a;if(a)return!1;if(!e.include_docs)delete i.doc;else if(!e.attachments)for(var o in i.doc._attachments)i.doc._attachments.hasOwnProperty(o)&&(i.doc._attachments[o].stub=!0);return!0}}function xt(e){for(var t=[],n=0,r=e.length;n<r;n++)t=t.concat(e[n]);return t}function er(e){var t;if(e?typeof e!="string"?t=X(Kn):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=X(Ta)):t=X(Ca),t)throw t}function we(e){return typeof e._remote=="boolean"?e._remote:typeof e.type=="function"?(ve("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),e.type()==="http"):!1}function Oa(e,t){return"listenerCount"in e?e.listenerCount(t):Q.listenerCount(e,t)}function zt(e){if(!e)return null;var t=e.split("/");return t.length===2?t:t.length===1?[e,e]:null}function tr(e){var t=zt(e);return t?t.join("/"):null}var nr=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],rr="queryKey",Ba=/(?:^|&)([^&=]*)=?([^&]*)/g,Ia=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function ir(e){for(var t=Ia.exec(e),n={},r=14;r--;){var i=nr[r],a=t[r]||"",o=["user","password"].indexOf(i)!==-1;n[i]=o?decodeURIComponent(a):a}return n[rr]={},n[nr[12]].replace(Ba,function(f,d,w){d&&(n[rr][d]=w)}),n}function Jt(e,t){var n=[],r=[];for(var i in t)t.hasOwnProperty(i)&&(n.push(i),r.push(t[i]));return n.push(e),Function.apply(null,n).apply(null,r)}function kt(e,t,n){return new Promise(function(r,i){e.get(t,function(a,o){if(a){if(a.status!==404)return i(a);o={}}var f=o._rev,d=n(o);if(!d)return r({updated:!1,rev:f});d._id=t,d._rev=f,r(Pa(e,d,n))})})}function Pa(e,t,n){return e.put(t).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(r.status!==409)throw r;return kt(e,t._id,n)})}var Wt=function(e){return atob(e)},lt=function(e){return btoa(e)};function Qt(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(a){if(a.name!=="TypeError")throw a;for(var n=typeof BlobBuilder!="undefined"?BlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:WebKitBlobBuilder,r=new n(),i=0;i<e.length;i+=1)r.append(e[i]);return r.getBlob(t.type)}}function Ra(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function Xt(e,t){return Qt([Ra(e)],{type:t})}function Kt(e,t){return Xt(Wt(e),t)}function La(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}function ar(e,t){var n=new FileReader(),r=typeof n.readAsBinaryString=="function";n.onloadend=function(i){var a=i.target.result||"";if(r)return t(a);t(La(a))},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function or(e,t){ar(e,function(n){t(n)})}function Ht(e,t){or(e,function(n){t(lt(n))})}function ja(e,t){var n=new FileReader();n.onloadend=function(r){var i=r.target.result||new ArrayBuffer(0);t(i)},n.readAsArrayBuffer(e)}var $a=self.setImmediate||self.setTimeout,Na=32768;function Fa(e){return lt(e)}function Ua(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.slice(t,n)}function Ma(e,t,n,r,i){(n>0||r<t.size)&&(t=Ua(t,n,r)),ja(t,function(a){e.append(a),i()})}function Ga(e,t,n,r,i){(n>0||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),i()}function Yt(e,t){var n=typeof e=="string",r=n?e.length:e.size,i=Math.min(Na,r),a=Math.ceil(r/i),o=0,f=n?new jt():new jt.ArrayBuffer(),d=n?Ga:Ma;function w(){$a(c)}function A(){var y=f.end(!0),b=Fa(y);t(b),f.destroy()}function c(){var y=o*i,b=y+i;o++,o<a?d(f,e,y,b,w):d(f,e,y,b,A)}c()}function sr(e){return jt.hash(e)}function ur(e,t){var n=ae(e);return t?(delete n._rev_tree,sr(JSON.stringify(n))):$n().replace(/-/g,"").toLowerCase()}var Ct=$n;function Re(e){for(var t,n,r,i=e.rev_tree.slice(),a;a=i.pop();){var o=a.ids,f=o[2],d=a.pos;if(f.length){for(var w=0,A=f.length;w<A;w++)i.push({pos:d+1,ids:f[w]});continue}var c=!!o[1].deleted,y=o[0];(!t||(r!==c?r:n!==d?n<d:t<y))&&(t=y,n=d,r=c)}return n+"-"+t}function Le(e,t){for(var n=e.slice(),r;r=n.pop();)for(var i=r.pos,a=r.ids,o=a[2],f=t(o.length===0,i,a[0],r.ctx,a[1]),d=0,w=o.length;d<w;d++)n.push({pos:i+1,ids:o[d],ctx:f})}function za(e,t){return e.pos-t.pos}function Zt(e){var t=[];Le(e,function(i,a,o,f,d){i&&t.push({rev:a+"-"+o,pos:a,opts:d})}),t.sort(za).reverse();for(var n=0,r=t.length;n<r;n++)delete t[n].pos;return t}function Vt(e){for(var t=Re(e),n=Zt(e.rev_tree),r=[],i=0,a=n.length;i<a;i++){var o=n[i];o.rev!==t&&!o.opts.deleted&&r.push(o.rev)}return r}function Ja(e){var t=[];return Le(e.rev_tree,function(n,r,i,a,o){o.status==="available"&&!n&&(t.push(r+"-"+i),o.status="missing")}),t}function cr(e){for(var t=[],n=e.slice(),r;r=n.pop();){var i=r.pos,a=r.ids,o=a[0],f=a[1],d=a[2],w=d.length===0,A=r.history?r.history.slice():[];A.push({id:o,opts:f}),w&&t.push({pos:i+1-A.length,ids:A});for(var c=0,y=d.length;c<y;c++)n.push({pos:i+1,ids:d[c],history:A})}return t.reverse()}function Wa(e,t){return e.pos-t.pos}function Qa(e,t,n){for(var r=0,i=e.length,a;r<i;)a=r+i>>>1,n(e[a],t)<0?r=a+1:i=a;return r}function Xa(e,t,n){var r=Qa(e,t,n);e.splice(r,0,t)}function fr(e,t){for(var n,r,i=t,a=e.length;i<a;i++){var o=e[i],f=[o.id,o.opts,[]];r?(r[2].push(f),r=f):n=r=f}return n}function Ka(e,t){return e[0]<t[0]?-1:1}function lr(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var i=n.pop(),a=i.tree1,o=i.tree2;(a[1].status||o[1].status)&&(a[1].status=a[1].status==="available"||o[1].status==="available"?"available":"missing");for(var f=0;f<o[2].length;f++){if(!a[2][0]){r="new_leaf",a[2][0]=o[2][f];continue}for(var d=!1,w=0;w<a[2].length;w++)a[2][w][0]===o[2][f][0]&&(n.push({tree1:a[2][w],tree2:o[2][f]}),d=!0);d||(r="new_branch",Xa(a[2],o[2][f],Ka))}}return{conflicts:r,tree:e}}function hr(e,t,n){var r=[],i=!1,a=!1,o;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var f=0,d=e.length;f<d;f++){var w=e[f];if(w.pos===t.pos&&w.ids[0]===t.ids[0])o=lr(w.ids,t.ids),r.push({pos:w.pos,ids:o.tree}),i=i||o.conflicts,a=!0;else if(n!==!0){var A=w.pos<t.pos?w:t,c=w.pos<t.pos?t:w,y=c.pos-A.pos,b=[],g=[];for(g.push({ids:A.ids,diff:y,parent:null,parentIdx:null});g.length>0;){var m=g.pop();if(m.diff===0){m.ids[0]===c.ids[0]&&b.push(m);continue}for(var _=m.ids[2],p=0,h=_.length;p<h;p++)g.push({ids:_[p],diff:m.diff-1,parent:m.ids,parentIdx:p})}var s=b[0];s?(o=lr(s.ids,c.ids),s.parent[2][s.parentIdx]=o.tree,r.push({pos:A.pos,ids:A.ids}),i=i||o.conflicts,a=!0):r.push(w)}else r.push(w)}return a||r.push(t),r.sort(Wa),{tree:r,conflicts:i||"internal_node"}}function Ha(e,t){for(var n=cr(e),r,i,a=0,o=n.length;a<o;a++){var f=n[a],d=f.ids,w;if(d.length>t){r||(r={});var A=d.length-t;w={pos:f.pos+A,ids:fr(d,A)};for(var c=0;c<A;c++){var y=f.pos+c+"-"+d[c].id;r[y]=!0}}else w={pos:f.pos,ids:fr(d,0)};i?i=hr(i,w,!0).tree:i=[w]}return r&&Le(i,function(b,g,m){delete r[g+"-"+m]}),{tree:i,revs:r?Object.keys(r):[]}}function dr(e,t,n){var r=hr(e,t),i=Ha(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function Ya(e,t){for(var n=e.slice(),r=t.split("-"),i=parseInt(r[0],10),a=r[1],o;o=n.pop();){if(o.pos===i&&o.ids[0]===a)return!0;for(var f=o.ids[2],d=0,w=f.length;d<w;d++)n.push({pos:o.pos+1,ids:f[d]})}return!1}function Za(e){return e.ids}function Ce(e,t){t||(t=Re(e));for(var n=t.substring(t.indexOf("-")+1),r=e.rev_tree.map(Za),i;i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}}function je(e){return/^_local/.test(e)}function Va(e,t){for(var n=t.rev_tree.slice(),r;r=n.pop();){var i=r.pos,a=r.ids,o=a[0],f=a[1],d=a[2],w=d.length===0,A=r.history?r.history.slice():[];if(A.push({id:o,pos:i,opts:f}),w)for(var c=0,y=A.length;c<y;c++){var b=A[c],g=b.pos+"-"+b.id;if(g===e)return i+"-"+o}for(var m=0,_=d.length;m<_;m++)n.push({pos:i+1,ids:d[m],history:A})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}pe(ht,Q);function eo(e,t,n,r){try{e.emit("change",t,n,r)}catch(i){ve("error",'Error in .on("change", function):',i)}}function ht(e,t,n){Q.call(this);var r=this;this.db=e,t=t?ae(t):{};var i=t.complete=Jn(function(f,d){f?Oa(r,"error")>0&&r.emit("error",f):r.emit("complete",d),r.removeAllListeners(),e.removeListener("destroyed",a)});n&&(r.on("complete",function(f){n(null,f)}),r.on("error",n));function a(){r.cancel()}e.once("destroyed",a),t.onChange=function(f,d,w){if(r.isCancelled)return;eo(r,f,d,w)};var o=new Promise(function(f,d){t.complete=function(w,A){w?d(w):f(A)}});r.once("cancel",function(){e.removeListener("destroyed",a),t.complete(null,{status:"cancelled"})}),this.then=o.then.bind(o),this.catch=o.catch.bind(o),this.then(function(f){i(null,f)},i),e.taskqueue.isReady?r.validateChanges(t):e.taskqueue.addTask(function(f){f?t.complete(f):r.isCancelled?r.emit("cancel"):r.validateChanges(t)})}ht.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")};function to(e,t,n){var r=[{rev:e._rev}];n.style==="all_docs"&&(r=Zt(t.rev_tree).map(function(a){return{rev:a.rev}}));var i={id:t.id,changes:r,doc:e};return Ce(t,e._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=Vt(t),i.doc._conflicts.length||delete i.doc._conflicts),i}ht.prototype.validateChanges=function(e){var t=e.complete,n=this;J._changesFilterPlugin?J._changesFilterPlugin.validate(e,function(r){if(r)return t(r);n.doChanges(e)}):n.doChanges(e)},ht.prototype.doChanges=function(e){var t=this,n=e.complete;if(e=ae(e),"live"in e&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=to,e.since==="latest"&&(e.since="now"),e.since||(e.since=0),e.since==="now"){this.db.info().then(function(a){if(t.isCancelled){n(null,{status:"cancelled"});return}e.since=a.update_seq,t.doChanges(e)},n);return}if(J._changesFilterPlugin){if(J._changesFilterPlugin.normalize(e),J._changesFilterPlugin.shouldFilter(this,e))return J._changesFilterPlugin.filter(this,e)}else["doc_ids","filter","selector","view"].forEach(function(a){a in e&&ve("warn",'The "'+a+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in e||(e.descending=!1),e.limit=e.limit===0?1:e.limit,e.complete=n;var r=this.db._changes(e);if(r&&typeof r.cancel=="function"){var i=t.cancel;t.cancel=Xe(function(a){r.cancel(),i.apply(this,a)})}};function vr(e,t){return e<t?-1:e>t?1:0}function en(e,t){return function(n,r){n||r[0]&&r[0].error?(n=n||r[0],n.docId=t,e(n)):e(null,r.length?r[0]:r)}}function no(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var a=r[i];n._attachments[a]=ft(n._attachments[a],["data","digest","content_type","length","revpos","stub"])}}}function ro(e,t){var n=vr(e._id,t._id);if(n!==0)return n;var r=e._revisions?e._revisions.start:0,i=t._revisions?t._revisions.start:0;return vr(r,i)}function io(e){var t={},n=[];return Le(e,function(r,i,a,o){var f=i+"-"+a;return r&&(t[f]=0),o!==void 0&&n.push({from:o,to:f}),f}),n.reverse(),n.forEach(function(r){t[r.from]===void 0?t[r.from]=1+t[r.to]:t[r.from]=Math.min(t[r.from],1+t[r.to])}),t}function ao(e){var t="limit"in e?e.keys.slice(e.skip,e.limit+e.skip):e.skip>0?e.keys.slice(e.skip):e.keys;e.keys=t,e.skip=0,delete e.limit,e.descending&&(t.reverse(),e.descending=!1)}function gr(e){var t=e._compactionQueue[0],n=t.opts,r=t.callback;e.get("_local/compaction").catch(function(){return!1}).then(function(i){i&&i.last_seq&&(n.last_seq=i.last_seq),e._compact(n,function(a,o){a?r(a):r(null,o),be(function(){e._compactionQueue.shift(),e._compactionQueue.length&&gr(e)})})})}function oo(e){return e.charAt(0)==="_"?e+" is not a valid attachment name, attachment names cannot start with '_'":!1}pe(te,Q);function te(){Q.call(this);for(var e in te.prototype)typeof this[e]=="function"&&(this[e]=this[e].bind(this))}te.prototype.post=re("post",function(e,t,n){if(typeof t=="function"&&(n=t,t={}),typeof e!="object"||Array.isArray(e))return n(X(Ut));this.bulkDocs({docs:[e]},t,en(n,e._id))}),te.prototype.put=re("put",function(e,t,n){if(typeof t=="function"&&(n=t,t={}),typeof e!="object"||Array.isArray(e))return n(X(Ut));if(er(e._id),je(e._id)&&typeof this._putLocal=="function")return e._deleted?this._removeLocal(e,n):this._putLocal(e,n);var r=this;t.force&&e._rev?(i(),a(function(o){var f=o?null:{ok:!0,id:e._id,rev:e._rev};n(o,f)})):a(n);function i(){var o=e._rev.split("-"),f=o[1],d=parseInt(o[0],10),w=d+1,A=ur();e._revisions={start:w,ids:[A,f]},e._rev=w+"-"+A,t.new_edits=!1}function a(o){typeof r._put=="function"&&t.new_edits!==!1?r._put(e,t,o):r.bulkDocs({docs:[e]},t,en(o,e._id))}}),te.prototype.putAttachment=re("putAttachment",function(e,t,n,r,i){var a=this;typeof i=="function"&&(i=r,r=n,n=null),typeof i=="undefined"&&(i=r,r=n,n=null),i||ve("warn","Attachment",t,"on document",e,"is missing content_type");function o(f){var d="_rev"in f?parseInt(f._rev,10):0;return f._attachments=f._attachments||{},f._attachments[t]={content_type:i,data:r,revpos:++d},a.put(f)}return a.get(e).then(function(f){if(f._rev!==n)throw X(Ze);return o(f)},function(f){if(f.reason===me.message)return o({_id:e});throw f})}),te.prototype.removeAttachment=re("removeAttachment",function(e,t,n,r){var i=this;i.get(e,function(a,o){if(a){r(a);return}if(o._rev!==n){r(X(Ze));return}if(!o._attachments)return r();delete o._attachments[t],Object.keys(o._attachments).length===0&&delete o._attachments,i.put(o,r)})}),te.prototype.remove=re("remove",function(e,t,n,r){var i;typeof t=="string"?(i={_id:e,_rev:t},typeof n=="function"&&(r=n,n={})):(i=e,typeof t=="function"?(r=t,n={}):(r=n,n=t)),n=n||{},n.was_delete=!0;var a={_id:i._id,_rev:i._rev||n.rev};if(a._deleted=!0,je(a._id)&&typeof this._removeLocal=="function")return this._removeLocal(i,r);this.bulkDocs({docs:[a]},n,en(r,a._id))}),te.prototype.revsDiff=re("revsDiff",function(e,t,n){typeof t=="function"&&(n=t,t={});var r=Object.keys(e);if(!r.length)return n(null,{});var i=0,a=new fe();function o(d,w){a.has(d)||a.set(d,{missing:[]}),a.get(d).missing.push(w)}function f(d,w){var A=e[d].slice(0);Le(w,function(c,y,b,g,m){var _=y+"-"+b,p=A.indexOf(_);if(p===-1)return;A.splice(p,1),m.status!=="available"&&o(d,_)}),A.forEach(function(c){o(d,c)})}r.map(function(d){this._getRevisionTree(d,function(w,A){if(w&&w.status===404&&w.message==="missing")a.set(d,{missing:e[d]});else{if(w)return n(w);f(d,A)}if(++i===r.length){var c={};return a.forEach(function(y,b){c[b]=y}),n(null,c)}})},this)}),te.prototype.bulkGet=re("bulkGet",function(e,t){Xn(this,e,t)}),te.prototype.compactDocument=re("compactDocument",function(e,t,n){var r=this;this._getRevisionTree(e,function(i,a){if(i)return n(i);var o=io(a),f=[],d=[];Object.keys(o).forEach(function(w){o[w]>t&&f.push(w)}),Le(a,function(w,A,c,y,b){var g=A+"-"+c;b.status==="available"&&f.indexOf(g)!==-1&&d.push(g)}),r._doCompaction(e,d,n)})}),te.prototype.compact=re("compact",function(e,t){typeof e=="function"&&(t=e,e={});var n=this;e=e||{},n._compactionQueue=n._compactionQueue||[],n._compactionQueue.push({opts:e,callback:t}),n._compactionQueue.length===1&&gr(n)}),te.prototype._compact=function(e,t){var n=this,r={return_docs:!1,last_seq:e.last_seq||0},i=[];function a(f){i.push(n.compactDocument(f.id,0))}function o(f){var d=f.last_seq;Promise.all(i).then(function(){return kt(n,"_local/compaction",function(A){return!A.last_seq||A.last_seq<d?(A.last_seq=d,A):!1})}).then(function(){t(null,{ok:!0})}).catch(t)}n.changes(r).on("change",a).on("complete",o).on("error",t)},te.prototype.get=re("get",function(e,t,n){if(typeof t=="function"&&(n=t,t={}),typeof e!="string")return n(X(Kn));if(je(e)&&typeof this._getLocal=="function")return this._getLocal(e,n);var r=[],i=this;function a(){var d=[],w=r.length;if(!w)return n(null,d);r.forEach(function(A){i.get(e,{rev:A,revs:t.revs,latest:t.latest,attachments:t.attachments,binary:t.binary},function(c,y){if(c)d.push({missing:A});else{for(var b,g=0,m=d.length;g<m;g++)if(d[g].ok&&d[g].ok._rev===y._rev){b=!0;break}b||d.push({ok:y})}w--,w||n(null,d)})})}if(t.open_revs){if(t.open_revs==="all")this._getRevisionTree(e,function(d,w){if(d)return n(d);r=Zt(w).map(function(A){return A.rev}),a()});else if(Array.isArray(t.open_revs)){r=t.open_revs;for(var o=0;o<r.length;o++){var f=r[o];if(!(typeof f=="string"&&/^\d+-/.test(f)))return n(X(Vn))}a()}else return n(X(Hn,"function_clause"));return}return this._get(e,t,function(d,w){if(d)return d.docId=e,n(d);var A=w.doc,c=w.metadata,y=w.ctx;if(t.conflicts){var b=Vt(c);b.length&&(A._conflicts=b)}if(Ce(c,A._rev)&&(A._deleted=!0),t.revs||t.revs_info){for(var g=A._rev.split("-"),m=parseInt(g[0],10),_=g[1],p=cr(c.rev_tree),h=null,s=0;s<p.length;s++){var u=p[s],l=u.ids.map(function(G){return G.id}).indexOf(_),v=l===m-1;(v||!h&&l!==-1)&&(h=u)}if(!h)return d=new Error("invalid rev tree"),d.docId=e,n(d);var T=h.ids.map(function(G){return G.id}).indexOf(A._rev.split("-")[1])+1,B=h.ids.length-T;if(h.ids.splice(T,B),h.ids.reverse(),t.revs&&(A._revisions={start:h.pos+h.ids.length-1,ids:h.ids.map(function(G){return G.id})}),t.revs_info){var P=h.pos+h.ids.length;A._revs_info=h.ids.map(function(G){return P--,{rev:P+"-"+G.id,status:G.opts.status}})}}if(t.attachments&&A._attachments){var I=A._attachments,U=Object.keys(I).length;if(U===0)return n(null,A);Object.keys(I).forEach(function(G){this._getAttachment(A._id,G,I[G],{rev:A._rev,binary:t.binary,ctx:y},function(M,N){var K=A._attachments[G];K.data=N,delete K.stub,delete K.length,--U||n(null,A)})},i)}else{if(A._attachments)for(var z in A._attachments)A._attachments.hasOwnProperty(z)&&(A._attachments[z].stub=!0);n(null,A)}})}),te.prototype.getAttachment=re("getAttachment",function(e,t,n,r){var i=this;n instanceof Function&&(r=n,n={}),this._get(e,n,function(a,o){if(a)return r(a);if(o.doc._attachments&&o.doc._attachments[t])n.ctx=o.ctx,n.binary=!0,i._getAttachment(e,t,o.doc._attachments[t],n,r);else return r(X(me))})}),te.prototype.allDocs=re("allDocs",function(e,t){if(typeof e=="function"&&(t=e,e={}),e.skip=typeof e.skip!="undefined"?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(r){return r in e})[0];if(n){t(X(qa,"Query parameter `"+n+"` is not compatible with multi-get"));return}if(!we(this)&&(ao(e),e.keys.length===0))return this._allDocs({limit:0},t)}return this._allDocs(e,t)}),te.prototype.changes=function(e,t){return typeof e=="function"&&(t=e,e={}),e=e||{},e.return_docs="return_docs"in e?e.return_docs:!e.live,new ht(this,e,t)},te.prototype.close=re("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}),te.prototype.info=re("info",function(e){var t=this;this._info(function(n,r){if(n)return e(n);r.db_name=r.db_name||t.name,r.auto_compaction=!!(t.auto_compaction&&!we(t)),r.adapter=t.adapter,e(null,r)})}),te.prototype.id=re("id",function(e){return this._id(e)}),te.prototype.type=function(){return typeof this._type=="function"?this._type():this.adapter},te.prototype.bulkDocs=re("bulkDocs",function(e,t,n){if(typeof t=="function"&&(n=t,t={}),t=t||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return n(X(ka));for(var r=0;r<e.docs.length;++r)if(typeof e.docs[r]!="object"||Array.isArray(e.docs[r]))return n(X(Ut));var i;if(e.docs.forEach(function(f){f._attachments&&Object.keys(f._attachments).forEach(function(d){i=i||oo(d),f._attachments[d].content_type||ve("warn","Attachment",d,"on document",f._id,"is missing content_type")})}),i)return n(X(St,i));"new_edits"in t||("new_edits"in e?t.new_edits=e.new_edits:t.new_edits=!0);var a=this;!t.new_edits&&!we(a)&&e.docs.sort(ro),no(e.docs);var o=e.docs.map(function(f){return f._id});return this._bulkDocs(e,t,function(f,d){if(f)return n(f);if(t.new_edits||(d=d.filter(function(c){return c.error})),!we(a))for(var w=0,A=d.length;w<A;w++)d[w].id=d[w].id||o[w];n(null,d)})}),te.prototype.registerDependentDatabase=re("registerDependentDatabase",function(e,t){var n=new this.constructor(e,this.__opts);function r(i){return i.dependentDbs=i.dependentDbs||{},i.dependentDbs[e]?!1:(i.dependentDbs[e]=!0,i)}kt(this,"_local/_pouch_dependentDbs",r).then(function(){t(null,{db:n})}).catch(t)}),te.prototype.destroy=re("destroy",function(e,t){typeof e=="function"&&(t=e,e={});var n=this,r="use_prefix"in n?n.use_prefix:!0;function i(){n._destroy(e,function(a,o){if(a)return t(a);n._destroyed=!0,n.emit("destroyed"),t(null,o||{ok:!0})})}if(we(n))return i();n.get("_local/_pouch_dependentDbs",function(a,o){if(a)return a.status!==404?t(a):i();var f=o.dependentDbs,d=n.constructor,w=Object.keys(f).map(function(A){var c=r?A.replace(new RegExp("^"+d.prefix),""):A;return new d(c,n.__opts).destroy()});Promise.all(w).then(i,t)})});function dt(){this.isReady=!1,this.failed=!1,this.queue=[]}dt.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},dt.prototype.fail=function(e){this.failed=e,this.execute()},dt.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},dt.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()};function so(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=J.adapters,i=J.preferredAdapters,a=J.prefix,o=t.adapter;if(!o)for(var f=0;f<i.length;++f){if(o=i[f],o==="idb"&&"websql"in r&&At()&&localStorage["_pouch__websqldb_"+a+e]){ve("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}var d=r[o],w=d&&"use_prefix"in d?d.use_prefix:!0;return{name:w?a+e:e,adapter:o}}function uo(e){function t(r){e.removeListener("closed",n),r||e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",t),e.constructor.emit("unref",e)}e.once("destroyed",t),e.once("closed",n),e.constructor.emit("ref",e)}pe(J,te);function J(e,t){if(!(this instanceof J))return new J(e,t);var n=this;if(t=t||{},e&&typeof e=="object"&&(t=e,e=t.name,delete t.name),t.deterministic_revs===void 0&&(t.deterministic_revs=!0),this.__opts=t=ae(t),n.auto_compaction=t.auto_compaction,n.prefix=J.prefix,typeof e!="string")throw new Error("Missing/invalid DB name");var r=(t.prefix||"")+e,i=so(r,t);if(t.name=i.name,t.adapter=t.adapter||i.adapter,n.name=e,n._adapter=t.adapter,J.emit("debug",["adapter","Picked adapter: ",t.adapter]),!J.adapters[t.adapter]||!J.adapters[t.adapter].valid())throw new Error("Invalid Adapter: "+t.adapter);te.call(n),n.taskqueue=new dt(),n.adapter=t.adapter,J.adapters[t.adapter].call(n,t,function(a){if(a)return n.taskqueue.fail(a);uo(n),n.emit("created",n),J.emit("created",n.name),n.taskqueue.ready(n)})}var co=typeof AbortController!="undefined"?AbortController:function(){return{abort:function(){}}},pr=fetch,et=Headers;J.adapters={},J.preferredAdapters=[],J.prefix="_pouch_";var mr=new Q();function fo(e){Object.keys(Q.prototype).forEach(function(n){typeof Q.prototype[n]=="function"&&(e[n]=mr[n].bind(mr))});var t=e._destructionListeners=new fe();e.on("ref",function(r){t.has(r.name)||t.set(r.name,[]),t.get(r.name).push(r)}),e.on("unref",function(r){if(!t.has(r.name))return;var i=t.get(r.name),a=i.indexOf(r);if(a<0)return;i.splice(a,1),i.length>1?t.set(r.name,i):t.delete(r.name)}),e.on("destroyed",function(r){if(!t.has(r))return;var i=t.get(r);t.delete(r),i.forEach(function(a){a.emit("destroyed",!0)})})}fo(J),J.adapter=function(e,t,n){t.valid()&&(J.adapters[e]=t,n&&J.preferredAdapters.push(e))},J.plugin=function(e){if(typeof e=="function")e(J);else{if(typeof e!="object"||Object.keys(e).length===0)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach(function(t){J.prototype[t]=e[t]})}return this.__defaults&&(J.__defaults=Ye({},this.__defaults)),J},J.defaults=function(e){function t(n,r){if(!(this instanceof t))return new t(n,r);r=r||{},n&&typeof n=="object"&&(r=n,n=r.name,delete r.name),r=Ye({},t.__defaults,r),J.call(this,n,r)}return pe(t,J),t.preferredAdapters=J.preferredAdapters.slice(),Object.keys(J).forEach(function(n){n in t||(t[n]=J[n])}),t.__defaults=Ye({},this.__defaults,e),t},J.fetch=function(e,t){return pr(e,t)};var lo="7.2.2";function yr(e,t){for(var n=e,r=0,i=t.length;r<i;r++){var a=t[r];if(n=n[a],!n)break}return n}function ho(e,t){return e<t?-1:e>t?1:0}function _r(e){for(var t=[],n="",r=0,i=e.length;r<i;r++){var a=e[r];a==="."?r>0&&e[r-1]==="\\"?n=n.substring(0,n.length-1)+".":(t.push(n),n=""):n+=a}return t.push(n),t}var vo=["$or","$nor","$not"];function br(e){return vo.indexOf(e)>-1}function wr(e){return Object.keys(e)[0]}function go(e){return e[wr(e)]}function vt(e){var t={};return e.forEach(function(n){Object.keys(n).forEach(function(r){var i=n[r];if(typeof i!="object"&&(i={$eq:i}),br(r))i instanceof Array?t[r]=i.map(function(o){return vt([o])}):t[r]=vt([i]);else{var a=t[r]=t[r]||{};Object.keys(i).forEach(function(o){var f=i[o];if(o==="$gt"||o==="$gte")return po(o,f,a);if(o==="$lt"||o==="$lte")return mo(o,f,a);if(o==="$ne")return yo(f,a);if(o==="$eq")return _o(f,a);a[o]=f})}})}),t}function po(e,t,n){if(typeof n.$eq!="undefined")return;typeof n.$gte!="undefined"?e==="$gte"?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t):typeof n.$gt!="undefined"?e==="$gte"?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):n[e]=t}function mo(e,t,n){if(typeof n.$eq!="undefined")return;typeof n.$lte!="undefined"?e==="$lte"?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t):typeof n.$lt!="undefined"?e==="$lte"?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):n[e]=t}function yo(e,t){"$ne"in t?t.$ne.push(e):t.$ne=[e]}function _o(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}function Ar(e){for(var t in e){if(Array.isArray(e))for(var n in e)e[n].$and&&(e[n]=vt(e[n].$and));var r=e[t];typeof r=="object"&&Ar(r)}return e}function Sr(e,t){for(var n in e){n==="$and"&&(t=!0);var r=e[n];typeof r=="object"&&(t=Sr(r,t))}return t}function bo(e){var t=ae(e),n=!1;Sr(t,!1)&&(t=Ar(t),"$and"in t&&(t=vt(t.$and)),n=!0),["$or","$nor"].forEach(function(f){f in t&&t[f].forEach(function(d){for(var w=Object.keys(d),A=0;A<w.length;A++){var c=w[A],y=d[c];(typeof y!="object"||y===null)&&(d[c]={$eq:y})}})}),"$not"in t&&(t.$not=vt([t.$not]));for(var r=Object.keys(t),i=0;i<r.length;i++){var a=r[i],o=t[a];typeof o!="object"||o===null?o={$eq:o}:"$ne"in o&&!n&&(o.$ne=[o.$ne]),t[a]=o}return t}function wo(e,t,n){for(var r="",i=n-e.length;r.length<i;)r+=t;return r}function Ao(e,t,n){var r=wo(e,t,n);return r+e}var xr=-324,tn=3,nn="";function se(e,t){if(e===t)return 0;e=$e(e),t=$e(t);var n=rn(e),r=rn(t);if(n-r!==0)return n-r;switch(typeof e){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return qo(e,t)}return Array.isArray(e)?To(e,t):Do(e,t)}function $e(e){switch(typeof e){case"undefined":return null;case"number":return e===Infinity||e===-Infinity||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var r=0;r<n;r++)e[r]=$e(t[r])}else{if(e instanceof Date)return e.toJSON();if(e!==null){e={};for(var i in t)if(t.hasOwnProperty(i)){var a=t[i];typeof a!="undefined"&&(e[i]=$e(a))}}}}return e}function So(e){if(e!==null)switch(typeof e){case"boolean":return e?1:0;case"number":return Eo(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,i=n.length,a="";if(t)for(;++r<i;)a+=ye(n[r]);else for(;++r<i;){var o=n[r];a+=ye(o)+ye(e[o])}return a}return""}function ye(e){var t="\0";return e=$e(e),rn(e)+nn+So(e)+t}function xo(e,t){var n=t,r,i=e[t]==="1";if(i)r=0,t++;else{var a=e[t]==="0";t++;var o="",f=e.substring(t,t+tn),d=parseInt(f,10)+xr;for(a&&(d=-d),t+=tn;;){var w=e[t];if(w==="\0")break;o+=w,t++}o=o.split("."),o.length===1?r=parseInt(o,10):r=parseFloat(o[0]+"."+o[1]),a&&(r=r-10),d!==0&&(r=parseFloat(r+"e"+d))}return{num:r,length:t-n}}function ko(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var i=r.element,a=r.index;if(Array.isArray(i))i.push(n);else if(a===e.length-2){var o=e.pop();i[o]=n}else e.push(n)}}function Co(e){for(var t=[],n=[],r=0;;){var i=e[r++];if(i==="\0"){if(t.length===1)return t.pop();ko(t,n);continue}switch(i){case"1":t.push(null);break;case"2":t.push(e[r]==="1"),r++;break;case"3":var a=xo(e,r);t.push(a.num),r+=a.length;break;case"4":for(var o="";;){var f=e[r];if(f==="\0")break;o+=f,r++}o=o.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(o);break;case"5":var d={element:[],index:t.length};t.push(d.element),n.push(d);break;case"6":var w={element:{},index:t.length};t.push(w.element),n.push(w);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function To(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=se(e[r],t[r]);if(i!==0)return i}return e.length===t.length?0:e.length>t.length?1:-1}function qo(e,t){return e===t?0:e>t?1:-1}function Do(e,t){for(var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length),a=0;a<i;a++){var o=se(n[a],r[a]);if(o!==0)return o;if(o=se(e[n[a]],t[r[a]]),o!==0)return o}return n.length===r.length?0:n.length>r.length?1:-1}function rn(e){var t=["boolean","number","string","object"],n=t.indexOf(typeof e);if(~n)return e===null?1:Array.isArray(e)?5:n<3?n+2:n+3;if(Array.isArray(e))return 5}function Eo(e){if(e===0)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=e<0,i=r?"0":"2",a=(r?-n:n)-xr,o=Ao(a.toString(),"0",tn);i+=nn+o;var f=Math.abs(parseFloat(t[0]));r&&(f=10-f);var d=f.toFixed(20);return d=d.replace(/\.?0+$/,""),i+=nn+d,i}function Oo(e){function t(n){return e.map(function(r){var i=wr(r),a=_r(i),o=yr(n,a);return o})}return function(n,r){var i=t(n.doc),a=t(r.doc),o=se(i,a);return o!==0?o:ho(n.doc._id,r.doc._id)}}function Bo(e,t,n){if(e=e.filter(function(o){return tt(o.doc,t.selector,n)}),t.sort){var r=Oo(t.sort);e=e.sort(r),typeof t.sort[0]!="string"&&go(t.sort[0])==="desc"&&(e=e.reverse())}if("limit"in t||"skip"in t){var i=t.skip||0,a=("limit"in t?t.limit:e.length)+i;e=e.slice(i,a)}return e}function tt(e,t,n){return n.every(function(r){var i=t[r],a=_r(r),o=yr(e,a);return br(r)?Io(r,i,e):an(i,e,a,o)})}function an(e,t,n,r){return e?typeof e=="object"?Object.keys(e).every(function(i){var a=e[i];return Po(i,t,a,n,r)}):e===r:!0}function Io(e,t,n){return e==="$or"?t.some(function(r){return tt(n,r,Object.keys(r))}):e==="$not"?!tt(n,t,Object.keys(t)):!t.find(function(r){return tt(n,r,Object.keys(r))})}function Po(e,t,n,r,i){if(!Cr[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Cr[e](t,n,r,i)}function gt(e){return typeof e!="undefined"&&e!==null}function Ne(e){return typeof e!="undefined"}function Ro(e,t){var n=t[0],r=t[1];if(n===0)throw new Error("Bad divisor, cannot divide by zero");if(parseInt(n,10)!==n)throw new Error("Divisor is not an integer");if(parseInt(r,10)!==r)throw new Error("Modulus is not an integer");return parseInt(e,10)!==e?!1:e%n===r}function kr(e,t){return t.some(function(n){return e instanceof Array?e.indexOf(n)>-1:e===n})}function Lo(e,t){return t.every(function(n){return e.indexOf(n)>-1})}function jo(e,t){return e.length===t}function $o(e,t){var n=new RegExp(t);return n.test(e)}function No(e,t){switch(t){case"null":return e===null;case"boolean":return typeof e=="boolean";case"number":return typeof e=="number";case"string":return typeof e=="string";case"array":return e instanceof Array;case"object":return{}.toString.call(e)==="[object Object]"}throw new Error(t+" not supported as a type.Please use one of object, string, array, number, boolean or null.")}var Cr={$elemMatch:function(e,t,n,r){return Array.isArray(r)?r.length===0?!1:typeof r[0]=="object"?r.some(function(i){return tt(i,t,Object.keys(t))}):r.some(function(i){return an(t,e,n,i)}):!1},$allMatch:function(e,t,n,r){return Array.isArray(r)?r.length===0?!1:typeof r[0]=="object"?r.every(function(i){return tt(i,t,Object.keys(t))}):r.every(function(i){return an(t,e,n,i)}):!1},$eq:function(e,t,n,r){return Ne(r)&&se(r,t)===0},$gte:function(e,t,n,r){return Ne(r)&&se(r,t)>=0},$gt:function(e,t,n,r){return Ne(r)&&se(r,t)>0},$lte:function(e,t,n,r){return Ne(r)&&se(r,t)<=0},$lt:function(e,t,n,r){return Ne(r)&&se(r,t)<0},$exists:function(e,t,n,r){return t?Ne(r):!Ne(r)},$mod:function(e,t,n,r){return gt(r)&&Ro(r,t)},$ne:function(e,t,n,r){return t.every(function(i){return se(r,i)!==0})},$in:function(e,t,n,r){return gt(r)&&kr(r,t)},$nin:function(e,t,n,r){return gt(r)&&!kr(r,t)},$size:function(e,t,n,r){return gt(r)&&jo(r,t)},$all:function(e,t,n,r){return Array.isArray(r)&&Lo(r,t)},$regex:function(e,t,n,r){return gt(r)&&$o(r,t)},$type:function(e,t,n,r){return No(r,t)}};function Fo(e,t){if(typeof t!="object")throw new Error("Selector error: expected a JSON object");t=bo(t);var n={doc:e},r=Bo([n],{selector:t},Object.keys(t));return r&&r.length===1}function Uo(e){return Jt(`"use strict";
return `+e+";",{})}function Mo(e){var t=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join(`
`);return Jt(t,{})}function Go(e,t){if(e.selector&&(e.filter&&e.filter!=="_selector")){var n=typeof e.filter=="string"?e.filter:"function";return t(new Error('selector invalid for filter "'+n+'"'))}t()}function zo(e){e.view&&!e.filter&&(e.filter="_view"),e.selector&&!e.filter&&(e.filter="_selector"),e.filter&&typeof e.filter=="string"&&(e.filter==="_view"?e.view=tr(e.view):e.filter=tr(e.filter))}function Jo(e,t){return t.filter&&typeof t.filter=="string"&&!t.doc_ids&&!we(e.db)}function Wo(e,t){var n=t.complete;if(t.filter==="_view"){if(!t.view||typeof t.view!="string"){var r=X(St,"`view` filter parameter not found or invalid.");return n(r)}var i=zt(t.view);e.db.get("_design/"+i[0],function(o,f){if(e.isCancelled)return n(null,{status:"cancelled"});if(o)return n(Ve(o));var d=f&&f.views&&f.views[i[1]]&&f.views[i[1]].map;if(!d)return n(X(me,f.views?"missing json key: "+i[1]:"missing json key: views"));t.filter=Mo(d),e.doChanges(t)})}else if(t.selector)t.filter=function(o){return Fo(o,t.selector)},e.doChanges(t);else{var a=zt(t.filter);e.db.get("_design/"+a[0],function(o,f){if(e.isCancelled)return n(null,{status:"cancelled"});if(o)return n(Ve(o));var d=f&&f.filters&&f.filters[a[1]];if(!d)return n(X(me,f&&f.filters?"missing json key: "+a[1]:"missing json key: filters"));t.filter=Uo(d),e.doChanges(t)})}}function Qo(e){e._changesFilterPlugin={validate:Go,normalize:zo,shouldFilter:Jo,filter:Wo}}J.plugin(Qo),J.version=lo;function Tr(e){return e.reduce(function(t,n){return t[n]=!0,t},{})}var Xo=Tr(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Ko=Tr(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function qr(e){if(!/^\d+-/.test(e))return X(Vn);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function Ho(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,i=[r[0],t,[]],a=1,o=r.length;a<o;a++)i=[r[a],{status:"missing"},[i]];return[{pos:n,ids:i}]}function Dr(e,t,n){n||(n={deterministic_revs:!0});var r,i,a,o={status:"available"};if(e._deleted&&(o.deleted=!0),t)if(e._id||(e._id=Ct()),i=ur(e,n.deterministic_revs),e._rev){if(a=qr(e._rev),a.error)return a;e._rev_tree=[{pos:a.prefix,ids:[a.id,{status:"missing"},[[i,o,[]]]]}],r=a.prefix+1}else e._rev_tree=[{pos:1,ids:[i,o,[]]}],r=1;else if(e._revisions&&(e._rev_tree=Ho(e._revisions,o),r=e._revisions.start,i=e._revisions.ids[0]),!e._rev_tree){if(a=qr(e._rev),a.error)return a;r=a.prefix,i=a.id,e._rev_tree=[{pos:r,ids:[i,o,[]]}]}er(e._id),e._rev=r+"-"+i;var f={metadata:{},data:{}};for(var d in e)if(Object.prototype.hasOwnProperty.call(e,d)){var w=d[0]==="_";if(w&&!Xo[d]){var A=X(Zn,d);throw A.message=Zn.message+": "+d,A}else w&&!Ko[d]?f.metadata[d.slice(1)]=e[d]:f.data[d]=e[d]}return f}function Yo(e){try{return Wt(e)}catch(n){var t=X(Yn,"Attachment is not a valid base64 string");return{error:t}}}function Zo(e,t,n){var r=Yo(e.data);if(r.error)return n(r.error);e.length=r.length,t==="blob"?e.data=Xt(r,e.content_type):t==="base64"?e.data=lt(r):e.data=r,Yt(r,function(i){e.digest="md5-"+i,n()})}function Vo(e,t,n){Yt(e.data,function(r){e.digest="md5-"+r,e.length=e.data.size||e.data.length||0,t==="binary"?or(e.data,function(i){e.data=i,n()}):t==="base64"?Ht(e.data,function(i){e.data=i,n()}):n()})}function es(e,t,n){if(e.stub)return n();typeof e.data=="string"?Zo(e,t,n):Vo(e,t,n)}function ts(e,t,n){if(!e.length)return n();var r=0,i;e.forEach(function(o){var f=o.data&&o.data._attachments?Object.keys(o.data._attachments):[],d=0;if(!f.length)return a();function w(c){i=c,d++,d===f.length&&a()}for(var A in o.data._attachments)o.data._attachments.hasOwnProperty(A)&&es(o.data._attachments[A],t,w)});function a(){r++,e.length===r&&(i?n(i):n())}}function ns(e,t,n,r,i,a,o,f){if(Ya(t.rev_tree,n.metadata.rev)&&!f)return r[i]=n,a();var d=t.winningRev||Re(t),w="deleted"in t?t.deleted:Ce(t,d),A="deleted"in n.metadata?n.metadata.deleted:Ce(n.metadata),c=/^1-/.test(n.metadata.rev);if(w&&!A&&f&&c){var y=n.data;y._rev=d,y._id=n.metadata.id,n=Dr(y,f)}var b=dr(t.rev_tree,n.metadata.rev_tree[0],e),g=f&&(w&&A&&b.conflicts!=="new_leaf"||!w&&b.conflicts!=="new_leaf"||w&&!A&&b.conflicts==="new_branch");if(g){var m=X(Ze);return r[i]=m,a()}var _=n.metadata.rev;n.metadata.rev_tree=b.tree,n.stemmedRevs=b.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var p=Re(n.metadata),h=Ce(n.metadata,p),s=w===h?0:w<h?-1:1,u;_===p?u=h:u=Ce(n.metadata,_),o(n,p,h,u,!0,s,i,a)}function rs(e){return e.metadata.rev_tree[0].ids[1].status==="missing"}function is(e,t,n,r,i,a,o,f,d){e=e||1e3;function w(m,_,p){var h=Re(m.metadata),s=Ce(m.metadata,h);if("was_delete"in f&&s)return a[_]=X(me,"deleted"),p();var u=A&&rs(m);if(u){var l=X(Ze);return a[_]=l,p()}var v=s?0:1;o(m,h,s,s,!1,v,_,p)}var A=f.new_edits,c=new fe(),y=0,b=t.length;function g(){++y===b&&d&&d()}t.forEach(function(m,_){if(m._id&&je(m._id)){var p=m._deleted?"_removeLocal":"_putLocal";n[p](m,{ctx:i},function(s,u){a[_]=s||u,g()});return}var h=m.metadata.id;c.has(h)?(b--,c.get(h).push([m,_])):c.set(h,[[m,_]])}),c.forEach(function(m,_){var p=0;function h(){++p<m.length?s():g()}function s(){var u=m[p],l=u[0],v=u[1];if(r.has(_))ns(e,r.get(_),l,a,v,h,o,A);else{var T=dr([],l.metadata.rev_tree[0],e);l.metadata.rev_tree=T.tree,l.stemmedRevs=T.stemmedRevs||[],w(l,v,h)}}s()})}var as=5,ie="document-store",ue="by-sequence",ge="attach-store",Fe="attach-seq-store",ce="meta-store",Ae="local-store",on="detect-blob-support";function os(e){try{return JSON.parse(e)}catch(t){return Nn.parse(e)}}function ss(e){try{return JSON.stringify(e)}catch(t){return Nn.stringify(e)}}function Se(e){return function(t){var n="unknown_error";t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(X(Mt,n,t.type))}}function sn(e,t,n){return{data:ss(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function Ue(e){if(!e)return null;var t=os(e.data);return t.winningRev=e.winningRev,t.deleted=e.deletedOrLocal==="1",t.seq=e.seq,t}function Tt(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function Er(e,t,n,r){n?e?typeof e!="string"?r(e):r(Kt(e,t)):r(Qt([""],{type:t})):e?typeof e!="string"?ar(e,function(i){r(lt(i))}):r(e):r("")}function Or(e,t,n,r){var i=Object.keys(e._attachments||{});if(!i.length)return r&&r();var a=0;function o(){++a===i.length&&r&&r()}function f(d,w){var A=d._attachments[w],c=A.digest,y=n.objectStore(ge).get(c);y.onsuccess=function(b){A.body=b.target.result.body,o()}}i.forEach(function(d){t.attachments&&t.include_docs?f(e,d):(e._attachments[d].stub=!0,o())})}function un(e,t){return Promise.all(e.map(function(n){if(n.doc&&n.doc._attachments){var r=Object.keys(n.doc._attachments);return Promise.all(r.map(function(i){var a=n.doc._attachments[i];if(!("body"in a))return;var o=a.body,f=a.content_type;return new Promise(function(d){Er(o,f,t,function(w){n.doc._attachments[i]=Ye(ft(a,["digest","content_type"]),{data:w}),d()})})}))}}))}function Br(e,t,n){var r=[],i=n.objectStore(ue),a=n.objectStore(ge),o=n.objectStore(Fe),f=e.length;function d(){f--,f||w()}function w(){if(!r.length)return;r.forEach(function(A){var c=o.index("digestSeq").count(IDBKeyRange.bound(A+"::",A+"::",!1,!1));c.onsuccess=function(y){var b=y.target.result;b||a.delete(A)}})}e.forEach(function(A){var c=i.index("_doc_id_rev"),y=t+"::"+A;c.getKey(y).onsuccess=function(b){var g=b.target.result;if(typeof g!="number")return d();i.delete(g);var m=o.index("seq").openCursor(IDBKeyRange.only(g));m.onsuccess=function(_){var p=_.target.result;if(p){var h=p.value.digestSeq.split("::")[0];r.push(h),o.delete(p.primaryKey),p.continue()}else d()}}})}function _e(e,t,n){try{return{txn:e.transaction(t,n)}}catch(r){return{error:r}}}var pt=new He();function us(e,t,n,r,i,a){for(var o=t.docs,f,d,w,A,c,y,b,g,m=0,_=o.length;m<_;m++){var p=o[m];if(p._id&&je(p._id))continue;p=o[m]=Dr(p,n.new_edits,e),p.error&&!b&&(b=p)}if(b)return a(b);var h=!1,s=0,u=new Array(o.length),l=new fe(),v=!1,T=r._meta.blobSupport?"blob":"base64";ts(o,T,function(q){if(q)return a(q);B()});function B(){var q=[ie,ue,ge,Ae,Fe,ce],k=_e(i,q,"readwrite");if(k.error)return a(k.error);f=k.txn,f.onabort=Se(a),f.ontimeout=Se(a),f.oncomplete=G,d=f.objectStore(ie),w=f.objectStore(ue),A=f.objectStore(ge),c=f.objectStore(Fe),y=f.objectStore(ce),y.get(ce).onsuccess=function(D){g=D.target.result,U()},N(function(D){if(D)return v=!0,a(D);z()})}function P(){h=!0,U()}function I(){is(e.revs_limit,o,r,l,f,u,K,n,P)}function U(){if(!g||!h)return;g.docCount+=s,y.put(g)}function z(){if(!o.length)return;var q=0;function k(){++q===o.length&&I()}function D(E){var $=Ue(E.target.result);$&&l.set($.id,$),k()}for(var R=0,L=o.length;R<L;R++){var F=o[R];if(F._id&&je(F._id)){k();continue}var j=d.get(F.metadata.id);j.onsuccess=D}}function G(){if(v)return;pt.notify(r._meta.name),a(null,u)}function M(q,k){var D=A.get(q);D.onsuccess=function(R){if(R.target.result)k();else{var L=X(Da,"unknown stub attachment with digest "+q);L.status=412,k(L)}}}function N(q){var k=[];if(o.forEach(function(F){F.data&&F.data._attachments&&Object.keys(F.data._attachments).forEach(function(j){var E=F.data._attachments[j];E.stub&&k.push(E.digest)})}),!k.length)return q();var D=0,R;function L(){++D===k.length&&q(R)}k.forEach(function(F){M(F,function(j){j&&!R&&(R=j),L()})})}function K(q,k,D,R,L,F,j,E){q.metadata.winningRev=k,q.metadata.deleted=D;var $=q.data;$._id=q.metadata.id,$._rev=q.metadata.rev,R&&($._deleted=!0);var W=$._attachments&&Object.keys($._attachments).length;if(W)return x(q,k,D,L,j,E);s+=F,U(),S(q,k,D,L,j,E)}function S(q,k,D,R,L,F){var j=q.data,E=q.metadata;j._doc_id_rev=E.id+"::"+E.rev,delete j._id,delete j._rev;function $(H){var Z=q.stemmedRevs||[];R&&r.auto_compaction&&(Z=Z.concat(Ja(q.metadata))),Z&&Z.length&&Br(Z,q.metadata.id,f),E.seq=H.target.result;var ne=sn(E,k,D),he=d.put(ne);he.onsuccess=V}function W(H){H.preventDefault(),H.stopPropagation();var Z=w.index("_doc_id_rev"),ne=Z.getKey(j._doc_id_rev);ne.onsuccess=function(he){var le=w.put(j,he.target.result);le.onsuccess=$}}function V(){u[L]={ok:!0,id:E.id,rev:E.rev},l.set(q.metadata.id,q.metadata),C(q,E.seq,F)}var Y=w.put(j);Y.onsuccess=$,Y.onerror=W}function x(q,k,D,R,L,F){var j=q.data,E=0,$=Object.keys(j._attachments);function W(){E===$.length&&S(q,k,D,R,L,F)}function V(){E++,W()}$.forEach(function(Y){var H=q.data._attachments[Y];if(H.stub)E++,W();else{var Z=H.data;delete H.data,H.revpos=parseInt(k,10);var ne=H.digest;O(ne,Z,V)}})}function C(q,k,D){var R=0,L=Object.keys(q.data._attachments||{});if(!L.length)return D();function F(){++R===L.length&&D()}function j($){var W=q.data._attachments[$].digest,V=c.put({seq:k,digestSeq:W+"::"+k});V.onsuccess=F,V.onerror=function(Y){Y.preventDefault(),Y.stopPropagation(),F()}}for(var E=0;E<L.length;E++)j(L[E])}function O(q,k,D){var R=A.count(q);R.onsuccess=function(L){var F=L.target.result;if(F)return D();var j={digest:q,body:k},E=A.put(j);E.onsuccess=D}}}function Ir(e,t,n,r,i){r===-1&&(r=1e3);var a=typeof e.getAll=="function"&&typeof e.getAllKeys=="function"&&r>1&&!n,o,f,d;function w(b){f=b.target.result,o&&i(o,f,d)}function A(b){o=b.target.result,f&&i(o,f,d)}function c(){if(!o.length)return i();var b=o[o.length-1],g;if(t&&t.upper)try{g=IDBKeyRange.bound(b,t.upper,!0,t.upperOpen)}catch(m){if(m.name==="DataError"&&m.code===0)return i()}else g=IDBKeyRange.lowerBound(b,!0);t=g,o=null,f=null,e.getAll(t,r).onsuccess=w,e.getAllKeys(t,r).onsuccess=A}function y(b){var g=b.target.result;if(!g)return i();i([g.key],[g.value],g)}a?(d={continue:c},e.getAll(t,r).onsuccess=w,e.getAllKeys(t,r).onsuccess=A):n?e.openCursor(t,"prev").onsuccess=y:e.openCursor(t).onsuccess=y}function cs(e,t,n){if(typeof e.getAll=="function"){e.getAll(t).onsuccess=n;return}var r=[];function i(a){var o=a.target.result;o?(r.push(o.value),o.continue()):n({target:{result:r}})}e.openCursor(t).onsuccess=i}function fs(e,t,n){var r=new Array(e.length),i=0;e.forEach(function(a,o){t.get(a).onsuccess=function(f){f.target.result?r[o]=f.target.result:r[o]={key:a,error:"not_found"},i++,i===e.length&&n(e,r,{})}})}function ls(e,t,n,r,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(r)return IDBKeyRange.only(r)}catch(a){return{error:a}}return null}function hs(e,t,n){var r="startkey"in e?e.startkey:!1,i="endkey"in e?e.endkey:!1,a="key"in e?e.key:!1,o="keys"in e?e.keys:!1,f=e.skip||0,d=typeof e.limit=="number"?e.limit:-1,w=e.inclusive_end!==!1,A,c;if(!o&&(A=ls(r,i,w,a,e.descending),c=A&&A.error,c&&!(c.name==="DataError"&&c.code===0)))return n(X(Mt,c.name,c.message));var y=[ie,ue,ce];e.attachments&&y.push(ge);var b=_e(t,y,"readonly");if(b.error)return n(b.error);var g=b.txn;g.oncomplete=G,g.onabort=Se(n);var m=g.objectStore(ie),_=g.objectStore(ue),p=g.objectStore(ce),h=_.index("_doc_id_rev"),s=[],u,l;p.get(ce).onsuccess=function(M){u=M.target.result.docCount},e.update_seq&&v(_,function(M){M.target.result&&M.target.result.length>0&&(l=M.target.result[0])});function v(M,N){function K(S){var x=S.target.result,C=void 0;return x&&x.key&&(C=x.key),N({target:{result:[C]}})}M.openCursor(null,"prev").onsuccess=K}function T(M,N,K){var S=M.id+"::"+K;h.get(S).onsuccess=function(C){if(N.doc=Tt(C.target.result)||{},e.conflicts){var O=Vt(M);O.length&&(N.doc._conflicts=O)}Or(N.doc,e,g)}}function B(M,N){var K={id:N.id,key:N.id,value:{rev:M}},S=N.deleted;S?o&&(s.push(K),K.value.deleted=!0,K.doc=null):f--<=0&&(s.push(K),e.include_docs&&T(N,K,M))}function P(M){for(var N=0,K=M.length;N<K&&!(s.length===d);N++){var S=M[N];if(S.error&&o){s.push(S);continue}var x=Ue(S),C=x.winningRev;B(C,x)}}function I(M,N,K){if(!K)return;P(N),s.length<d&&K.continue()}function U(M){var N=M.target.result;e.descending&&(N=N.reverse()),P(N)}function z(){var M={total_rows:u,offset:e.skip,rows:s};e.update_seq&&l!==void 0&&(M.update_seq=l),n(null,M)}function G(){e.attachments?un(s,e.binary).then(z):z()}if(c||d===0)return;if(o)return fs(e.keys,m,I);if(d===-1)return cs(m,A,U);Ir(m,A,e.descending,d+f,I)}function ds(e){return new Promise(function(t){var n=Qt([""]),r=e.objectStore(on).put(n,"key");r.onsuccess=function(){var i=navigator.userAgent.match(/Chrome\/(\d+)/),a=navigator.userAgent.match(/Edge\//);t(a||!i||parseInt(i[1],10)>=43)},r.onerror=e.onabort=function(i){i.preventDefault(),i.stopPropagation(),t(!1)}}).catch(function(){return!1})}function vs(e,t){var n=e.objectStore(ie).index("deletedOrLocal");n.count(IDBKeyRange.only("0")).onsuccess=function(r){t(r.target.result)}}var cn=!1,fn=[];function gs(e,t,n,r){try{e(t,n)}catch(i){r.emit("error",i)}}function Pr(){if(cn||!fn.length)return;cn=!0,fn.shift()()}function ps(e,t,n){fn.push(function(){e(function(a,o){gs(t,a,o,n),cn=!1,be(function(){Pr()})})}),Pr()}function ms(e,t,n,r){if(e=ae(e),e.continuous){var i=n+":"+Ct();return pt.addListener(n,i,t,e),pt.notify(n),{cancel:function(){pt.removeListener(n,i)}}}var a=e.doc_ids&&new Ke(e.doc_ids);e.since=e.since||0;var o=e.since,f="limit"in e?e.limit:-1;f===0&&(f=1);var d=[],w=0,A=Gt(e),c=new fe(),y,b,g,m;function _(B,P,I){if(!I||!B.length)return;var U=new Array(B.length),z=new Array(B.length);function G(K,S){var x=e.processChange(S,K,e);o=x.seq=K.seq;var C=A(x);return typeof C=="object"?Promise.reject(C):C?(w++,e.return_docs&&d.push(x),e.attachments&&e.include_docs?new Promise(function(O){Or(S,e,y,function(){un([x],e.binary).then(function(){O(x)})})}):Promise.resolve(x)):Promise.resolve()}function M(){for(var K=[],S=0,x=U.length;S<x&&!(w===f);S++){var C=U[S];if(!C)continue;var O=z[S];K.push(G(O,C))}Promise.all(K).then(function(q){for(var k=0,D=q.length;k<D;k++)q[k]&&e.onChange(q[k])}).catch(e.complete),w!==f&&I.continue()}var N=0;P.forEach(function(K,S){var x=Tt(K),C=B[S];h(x,C,function(O,q){z[S]=O,U[S]=q,++N===B.length&&M()})})}function p(B,P,I,U){if(I.seq!==P)return U();if(I.winningRev===B._rev)return U(I,B);var z=B._id+"::"+I.winningRev,G=m.get(z);G.onsuccess=function(M){U(I,Tt(M.target.result))}}function h(B,P,I){if(a&&!a.has(B._id))return I();var U=c.get(B._id);if(U)return p(B,P,U,I);g.get(B._id).onsuccess=function(z){U=Ue(z.target.result),c.set(B._id,U),p(B,P,U,I)}}function s(){e.complete(null,{results:d,last_seq:o})}function u(){!e.continuous&&e.attachments?un(d).then(s):s()}var l=[ie,ue];e.attachments&&l.push(ge);var v=_e(r,l,"readonly");if(v.error)return e.complete(v.error);y=v.txn,y.onabort=Se(e.complete),y.oncomplete=u,b=y.objectStore(ue),g=y.objectStore(ie),m=b.index("_doc_id_rev");var T=e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null;Ir(b,T,e.descending,f,_)}var nt=new fe(),ln,hn=new fe();function Rr(e,t){var n=this;ps(function(r){ys(n,e,r)},t,n.constructor)}function ys(e,t,n){var r=t.name,i=null;e._meta=null;function a(g){var m=g.createObjectStore(ie,{keyPath:"id"});g.createObjectStore(ue,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),g.createObjectStore(ge,{keyPath:"digest"}),g.createObjectStore(ce,{keyPath:"id",autoIncrement:!1}),g.createObjectStore(on),m.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),g.createObjectStore(Ae,{keyPath:"_id"});var _=g.createObjectStore(Fe,{autoIncrement:!0});_.createIndex("seq","seq"),_.createIndex("digestSeq","digestSeq",{unique:!0})}function o(g,m){var _=g.objectStore(ie);_.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),_.openCursor().onsuccess=function(p){var h=p.target.result;if(h){var s=h.value,u=Ce(s);s.deletedOrLocal=u?"1":"0",_.put(s),h.continue()}else m()}}function f(g){g.createObjectStore(Ae,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function d(g,m){var _=g.objectStore(Ae),p=g.objectStore(ie),h=g.objectStore(ue),s=p.openCursor();s.onsuccess=function(u){var l=u.target.result;if(l){var v=l.value,T=v.id,B=je(T),P=Re(v);if(B){var I=T+"::"+P,U=T+"::",z=T+"::~",G=h.index("_doc_id_rev"),M=IDBKeyRange.bound(U,z,!1,!1),N=G.openCursor(M);N.onsuccess=function(K){if(N=K.target.result,!N)p.delete(l.primaryKey),l.continue();else{var S=N.value;S._doc_id_rev===I&&_.put(S),h.delete(N.primaryKey),N.continue()}}}else l.continue()}else m&&m()}}function w(g){var m=g.createObjectStore(Fe,{autoIncrement:!0});m.createIndex("seq","seq"),m.createIndex("digestSeq","digestSeq",{unique:!0})}function A(g,m){var _=g.objectStore(ue),p=g.objectStore(ge),h=g.objectStore(Fe),s=p.count();s.onsuccess=function(u){var l=u.target.result;if(!l)return m();_.openCursor().onsuccess=function(v){var T=v.target.result;if(!T)return m();for(var B=T.value,P=T.primaryKey,I=Object.keys(B._attachments||{}),U={},z=0;z<I.length;z++){var G=B._attachments[I[z]];U[G.digest]=!0}var M=Object.keys(U);for(z=0;z<M.length;z++){var N=M[z];h.put({seq:P,digestSeq:N+"::"+P})}T.continue()}}}function c(g){function m(s){return s.data?Ue(s):(s.deleted=s.deletedOrLocal==="1",s)}var _=g.objectStore(ue),p=g.objectStore(ie),h=p.openCursor();h.onsuccess=function(s){var u=s.target.result;if(!u)return;var l=m(u.value);l.winningRev=l.winningRev||Re(l);function v(){var B=l.id+"::",P=l.id+"::",I=_.index("_doc_id_rev").openCursor(IDBKeyRange.bound(B,P)),U=0;I.onsuccess=function(z){var G=z.target.result;if(!G)return l.seq=U,T();var M=G.primaryKey;M>U&&(U=M),G.continue()}}function T(){var B=sn(l,l.winningRev,l.deleted),P=p.put(B);P.onsuccess=function(){u.continue()}}if(l.seq)return T();v()}}e._remote=!1,e.type=function(){return"idb"},e._id=Wn(function(g){g(null,e._meta.instanceId)}),e._bulkDocs=function(m,_,p){us(t,m,_,e,i,p)},e._get=function(m,_,p){var h,s,u,l=_.ctx;if(!l){var v=_e(i,[ie,ue,ge],"readonly");if(v.error)return p(v.error);l=v.txn}function T(){p(u,{doc:h,metadata:s,ctx:l})}l.objectStore(ie).get(m).onsuccess=function(B){if(s=Ue(B.target.result),!s)return u=X(me,"missing"),T();var P;if(_.rev)P=_.latest?Va(_.rev,s):_.rev;else{P=s.winningRev;var I=Ce(s);if(I)return u=X(me,"deleted"),T()}var U=l.objectStore(ue),z=s.id+"::"+P;U.index("_doc_id_rev").get(z).onsuccess=function(G){if(h=G.target.result,h&&(h=Tt(h)),!h)return u=X(me,"missing"),T();T()}}},e._getAttachment=function(g,m,_,p,h){var s;if(p.ctx)s=p.ctx;else{var u=_e(i,[ie,ue,ge],"readonly");if(u.error)return h(u.error);s=u.txn}var l=_.digest,v=_.content_type;s.objectStore(ge).get(l).onsuccess=function(T){var B=T.target.result.body;Er(B,v,p.binary,function(P){h(null,P)})}},e._info=function(m){var _,p,h=_e(i,[ce,ue],"readonly");if(h.error)return m(h.error);var s=h.txn;s.objectStore(ce).get(ce).onsuccess=function(u){p=u.target.result.docCount},s.objectStore(ue).openCursor(null,"prev").onsuccess=function(u){var l=u.target.result;_=l?l.key:0},s.oncomplete=function(){m(null,{doc_count:p,update_seq:_,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(m,_){hs(m,i,_)},e._changes=function(m){return ms(m,e,r,i)},e._close=function(g){i.close(),nt.delete(r),g()},e._getRevisionTree=function(g,m){var _=_e(i,[ie],"readonly");if(_.error)return m(_.error);var p=_.txn,h=p.objectStore(ie).get(g);h.onsuccess=function(s){var u=Ue(s.target.result);u?m(null,u.rev_tree):m(X(me))}},e._doCompaction=function(g,m,_){var p=[ie,ue,ge,Fe],h=_e(i,p,"readwrite");if(h.error)return _(h.error);var s=h.txn,u=s.objectStore(ie);u.get(g).onsuccess=function(l){var v=Ue(l.target.result);Le(v.rev_tree,function(P,I,U,z,G){var M=I+"-"+U;m.indexOf(M)!==-1&&(G.status="missing")}),Br(m,g,s);var T=v.winningRev,B=v.deleted;s.objectStore(ie).put(sn(v,T,B))},s.onabort=Se(_),s.oncomplete=function(){_()}},e._getLocal=function(g,m){var _=_e(i,[Ae],"readonly");if(_.error)return m(_.error);var p=_.txn,h=p.objectStore(Ae).get(g);h.onerror=Se(m),h.onsuccess=function(s){var u=s.target.result;u?(delete u._doc_id_rev,m(null,u)):m(X(me))}},e._putLocal=function(g,m,_){typeof m=="function"&&(_=m,m={}),delete g._revisions;var p=g._rev,h=g._id;p?g._rev="0-"+(parseInt(p.split("-")[1],10)+1):g._rev="0-1";var s=m.ctx,u;if(!s){var l=_e(i,[Ae],"readwrite");if(l.error)return _(l.error);s=l.txn,s.onerror=Se(_),s.oncomplete=function(){u&&_(null,u)}}var v=s.objectStore(Ae),T;p?(T=v.get(h),T.onsuccess=function(B){var P=B.target.result;if(!P||P._rev!==p)_(X(Ze));else{var I=v.put(g);I.onsuccess=function(){u={ok:!0,id:g._id,rev:g._rev},m.ctx&&_(null,u)}}}):(T=v.add(g),T.onerror=function(B){_(X(Ze)),B.preventDefault(),B.stopPropagation()},T.onsuccess=function(){u={ok:!0,id:g._id,rev:g._rev},m.ctx&&_(null,u)})},e._removeLocal=function(g,m,_){typeof m=="function"&&(_=m,m={});var p=m.ctx;if(!p){var h=_e(i,[Ae],"readwrite");if(h.error)return _(h.error);p=h.txn,p.oncomplete=function(){s&&_(null,s)}}var s,u=g._id,l=p.objectStore(Ae),v=l.get(u);v.onerror=Se(_),v.onsuccess=function(T){var B=T.target.result;!B||B._rev!==g._rev?_(X(me)):(l.delete(u),s={ok:!0,id:u,rev:"0-0"},m.ctx&&_(null,s))}},e._destroy=function(g,m){pt.removeAllListeners(r);var _=hn.get(r);_&&_.result&&(_.result.close(),nt.delete(r));var p=indexedDB.deleteDatabase(r);p.onsuccess=function(){hn.delete(r),At()&&r in localStorage&&delete localStorage[r],m(null,{ok:!0})},p.onerror=Se(m)};var y=nt.get(r);if(y)return i=y.idb,e._meta=y.global,be(function(){n(null,e)});var b=indexedDB.open(r,as);hn.set(r,b),b.onupgradeneeded=function(g){var m=g.target.result;if(g.oldVersion<1)return a(m);var _=g.currentTarget.transaction;g.oldVersion<3&&f(m),g.oldVersion<4&&w(m);var p=[o,d,A,c],h=g.oldVersion;function s(){var u=p[h-1];h++,u&&u(_,s)}s()},b.onsuccess=function(g){i=g.target.result,i.onversionchange=function(){i.close(),nt.delete(r)},i.onabort=function(T){ve("error","Database has a global failure",T.target.error),i.close(),nt.delete(r)};var m=i.transaction([ce,on,ie],"readwrite"),_=!1,p,h,s,u;function l(){if(typeof s=="undefined"||!_)return;e._meta={name:r,instanceId:u,blobSupport:s},nt.set(r,{idb:i,global:e._meta}),n(null,e)}function v(){if(typeof h=="undefined"||typeof p=="undefined")return;var T=r+"_id";T in p?u=p[T]:p[T]=u=Ct(),p.docCount=h,m.objectStore(ce).put(p)}m.objectStore(ce).get(ce).onsuccess=function(T){p=T.target.result||{id:ce},v()},vs(m,function(T){h=T,v()}),ln||(ln=ds(m)),ln.then(function(T){s=T,l()}),m.oncomplete=function(){_=!0,l()},m.onabort=Se(n)},b.onerror=function(g){var m=g.target.error&&g.target.error.message;m?m.indexOf("stored database is a higher version")!==-1&&(m=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):m="Failed to open indexedDB, are you in private browsing mode?",ve("error",m),n(X(Mt,m))}}Rr.valid=function(){try{return typeof indexedDB!="undefined"&&typeof IDBKeyRange!="undefined"}catch(e){return!1}};function _s(e){e.adapter("idb",Rr,!0)}function bs(e,t){return new Promise(function(n,r){var i=0,a=0,o=0,f=e.length,d;function w(){i++,e[a++]().then(c,y)}function A(){++o===f?d?r(d):n():b()}function c(){i--,A()}function y(g){i--,d=d||g,A()}function b(){for(;i<t&&a<f;)w()}b()})}var ws=25,As=50,qt=5e3,Ss=1e4,dn={};function vn(e){var t=e.doc||e.ok,n=t&&t._attachments;if(!n)return;Object.keys(n).forEach(function(r){var i=n[r];i.data=Kt(i.data,i.content_type)})}function Me(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function Lr(e){return!e._attachments||!Object.keys(e._attachments)?Promise.resolve():Promise.all(Object.keys(e._attachments).map(function(t){var n=e._attachments[t];if(n.data&&typeof n.data!="string")return new Promise(function(r){Ht(n.data,r)}).then(function(r){n.data=r})}))}function xs(e){if(!e.prefix)return!1;var t=ir(e.prefix).protocol;return t==="http"||t==="https"}function ks(e,t){if(xs(t)){var n=t.name.substr(t.prefix.length),r=t.prefix.replace(/\/?$/,"/");e=r+encodeURIComponent(n)}var i=ir(e);(i.user||i.password)&&(i.auth={username:i.user,password:i.password});var a=i.path.replace(/(^\/|\/$)/g,"").split("/");return i.db=a.pop(),i.db.indexOf("%")===-1&&(i.db=encodeURIComponent(i.db)),i.path=a.join("/"),i}function oe(e,t){return Dt(e,e.db+"/"+t)}function Dt(e,t){var n=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+n+t}function Et(e){return"?"+Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}function Cs(e){var t=typeof navigator!="undefined"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=t.indexOf("msie")!==-1,r=t.indexOf("trident")!==-1,i=t.indexOf("edge")!==-1,a=!("method"in e)||e.method==="GET";return(n||r||i)&&a}function gn(e,t){var n=this,r=ks(e.name,e),i=oe(r,"");e=ae(e);var a=function(c,y){if(y=y||{},y.headers=y.headers||new et(),y.credentials="include",e.auth||r.auth){var b=e.auth||r.auth,g=b.username+":"+b.password,m=lt(unescape(encodeURIComponent(g)));y.headers.set("Authorization","Basic "+m)}var _=e.headers||{};Object.keys(_).forEach(function(h){y.headers.append(h,_[h])}),Cs(y)&&(c+=(c.indexOf("?")===-1?"?":"&")+"_nonce="+Date.now());var p=e.fetch||pr;return p(c,y)};function o(c,y){return re(c,Xe(function(b){w().then(function(){return y.apply(this,b)}).catch(function(g){var m=b.pop();m(g)})})).bind(n)}function f(c,y,b){var g={};return y=y||{},y.headers=y.headers||new et(),y.headers.get("Content-Type")||y.headers.set("Content-Type","application/json"),y.headers.get("Accept")||y.headers.set("Accept","application/json"),a(c,y).then(function(m){return g.ok=m.ok,g.status=m.status,m.json()}).then(function(m){if(g.data=m,!g.ok){g.data.status=g.status;var _=Ve(g.data);if(b)return b(_);throw _}if(Array.isArray(g.data)&&(g.data=g.data.map(function(p){return p.error||p.missing?Ve(p):p})),b)b(null,g.data);else return g})}var d;function w(){return e.skip_setup?Promise.resolve():d||(d=f(i).catch(function(c){return c&&c.status&&c.status===404?(Nt(404,"PouchDB is just detecting if the remote exists."),f(i,{method:"PUT"})):Promise.reject(c)}).catch(function(c){return c&&c.status&&c.status===412?!0:Promise.reject(c)}),d.catch(function(){d=null}),d)}be(function(){t(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=o("id",function(c){a(Dt(r,"")).then(function(y){return y.json()}).catch(function(){return{}}).then(function(y){var b=y&&y.uuid?y.uuid+r.db:oe(r,"");c(null,b)})}),n.compact=o("compact",function(c,y){typeof c=="function"&&(y=c,c={}),c=ae(c),f(oe(r,"_compact"),{method:"POST"}).then(function(){function b(){n.info(function(g,m){m&&!m.compact_running?y(null,{ok:!0}):setTimeout(b,c.interval||200)})}b()})}),n.bulkGet=re("bulkGet",function(c,y){var b=this;function g(h){var s={};c.revs&&(s.revs=!0),c.attachments&&(s.attachments=!0),c.latest&&(s.latest=!0),f(oe(r,"_bulk_get"+Et(s)),{method:"POST",body:JSON.stringify({docs:c.docs})}).then(function(u){c.attachments&&c.binary&&u.data.results.forEach(function(l){l.docs.forEach(vn)}),h(null,u.data)}).catch(h)}function m(){var h=As,s=Math.ceil(c.docs.length/h),u=0,l=new Array(s);function v(P){return function(I,U){l[P]=U.results,++u===s&&y(null,{results:xt(l)})}}for(var T=0;T<s;T++){var B=ft(c,["revs","attachments","binary","latest"]);B.docs=c.docs.slice(T*h,Math.min(c.docs.length,(T+1)*h)),Xn(b,B,v(T))}}var _=Dt(r,""),p=dn[_];typeof p!="boolean"?g(function(h,s){h?(dn[_]=!1,Nt(h.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),m()):(dn[_]=!0,y(null,s))}):p?g(y):m()}),n._info=function(c){w().then(function(){return a(oe(r,""))}).then(function(y){return y.json()}).then(function(y){y.host=oe(r,""),c(null,y)}).catch(c)},n.fetch=function(c,y){return w().then(function(){var b=c.substring(0,1)==="/"?Dt(r,c.substring(1)):oe(r,c);return a(b,y)})},n.get=o("get",function(c,y,b){typeof y=="function"&&(b=y,y={}),y=ae(y);var g={};y.revs&&(g.revs=!0),y.revs_info&&(g.revs_info=!0),y.latest&&(g.latest=!0),y.open_revs&&(y.open_revs!=="all"&&(y.open_revs=JSON.stringify(y.open_revs)),g.open_revs=y.open_revs),y.rev&&(g.rev=y.rev),y.conflicts&&(g.conflicts=y.conflicts),y.update_seq&&(g.update_seq=y.update_seq),c=Me(c);function m(h){var s=h._attachments,u=s&&Object.keys(s);if(!s||!u.length)return;function l(T){var B=s[T],P=Me(h._id)+"/"+A(T)+"?rev="+h._rev;return a(oe(r,P)).then(function(I){return"buffer"in I?I.buffer():I.blob()}).then(function(I){if(y.binary){var U=Object.getOwnPropertyDescriptor(I.__proto__,"type");return(!U||U.set)&&(I.type=B.content_type),I}return new Promise(function(z){Ht(I,z)})}).then(function(I){delete B.stub,delete B.length,B.data=I})}var v=u.map(function(T){return function(){return l(T)}});return bs(v,5)}function _(h){return Array.isArray(h)?Promise.all(h.map(function(s){if(s.ok)return m(s.ok)})):m(h)}var p=oe(r,c+Et(g));f(p).then(function(h){return Promise.resolve().then(function(){if(y.attachments)return _(h.data)}).then(function(){b(null,h.data)})}).catch(function(h){h.docId=c,b(h)})}),n.remove=o("remove",function(c,y,b,g){var m;typeof y=="string"?(m={_id:c,_rev:y},typeof b=="function"&&(g=b,b={})):(m=c,typeof y=="function"?(g=y,b={}):(g=b,b=y));var _=m._rev||b.rev,p=oe(r,Me(m._id))+"?rev="+_;f(p,{method:"DELETE"},g).catch(g)});function A(c){return c.split("/").map(encodeURIComponent).join("/")}n.getAttachment=o("getAttachment",function(c,y,b,g){typeof b=="function"&&(g=b,b={});var m=b.rev?"?rev="+b.rev:"",_=oe(r,Me(c))+"/"+A(y)+m,p;a(_,{method:"GET"}).then(function(h){if(p=h.headers.get("content-type"),h.ok)return typeof bt!="undefined"&&!bt.browser&&typeof h.buffer=="function"?h.buffer():h.blob();throw h}).then(function(h){typeof bt!="undefined"&&!bt.browser&&(h.type=p),g(null,h)}).catch(function(h){g(h)})}),n.removeAttachment=o("removeAttachment",function(c,y,b,g){var m=oe(r,Me(c)+"/"+A(y))+"?rev="+b;f(m,{method:"DELETE"},g).catch(g)}),n.putAttachment=o("putAttachment",function(c,y,b,g,m,_){typeof m=="function"&&(_=m,m=g,g=b,b=null);var p=Me(c)+"/"+A(y),h=oe(r,p);if(b&&(h+="?rev="+b),typeof g=="string"){var s;try{s=Wt(g)}catch(u){return _(X(Yn,"Attachment is not a valid base64 string"))}g=s?Xt(s,m):""}f(h,{headers:new et({"Content-Type":m}),method:"PUT",body:g},_).catch(_)}),n._bulkDocs=function(c,y,b){c.new_edits=y.new_edits,w().then(function(){return Promise.all(c.docs.map(Lr))}).then(function(){return f(oe(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(c)},b)}).catch(b)},n._put=function(c,y,b){w().then(function(){return Lr(c)}).then(function(){return f(oe(r,Me(c._id)),{method:"PUT",body:JSON.stringify(c)})}).then(function(g){b(null,g.data)}).catch(function(g){g.docId=c&&c._id,b(g)})},n.allDocs=o("allDocs",function(c,y){typeof c=="function"&&(y=c,c={}),c=ae(c);var b={},g,m="GET";c.conflicts&&(b.conflicts=!0),c.update_seq&&(b.update_seq=!0),c.descending&&(b.descending=!0),c.include_docs&&(b.include_docs=!0),c.attachments&&(b.attachments=!0),c.key&&(b.key=JSON.stringify(c.key)),c.start_key&&(c.startkey=c.start_key),c.startkey&&(b.startkey=JSON.stringify(c.startkey)),c.end_key&&(c.endkey=c.end_key),c.endkey&&(b.endkey=JSON.stringify(c.endkey)),typeof c.inclusive_end!="undefined"&&(b.inclusive_end=!!c.inclusive_end),typeof c.limit!="undefined"&&(b.limit=c.limit),typeof c.skip!="undefined"&&(b.skip=c.skip);var _=Et(b);typeof c.keys!="undefined"&&(m="POST",g={keys:c.keys}),f(oe(r,"_all_docs"+_),{method:m,body:JSON.stringify(g)}).then(function(p){c.include_docs&&c.attachments&&c.binary&&p.data.rows.forEach(vn),y(null,p.data)}).catch(y)}),n._changes=function(c){var y="batch_size"in c?c.batch_size:ws;c=ae(c),c.continuous&&!("heartbeat"in c)&&(c.heartbeat=Ss);var b="timeout"in c?c.timeout:30*1e3;"timeout"in c&&c.timeout&&b-c.timeout<qt&&(b=c.timeout+qt),"heartbeat"in c&&c.heartbeat&&b-c.heartbeat<qt&&(b=c.heartbeat+qt);var g={};"timeout"in c&&c.timeout&&(g.timeout=c.timeout);var m=typeof c.limit!="undefined"?c.limit:!1,_=m;if(c.style&&(g.style=c.style),(c.include_docs||c.filter&&typeof c.filter=="function")&&(g.include_docs=!0),c.attachments&&(g.attachments=!0),c.continuous&&(g.feed="longpoll"),c.seq_interval&&(g.seq_interval=c.seq_interval),c.conflicts&&(g.conflicts=!0),c.descending&&(g.descending=!0),c.update_seq&&(g.update_seq=!0),"heartbeat"in c&&(c.heartbeat&&(g.heartbeat=c.heartbeat)),c.filter&&typeof c.filter=="string"&&(g.filter=c.filter),c.view&&typeof c.view=="string"&&(g.filter="_view",g.view=c.view),c.query_params&&typeof c.query_params=="object")for(var p in c.query_params)c.query_params.hasOwnProperty(p)&&(g[p]=c.query_params[p]);var h="GET",s;c.doc_ids?(g.filter="_doc_ids",h="POST",s={doc_ids:c.doc_ids}):c.selector&&(g.filter="_selector",h="POST",s={selector:c.selector});var u=new co(),l,v=function(P,I){if(c.aborted)return;g.since=P,typeof g.since=="object"&&(g.since=JSON.stringify(g.since)),c.descending?m&&(g.limit=_):g.limit=!m||_>y?y:_;var U=oe(r,"_changes"+Et(g)),z={signal:u.signal,method:h,body:JSON.stringify(s)};if(l=P,c.aborted)return;w().then(function(){return f(U,z,I)}).catch(I)},T={results:[]},B=function(P,I){if(c.aborted)return;var U=0;if(I&&I.results){U=I.results.length,T.last_seq=I.last_seq;var z=null,G=null;typeof I.pending=="number"&&(z=I.pending),(typeof T.last_seq=="string"||typeof T.last_seq=="number")&&(G=T.last_seq);var M={};M.query=c.query_params,I.results=I.results.filter(function(K){_--;var S=Gt(c)(K);return S&&(c.include_docs&&c.attachments&&c.binary&&vn(K),c.return_docs&&T.results.push(K),c.onChange(K,z,G)),S})}else if(P){c.aborted=!0,c.complete(P);return}I&&I.last_seq&&(l=I.last_seq);var N=m&&_<=0||I&&U<y||c.descending;c.continuous&&!(m&&_<=0)||!N?be(function(){v(l,B)}):c.complete(null,T)};return v(c.since||0,B),{cancel:function(){c.aborted=!0,u.abort()}}},n.revsDiff=o("revsDiff",function(c,y,b){typeof y=="function"&&(b=y,y={}),f(oe(r,"_revs_diff"),{method:"POST",body:JSON.stringify(c)},b).catch(b)}),n._close=function(c){c()},n._destroy=function(c,y){f(oe(r,""),{method:"DELETE"}).then(function(b){y(null,b)}).catch(function(b){b.status===404?y(null,{ok:!0}):y(b)})}}gn.valid=function(){return!0};function Ts(e){e.adapter("http",gn,!1),e.adapter("https",gn,!1)}function Ge(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Ge)}catch(t){}}pe(Ge,Error);function Ot(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Ot)}catch(t){}}pe(Ot,Error);function Bt(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,Bt)}catch(t){}}pe(Bt,Error);function jr(e,t){return t&&e.then(function(n){be(function(){t(null,n)})},function(n){be(function(){t(n)})}),e}function qs(e){return Xe(function(t){var n=t.pop(),r=e.apply(this,t);return typeof n=="function"&&jr(r,n),r})}function Ds(e,t){return e.then(function(n){return t().then(function(){return n})},function(n){return t().then(function(){throw n})})}function pn(e,t){return function(){var n=arguments,r=this;return e.add(function(){return t.apply(r,n)})}}function $r(e){var t=new Ke(e),n=new Array(t.size),r=-1;return t.forEach(function(i){n[++r]=i}),n}function mn(e){var t=new Array(e.size),n=-1;return e.forEach(function(r,i){t[++n]=i}),t}function Nr(e){var t="builtin "+e+" function requires map values to be numbers or number arrays";return new Bt(t)}function yn(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];if(typeof i!="number")if(Array.isArray(i)){t=typeof t=="number"?[t]:t;for(var a=0,o=i.length;a<o;a++){var f=i[a];if(typeof f!="number")throw Nr("_sum");typeof t[a]=="undefined"?t.push(f):t[a]+=f}}else throw Nr("_sum");else typeof t=="number"?t+=i:t[0]+=i}return t}var Es=ve.bind(null,"log"),Os=Array.isArray,Bs=JSON.parse;function Fr(e,t){return Jt("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:yn,log:Es,isArray:Os,toJSON:Bs})}function mt(){this.promise=new Promise(function(e){e()})}mt.prototype.add=function(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise},mt.prototype.finish=function(){return this.promise};function Ur(e){if(!e)return"undefined";switch(typeof e){case"function":return e.toString();case"string":return e.toString();default:return JSON.stringify(e)}}function Is(e,t){return Ur(e)+Ur(t)+"undefined"}function Mr(e,t,n,r,i,a){var o=Is(n,r),f;if(!i&&(f=e._cachedViews=e._cachedViews||{},f[o]))return f[o];var d=e.info().then(function(w){var A=w.db_name+"-mrview-"+(i?"temp":sr(o));function c(y){y.views=y.views||{};var b=t;b.indexOf("/")===-1&&(b=t+"/"+t);var g=y.views[b]=y.views[b]||{};return g[A]?void 0:(g[A]=!0,y)}return kt(e,"_local/"+a,c).then(function(){return e.registerDependentDatabase(A).then(function(y){var b=y.db;b.auto_compaction=!0;var g={name:A,db:b,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:r};return g.db.get("_local/lastSeq").catch(function(m){if(m.status!==404)throw m}).then(function(m){return g.seq=m?m.seq:0,f&&g.db.once("destroyed",function(){delete f[o]}),g})})})});return f&&(f[o]=d),d}var Gr={},zr=new mt(),Jr=50;function _n(e){return e.indexOf("/")===-1?[e,e]:e.split("/")}function Ps(e){return e.length===1&&/^1-/.test(e[0].rev)}function Wr(e,t){try{e.emit("error",t)}catch(n){ve("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),ve("error",t)}}function Rs(e,t,n,r){function i(S,x,C){try{x(C)}catch(O){Wr(S,O)}}function a(S,x,C,O,q){try{return{output:x(C,O,q)}}catch(k){return Wr(S,k),{error:k}}}function o(S,x){var C=se(S.key,x.key);return C!==0?C:se(S.value,x.value)}function f(S,x,C){return C=C||0,typeof x=="number"?S.slice(C,x+C):C>0?S.slice(C):S}function d(S){var x=S.value,C=x&&typeof x=="object"&&x._id||S.id;return C}function w(S){S.rows.forEach(function(x){var C=x.doc&&x.doc._attachments;if(!C)return;Object.keys(C).forEach(function(O){var q=C[O];C[O].data=Kt(q.data,q.content_type)})})}function A(S){return function(x){return S.include_docs&&S.attachments&&S.binary&&w(x),x}}function c(S,x,C,O){var q=x[S];typeof q!="undefined"&&(O&&(q=encodeURIComponent(JSON.stringify(q))),C.push(S+"="+q))}function y(S){if(typeof S!="undefined"){var x=Number(S);return!isNaN(x)&&x===parseInt(S,10)?x:S}}function b(S){return S.group_level=y(S.group_level),S.limit=y(S.limit),S.skip=y(S.skip),S}function g(S){if(S){if(typeof S!="number")return new Ge('Invalid value for integer: "'+S+'"');if(S<0)return new Ge('Invalid value for positive integer: "'+S+'"')}}function m(S,x){var C=S.descending?"endkey":"startkey",O=S.descending?"startkey":"endkey";if(typeof S[C]!="undefined"&&typeof S[O]!="undefined"&&se(S[C],S[O])>0)throw new Ge("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(x.reduce&&S.reduce!==!1){if(S.include_docs)throw new Ge("{include_docs:true} is invalid for reduce");if(S.keys&&S.keys.length>1&&!S.group&&!S.group_level)throw new Ge("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(q){var k=g(S[q]);if(k)throw k})}function _(S,x,C){var O=[],q,k="GET",D,R;if(c("reduce",C,O),c("include_docs",C,O),c("attachments",C,O),c("limit",C,O),c("descending",C,O),c("group",C,O),c("group_level",C,O),c("skip",C,O),c("stale",C,O),c("conflicts",C,O),c("startkey",C,O,!0),c("start_key",C,O,!0),c("endkey",C,O,!0),c("end_key",C,O,!0),c("inclusive_end",C,O),c("key",C,O,!0),c("update_seq",C,O),O=O.join("&"),O=O===""?"":"?"+O,typeof C.keys!="undefined"){var L=2e3,F="keys="+encodeURIComponent(JSON.stringify(C.keys));F.length+O.length+1<=L?O+=(O[0]==="?"?"&":"?")+F:(k="POST",typeof x=="string"?q={keys:C.keys}:x.keys=C.keys)}if(typeof x=="string"){var j=_n(x);return S.fetch("_design/"+j[0]+"/_view/"+j[1]+O,{headers:new et({"Content-Type":"application/json"}),method:k,body:JSON.stringify(q)}).then(function(E){return D=E.ok,R=E.status,E.json()}).then(function(E){if(!D)throw E.status=R,Ve(E);return E.rows.forEach(function($){if($.value&&$.value.error&&$.value.error==="builtin_reduce_error")throw new Error($.reason)}),E}).then(A(C))}return q=q||{},Object.keys(x).forEach(function(E){Array.isArray(x[E])?q[E]=x[E]:q[E]=x[E].toString()}),S.fetch("_temp_view"+O,{headers:new et({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(q)}).then(function(E){return D=E.ok,R=E.status,E.json()}).then(function(E){if(!D)throw E.status=R,Ve(E);return E}).then(A(C))}function p(S,x,C){return new Promise(function(O,q){S._query(x,C,function(k,D){if(k)return q(k);O(D)})})}function h(S){return new Promise(function(x,C){S._viewCleanup(function(O,q){if(O)return C(O);x(q)})})}function s(S){return function(x){if(x.status===404)return S;throw x}}function u(S,x,C){var O="_local/doc_"+S,q={_id:O,keys:[]},k=C.get(S),D=k[0],R=k[1];function L(){return Ps(R)?Promise.resolve(q):x.db.get(O).catch(s(q))}function F(E){return E.keys.length?x.db.allDocs({keys:E.keys,include_docs:!0}):Promise.resolve({rows:[]})}function j(E,$){for(var W=[],V=new Ke(),Y=0,H=$.rows.length;Y<H;Y++){var Z=$.rows[Y],ne=Z.doc;if(!ne)continue;if(W.push(ne),V.add(ne._id),ne._deleted=!D.has(ne._id),!ne._deleted){var he=D.get(ne._id);"value"in he&&(ne.value=he.value)}}var le=mn(D);return le.forEach(function(rt){if(!V.has(rt)){var it={_id:rt},kn=D.get(rt);"value"in kn&&(it.value=kn.value),W.push(it)}}),E.keys=$r(le.concat(E.keys)),W.push(E),W}return L().then(function(E){return F(E).then(function($){return j(E,$)})})}function l(S,x,C){var O="_local/lastSeq";return S.db.get(O).catch(s({_id:O,seq:0})).then(function(q){var k=mn(x);return Promise.all(k.map(function(D){return u(D,S,x)})).then(function(D){var R=xt(D);return q.seq=C,R.push(q),S.db.bulkDocs({docs:R})})})}function v(S){var x=typeof S=="string"?S:S.name,C=Gr[x];return C||(C=Gr[x]=new mt()),C}function T(S){return pn(v(S),function(){return B(S)})()}function B(S){var x,C;function O($,W){var V={id:C._id,key:$e($)};typeof W!="undefined"&&W!==null&&(V.value=$e(W)),x.push(V)}var q=t(S.mapFun,O),k=S.seq||0;function D($,W){return function(){return l(S,$,W)}}var R=new mt();function L(){return S.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:k,limit:Jr}).then(F)}function F($){var W=$.results;if(!W.length)return;var V=j(W);return R.add(D(V,k)),W.length<Jr?void 0:L()}function j($){for(var W=new fe(),V=0,Y=$.length;V<Y;V++){var H=$[V];if(H.doc._id[0]!=="_"){x=[],C=H.doc,C._deleted||i(S.sourceDB,q,C),x.sort(o);var Z=E(x);W.set(H.doc._id,[Z,H.changes])}k=H.seq}return W}function E($){for(var W=new fe(),V,Y=0,H=$.length;Y<H;Y++){var Z=$[Y],ne=[Z.key,Z.id];Y>0&&se(Z.key,V)===0&&ne.push(Y),W.set(ye(ne),Z),V=Z.key}return W}return L().then(function(){return R.finish()}).then(function(){S.seq=k})}function P(S,x,C){C.group_level===0&&delete C.group_level;var O=C.group||C.group_level,q=n(S.reduceFun),k=[],D=isNaN(C.group_level)?Number.POSITIVE_INFINITY:C.group_level;x.forEach(function(E){var $=k[k.length-1],W=O?E.key:null;if(O&&Array.isArray(W)&&(W=W.slice(0,D)),$&&se($.groupKey,W)===0){$.keys.push([E.key,E.id]),$.values.push(E.value);return}k.push({keys:[[E.key,E.id]],values:[E.value],groupKey:W})}),x=[];for(var R=0,L=k.length;R<L;R++){var F=k[R],j=a(S.sourceDB,q,F.keys,F.values,!1);if(j.error&&j.error instanceof Bt)throw j.error;x.push({value:j.error?null:j.output,key:F.groupKey})}return{rows:f(x,C.limit,C.skip)}}function I(S,x){return pn(v(S),function(){return U(S,x)})()}function U(S,x){var C,O=S.reduceFun&&x.reduce!==!1,q=x.skip||0;typeof x.keys!="undefined"&&!x.keys.length&&(x.limit=0,delete x.keys);function k(Y){return Y.include_docs=!0,S.db.allDocs(Y).then(function(H){return C=H.total_rows,H.rows.map(function(Z){if("value"in Z.doc&&typeof Z.doc.value=="object"&&Z.doc.value!==null){var ne=Object.keys(Z.doc.value).sort(),he=["id","key","value"];if(!(ne<he||ne>he))return Z.doc.value}var le=Co(Z.doc._id);return{key:le[0],id:le[1],value:"value"in Z.doc?Z.doc.value:null}})})}function D(Y){var H;if(O?H=P(S,Y,x):H={total_rows:C,offset:q,rows:Y},x.update_seq&&(H.update_seq=S.seq),x.include_docs){var Z=$r(Y.map(d));return S.sourceDB.allDocs({keys:Z,include_docs:!0,conflicts:x.conflicts,attachments:x.attachments,binary:x.binary}).then(function(ne){var he=new fe();return ne.rows.forEach(function(le){he.set(le.id,le.doc)}),Y.forEach(function(le){var rt=d(le),it=he.get(rt);it&&(le.doc=it)}),H})}else return H}if(typeof x.keys!="undefined"){var R=x.keys,L=R.map(function(Y){var H={startkey:ye([Y]),endkey:ye([Y,{}])};return x.update_seq&&(H.update_seq=!0),k(H)});return Promise.all(L).then(xt).then(D)}else{var F={descending:x.descending};x.update_seq&&(F.update_seq=!0);var j,E;if("start_key"in x&&(j=x.start_key),"startkey"in x&&(j=x.startkey),"end_key"in x&&(E=x.end_key),"endkey"in x&&(E=x.endkey),typeof j!="undefined"&&(F.startkey=x.descending?ye([j,{}]):ye([j])),typeof E!="undefined"){var $=x.inclusive_end!==!1;x.descending&&($=!$),F.endkey=ye($?[E,{}]:[E])}if(typeof x.key!="undefined"){var W=ye([x.key]),V=ye([x.key,{}]);F.descending?(F.endkey=W,F.startkey=V):(F.startkey=W,F.endkey=V)}return O||(typeof x.limit=="number"&&(F.limit=x.limit),F.skip=q),k(F).then(D)}}function z(S){return S.fetch("_view_cleanup",{headers:new et({"Content-Type":"application/json"}),method:"POST"}).then(function(x){return x.json()})}function G(S){return S.get("_local/"+e).then(function(x){var C=new fe();Object.keys(x.views).forEach(function(q){var k=_n(q),D="_design/"+k[0],R=k[1],L=C.get(D);L||(L=new Ke(),C.set(D,L)),L.add(R)});var O={keys:mn(C),include_docs:!0};return S.allDocs(O).then(function(q){var k={};q.rows.forEach(function(L){var F=L.key.substring(8);C.get(L.key).forEach(function(j){var E=F+"/"+j;x.views[E]||(E=j);var $=Object.keys(x.views[E]),W=L.doc&&L.doc.views&&L.doc.views[j];$.forEach(function(V){k[V]=k[V]||W})})});var D=Object.keys(k).filter(function(L){return!k[L]}),R=D.map(function(L){return pn(v(L),function(){return new S.constructor(L,S.__opts).destroy()})()});return Promise.all(R).then(function(){return{ok:!0}})})},s({ok:!0}))}function M(S,x,C){if(typeof S._query=="function")return p(S,x,C);if(we(S))return _(S,x,C);if(typeof x!="string")return m(C,x),zr.add(function(){var R=Mr(S,"temp_view/temp_view",x.map,x.reduce,!0,e);return R.then(function(L){return Ds(T(L).then(function(){return I(L,C)}),function(){return L.db.destroy()})})}),zr.finish();var O=x,q=_n(O),k=q[0],D=q[1];return S.get("_design/"+k).then(function(R){var L=R.views&&R.views[D];if(!L)throw new Ot("ddoc "+R._id+" has no view named "+D);r(R,D),m(C,L);var F=Mr(S,O,L.map,L.reduce,!1,e);return F.then(function(j){return C.stale==="ok"||C.stale==="update_after"?(C.stale==="update_after"&&be(function(){T(j)}),I(j,C)):T(j).then(function(){return I(j,C)})})})}function N(S,x,C){var O=this;typeof x=="function"&&(C=x,x={}),x=x?b(x):{},typeof S=="function"&&(S={map:S});var q=Promise.resolve().then(function(){return M(O,S,x)});return jr(q,C),q}var K=qs(function(){var S=this;return typeof S._viewCleanup=="function"?h(S):we(S)?z(S):G(S)});return{query:N,viewCleanup:K}}var bn={_sum:function(e,t){return yn(t)},_count:function(e,t){return t.length},_stats:function(e,t){function n(r){for(var i=0,a=0,o=r.length;a<o;a++){var f=r[a];i+=f*f}return i}return{sum:yn(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:n(t)}}};function Ls(e){if(/^_sum/.test(e))return bn._sum;if(/^_count/.test(e))return bn._count;if(/^_stats/.test(e))return bn._stats;if(/^_/.test(e))throw new Error(e+" is not a supported reduce function.")}function js(e,t){if(typeof e=="function"&&e.length===2){var n=e;return function(r){return n(r,t)}}else return Fr(e.toString(),t)}function $s(e){var t=e.toString(),n=Ls(t);return n||Fr(t)}function Ns(e,t){var n=e.views&&e.views[t];if(typeof n.map!="string")throw new Ot("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+typeof n.map)}var Fs="mrviews",Qr=Rs(Fs,js,$s,Ns);function Us(e,t,n){return Qr.query.call(this,e,t,n)}function Ms(e){return Qr.viewCleanup.call(this,e)}var Gs={query:Us,viewCleanup:Ms};function Xr(e){return/^1-/.test(e)}function zs(e,t,n){return!e._attachments||!e._attachments[n]||e._attachments[n].digest!==t._attachments[n].digest}function Kr(e,t){var n=Object.keys(t._attachments);return Promise.all(n.map(function(r){return e.getAttachment(t._id,r,{rev:t._rev})}))}function Js(e,t,n){var r=we(t)&&!we(e),i=Object.keys(n._attachments);return r?e.get(n._id).then(function(a){return Promise.all(i.map(function(o){return zs(a,n,o)?t.getAttachment(n._id,o):e.getAttachment(a._id,o)}))}).catch(function(a){if(a.status!==404)throw a;return Kr(t,n)}):Kr(t,n)}function Ws(e){var t=[];return Object.keys(e).forEach(function(n){var r=e[n].missing;r.forEach(function(i){t.push({id:n,rev:i})})}),{docs:t,revs:!0,latest:!0}}function Qs(e,t,n,r){n=ae(n);var i=[],a=!0;function o(){var y=Ws(n);return y.docs.length?e.bulkGet(y).then(function(b){if(r.cancelled)throw new Error("cancelled");return Promise.all(b.results.map(function(g){return Promise.all(g.docs.map(function(m){var _=m.ok;return m.error&&(a=!1),!_||!_._attachments?_:Js(t,e,_).then(function(p){var h=Object.keys(_._attachments);return p.forEach(function(s,u){var l=_._attachments[h[u]];delete l.stub,delete l.length,l.data=s}),_})}))})).then(function(g){i=i.concat(xt(g).filter(Boolean))})}):void 0}function f(y){return y._attachments&&Object.keys(y._attachments).length>0}function d(y){return y._conflicts&&y._conflicts.length>0}function w(y){return e.allDocs({keys:y,include_docs:!0,conflicts:!0}).then(function(b){if(r.cancelled)throw new Error("cancelled");b.rows.forEach(function(g){if(g.deleted||!g.doc||!Xr(g.value.rev)||f(g.doc)||d(g.doc))return;g.doc._conflicts&&delete g.doc._conflicts,i.push(g.doc),delete n[g.id]})})}function A(){var y=Object.keys(n).filter(function(b){var g=n[b].missing;return g.length===1&&Xr(g[0])});if(y.length>0)return w(y)}function c(){return{ok:a,docs:i}}return Promise.resolve().then(A).then(o).then(c)}var Hr=1,Yr="pouchdb",Xs=5,xe=0;function wn(e,t,n,r,i){return e.get(t).catch(function(a){if(a.status===404)return(e.adapter==="http"||e.adapter==="https")&&Nt(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:t,history:[],replicator:Yr,version:Hr};throw a}).then(function(a){return i.cancelled||a.last_seq===n?void 0:(a.history=(a.history||[]).filter(function(o){return o.session_id!==r}),a.history.unshift({last_seq:n,session_id:r}),a.history=a.history.slice(0,Xs),a.version=Hr,a.replicator=Yr,a.session_id=r,a.last_seq=n,e.put(a).catch(function(o){if(o.status===409)return wn(e,t,n,r,i);throw o}))})}function yt(e,t,n,r,i){this.src=e,this.target=t,this.id=n,this.returnValue=r,this.opts=i||{}}yt.prototype.writeCheckpoint=function(e,t){var n=this;return this.updateTarget(e,t).then(function(){return n.updateSource(e,t)})},yt.prototype.updateTarget=function(e,t){return this.opts.writeTargetCheckpoint?wn(this.target,this.id,e,t,this.returnValue):Promise.resolve(!0)},yt.prototype.updateSource=function(e,t){if(this.opts.writeSourceCheckpoint){var n=this;return wn(this.src,this.id,e,t,this.returnValue).catch(function(r){if(ei(r))return n.opts.writeSourceCheckpoint=!1,!0;throw r})}else return Promise.resolve(!0)};var Zr={undefined:function(e,t){return se(e.last_seq,t.last_seq)===0?t.last_seq:0},"1":function(e,t){return Ks(t,e).last_seq}};yt.prototype.getCheckpoint=function(){var e=this;return e.opts&&e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?e.src.get(e.id).then(function(t){return t.last_seq||xe}).catch(function(t){if(t.status!==404)throw t;return xe}):e.target.get(e.id).then(function(t){return e.opts&&e.opts.writeTargetCheckpoint&&!e.opts.writeSourceCheckpoint?t.last_seq||xe:e.src.get(e.id).then(function(n){if(t.version!==n.version)return xe;var r;return t.version?r=t.version.toString():r="undefined",r in Zr?Zr[r](t,n):xe},function(n){if(n.status===404&&t.last_seq)return e.src.put({_id:e.id,last_seq:xe}).then(function(){return xe},function(r){return ei(r)?(e.opts.writeSourceCheckpoint=!1,t.last_seq):xe});throw n})}).catch(function(t){if(t.status!==404)throw t;return xe})};function Ks(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:Vr(e.history,t.history)}function Vr(e,t){var n=e[0],r=e.slice(1),i=t[0],a=t.slice(1);if(!n||t.length===0)return{last_seq:xe,history:[]};var o=n.session_id;if(An(o,t))return{last_seq:n.last_seq,history:e};var f=i.session_id;return An(f,r)?{last_seq:i.last_seq,history:a}:Vr(r,a)}function An(e,t){var n=t[0],r=t.slice(1);return!e||t.length===0?!1:e===n.session_id?!0:An(e,r)}function ei(e){return typeof e.status=="number"&&Math.floor(e.status/100)===4}var ti=0;function Hs(e,t,n,r){if(e.retry===!1){t.emit("error",n),t.removeAllListeners();return}if(typeof e.back_off_function!="function"&&(e.back_off_function=xa),t.emit("requestError",n),t.state==="active"||t.state==="pending"){t.emit("paused",n),t.state="stopped";var i=function(){e.current_back_off=ti},a=function(){t.removeListener("active",i)};t.once("paused",a),t.once("active",i)}e.current_back_off=e.current_back_off||ti,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(r,e.current_back_off)}function Ys(e){return Object.keys(e).sort(se).reduce(function(t,n){return t[n]=e[n],t},{})}function Zs(e,t,n){var r=n.doc_ids?n.doc_ids.sort(se):"",i=n.filter?n.filter.toString():"",a="",o="",f="";return n.selector&&(f=JSON.stringify(n.selector)),n.filter&&n.query_params&&(a=JSON.stringify(Ys(n.query_params))),n.filter&&n.filter==="_view"&&(o=n.view.toString()),Promise.all([e.id(),t.id()]).then(function(d){var w=d[0]+d[1]+i+o+a+r+f;return new Promise(function(A){Yt(w,A)})}).then(function(d){return d=d.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+d})}function ni(e,t,n,r,i){var a=[],o,f={seq:0,changes:[],docs:[]},d=!1,w=!1,A=!1,c=0,y=n.continuous||n.live||!1,b=n.batch_size||100,g=n.batches_limit||10,m=!1,_=n.doc_ids,p=n.selector,h,s,u=[],l=Ct();i=i||{ok:!0,start_time:new Date().toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var v={};r.ready(e,t);function T(){return s?Promise.resolve():Zs(e,t,n).then(function(k){h=k;var D={};n.checkpoint===!1?D={writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:n.checkpoint==="source"?D={writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:n.checkpoint==="target"?D={writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:D={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},s=new yt(e,t,h,r,D)})}function B(){if(u=[],o.docs.length===0)return;var k=o.docs,D={timeout:n.timeout};return t.bulkDocs({docs:k,new_edits:!1},D).then(function(R){if(r.cancelled)throw N(),new Error("cancelled");var L=Object.create(null);R.forEach(function(j){j.error&&(L[j.id]=j)});var F=Object.keys(L).length;i.doc_write_failures+=F,i.docs_written+=k.length-F,k.forEach(function(j){var E=L[j._id];if(E){i.errors.push(E);var $=(E.name||"").toLowerCase();if($==="unauthorized"||$==="forbidden")r.emit("denied",ae(E));else throw E}else u.push(j)})},function(R){throw i.doc_write_failures+=k.length,R})}function P(){if(o.error)throw new Error("There was a problem getting docs.");i.last_seq=c=o.seq;var k=ae(i);return u.length&&(k.docs=u,typeof o.pending=="number"&&(k.pending=o.pending,delete o.pending),r.emit("change",k)),d=!0,s.writeCheckpoint(o.seq,l).then(function(){if(d=!1,r.cancelled)throw N(),new Error("cancelled");o=void 0,C()}).catch(function(D){throw q(D),D})}function I(){var k={};return o.changes.forEach(function(D){if(D.id==="_user/")return;k[D.id]=D.changes.map(function(R){return R.rev})}),t.revsDiff(k).then(function(D){if(r.cancelled)throw N(),new Error("cancelled");o.diffs=D})}function U(){return Qs(e,t,o.diffs,r).then(function(k){o.error=!k.ok,k.docs.forEach(function(D){delete o.diffs[D._id],i.docs_read++,o.docs.push(D)})})}function z(){if(r.cancelled||o)return;if(a.length===0){G(!0);return}o=a.shift(),I().then(U).then(B).then(P).then(z).catch(function(k){M("batch processing terminated with error",k)})}function G(k){if(f.changes.length===0){a.length===0&&!o&&((y&&v.live||w)&&(r.state="pending",r.emit("paused")),w&&N());return}(k||w||f.changes.length>=b)&&(a.push(f),f={seq:0,changes:[],docs:[]},(r.state==="pending"||r.state==="stopped")&&(r.state="active",r.emit("active")),z())}function M(k,D){if(A)return;D.message||(D.message=k),i.ok=!1,i.status="aborting",a=[],f={seq:0,changes:[],docs:[]},N(D)}function N(k){if(A)return;if(r.cancelled&&(i.status="cancelled",d))return;if(i.status=i.status||"complete",i.end_time=new Date().toISOString(),i.last_seq=c,A=!0,k){k=X(k),k.result=i;var D=(k.name||"").toLowerCase();D==="unauthorized"||D==="forbidden"?(r.emit("error",k),r.removeAllListeners()):Hs(n,r,k,function(){ni(e,t,n,r)})}else r.emit("complete",i),r.removeAllListeners()}function K(k,D,R){if(r.cancelled)return N();typeof D=="number"&&(f.pending=D);var L=Gt(n)(k);if(!L)return;f.seq=k.seq||R,f.changes.push(k),be(function(){G(a.length===0&&v.live)})}function S(k){if(m=!1,r.cancelled)return N();if(k.results.length>0)v.since=k.results[k.results.length-1].seq,C(),G(!0);else{var D=function(){y?(v.live=!0,C()):w=!0,G(!0)};!o&&k.results.length===0?(d=!0,s.writeCheckpoint(k.last_seq,l).then(function(){d=!1,i.last_seq=c=k.last_seq,D()}).catch(q)):D()}}function x(k){if(m=!1,r.cancelled)return N();M("changes rejected",k)}function C(){if(!(!m&&!w&&a.length<g))return;m=!0;function k(){R.cancel()}function D(){r.removeListener("cancel",k)}r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",k);var R=e.changes(v).on("change",K);R.then(D,D),R.then(S).catch(x),n.retry&&(r._changes=R,r._abortChanges=k)}function O(){T().then(function(){if(r.cancelled){N();return}return s.getCheckpoint().then(function(k){c=k,v={since:c,limit:b,batch_size:b,style:"all_docs",doc_ids:_,selector:p,return_docs:!0},n.filter&&(typeof n.filter!="string"?v.include_docs=!0:v.filter=n.filter),"heartbeat"in n&&(v.heartbeat=n.heartbeat),"timeout"in n&&(v.timeout=n.timeout),n.query_params&&(v.query_params=n.query_params),n.view&&(v.view=n.view),C()})}).catch(function(k){M("getCheckpoint rejected with ",k)})}function q(k){d=!1,M("writeCheckpoint completed with error",k)}if(r.cancelled){N();return}r._addedListeners||(r.once("cancel",N),typeof n.complete=="function"&&(r.once("error",n.complete),r.once("complete",function(k){n.complete(null,k)})),r._addedListeners=!0),typeof n.since=="undefined"?O():T().then(function(){return d=!0,s.writeCheckpoint(n.since,l)}).then(function(){if(d=!1,r.cancelled){N();return}c=n.since,O()}).catch(q)}pe(It,Q);function It(){Q.call(this),this.cancelled=!1,this.state="pending";var e=this,t=new Promise(function(n,r){e.once("complete",n),e.once("error",r)});e.then=function(n,r){return t.then(n,r)},e.catch=function(n){return t.catch(n)},e.catch(function(){})}It.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},It.prototype.ready=function(e,t){var n=this;if(n._readyCalled)return;n._readyCalled=!0;function r(){n.cancel()}e.once("destroyed",r),t.once("destroyed",r);function i(){e.removeListener("destroyed",r),t.removeListener("destroyed",r)}n.once("complete",i)};function Pt(e,t){var n=t.PouchConstructor;return typeof e=="string"?new n(e,t):e}function Sn(e,t,n,r){if(typeof n=="function"&&(r=n,n={}),typeof n=="undefined"&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw X(St,"`doc_ids` filter parameter is not a list.");n.complete=r,n=ae(n),n.continuous=n.continuous||n.live,n.retry="retry"in n?n.retry:!1,n.PouchConstructor=n.PouchConstructor||this;var i=new It(n),a=Pt(e,n),o=Pt(t,n);return ni(a,o,n,i),i}pe(xn,Q);function Vs(e,t,n,r){return typeof n=="function"&&(r=n,n={}),typeof n=="undefined"&&(n={}),n=ae(n),n.PouchConstructor=n.PouchConstructor||this,e=Pt(e,n),t=Pt(t,n),new xn(e,t,n,r)}function xn(e,t,n,r){var i=this;this.canceled=!1;var a=n.push?Ye({},n,n.push):n,o=n.pull?Ye({},n,n.pull):n;this.push=Sn(e,t,a),this.pull=Sn(t,e,o),this.pushPaused=!0,this.pullPaused=!0;function f(s){i.emit("change",{direction:"pull",change:s})}function d(s){i.emit("change",{direction:"push",change:s})}function w(s){i.emit("denied",{direction:"push",doc:s})}function A(s){i.emit("denied",{direction:"pull",doc:s})}function c(){i.pushPaused=!0,i.pullPaused&&i.emit("paused")}function y(){i.pullPaused=!0,i.pushPaused&&i.emit("paused")}function b(){i.pushPaused=!1,i.pullPaused&&i.emit("active",{direction:"push"})}function g(){i.pullPaused=!1,i.pushPaused&&i.emit("active",{direction:"pull"})}var m={};function _(s){return function(u,l){var v=u==="change"&&(l===f||l===d),T=u==="denied"&&(l===A||l===w),B=u==="paused"&&(l===y||l===c),P=u==="active"&&(l===g||l===b);(v||T||B||P)&&(u in m||(m[u]={}),m[u][s]=!0,Object.keys(m[u]).length===2&&i.removeAllListeners(u))}}n.live&&(this.push.on("complete",i.pull.cancel.bind(i.pull)),this.pull.on("complete",i.push.cancel.bind(i.push)));function p(s,u,l){s.listeners(u).indexOf(l)==-1&&s.on(u,l)}this.on("newListener",function(s){s==="change"?(p(i.pull,"change",f),p(i.push,"change",d)):s==="denied"?(p(i.pull,"denied",A),p(i.push,"denied",w)):s==="active"?(p(i.pull,"active",g),p(i.push,"active",b)):s==="paused"&&(p(i.pull,"paused",y),p(i.push,"paused",c))}),this.on("removeListener",function(s){s==="change"?(i.pull.removeListener("change",f),i.push.removeListener("change",d)):s==="denied"?(i.pull.removeListener("denied",A),i.push.removeListener("denied",w)):s==="active"?(i.pull.removeListener("active",g),i.push.removeListener("active",b)):s==="paused"&&(i.pull.removeListener("paused",y),i.push.removeListener("paused",c))}),this.pull.on("removeListener",_("pull")),this.push.on("removeListener",_("push"));var h=Promise.all([this.push,this.pull]).then(function(s){var u={push:s[0],pull:s[1]};return i.emit("complete",u),r&&r(null,u),i.removeAllListeners(),u},function(s){if(i.cancel(),r?r(s):i.emit("error",s),i.removeAllListeners(),r)throw s});this.then=function(s,u){return h.then(s,u)},this.catch=function(s){return h.catch(s)}}xn.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())};function eu(e){e.replicate=Sn,e.sync=Vs,Object.defineProperty(e.prototype,"replicate",{get:function(){var t=this;return typeof this.replicateMethods=="undefined"&&(this.replicateMethods={from:function(n,r,i){return t.constructor.replicate(n,t,r,i)},to:function(n,r,i){return t.constructor.replicate(t,n,r,i)}}),this.replicateMethods}}),e.prototype.sync=function(t,n,r){return this.constructor.sync(this,t,n,r)}}J.plugin(_s).plugin(Ts).plugin(Gs).plugin(eu);export default J;
